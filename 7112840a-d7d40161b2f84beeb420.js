/*! For license information please see 7112840a-d7d40161b2f84beeb420.js.LICENSE.txt */
"use strict";(self.webpackChunkallysson_me=self.webpackChunkallysson_me||[]).push([[16],{67724:function(e,t,n){n.d(t,{u7:function(){return Nl},Jj:function(){return Ec},IX:function(){return uc},hx:function(){return Js},my:function(){return Hs},xU:function(){return il},Lz:function(){return Ic},GH:function(){return Sc},gg:function(){return oc},WA:function(){return V},F8:function(){return Ac},tO:function(){return ac},AE:function(){return Ys},O$:function(){return ll},$q:function(){return al},W:function(){return ul},oZ:function(){return rl},EK:function(){return ne},YW:function(){return Hl},PU:function(){return Cl},l7:function(){return Os},Ky:function(){return Te},Mu:function(){return H},EZ:function(){return B},Xb:function(){return le},Cf:function(){return js},K9:function(){return F},Me:function(){return he},yq:function(){return C},Wi:function(){return qs},ET:function(){return jl},Ab:function(){return ef},vr:function(){return $l},Fc:function(){return yc},hJ:function(){return Xs},B$:function(){return $s},at:function(){return Ws},oe:function(){return Kl},AK:function(){return Jl},TF:function(){return gc},JU:function(){return ec},Jm:function(){return Tc},ST:function(){return hc},fH:function(){return dc},Ix:function(){return mc},Wu:function(){return Tl},Lx:function(){return Il},qY:function(){return lc},GL:function(){return Ql},QT:function(){return Ll},kl:function(){return Fl},Xk:function(){return Ol},PL:function(){return Pl},UQ:function(){return Vl},zN:function(){return ql},ad:function(){return cc},nP:function(){return tf},LV:function(){return sc},b9:function(){return ml},vh:function(){return gl},Pb:function(){return wc},L$:function(){return bc},cf:function(){return Gl},sc:function(){return zl},Xo:function(){return yl},IO:function(){return fl},iE:function(){return nc},Eo:function(){return tc},i3:function(){return Yl},Bt:function(){return Xl},pl:function(){return Ul},Ub:function(){return N},qK:function(){return sl},TQ:function(){return bl},e0:function(){return wl},RA:function(){return kc},r7:function(){return Bl},Mx:function(){return pc},ar:function(){return dl},qs:function(){return nf}});var r=n(92826),i=n(11752),a=n(70885),u=n(15861),o=n(60136),s=n(6215),c=n(61120),l=n(28664),f=n(42982),h=n(15671),d=n(43144),v=n(87757),y=n.n(v),p=n(18781),m=n(15191),g=n(40906),k=n(42404),w=n(58103);function b(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return x(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return x(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,o=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return u=e.done,e},e:function(e){o=!0,a=e},f:function(){try{u||null==n.return||n.return()}finally{if(o)throw a}}}}function x(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function I(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,c.Z)(e);if(t){var i=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return(0,s.Z)(this,n)}}var T="@firebase/firestore",E=function(){function e(t){(0,h.Z)(this,e),this.uid=t}return(0,d.Z)(e,[{key:"isAuthenticated",value:function(){return null!=this.uid}},{key:"toKey",value:function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function(e){return e.uid===this.uid}}]),e}();E.UNAUTHENTICATED=new E(null),E.GOOGLE_CREDENTIALS=new E("google-credentials-uid"),E.FIRST_PARTY=new E("first-party-uid"),E.MOCK_USER=new E("mock-user");var S="9.6.1",A=new g.Yd("@firebase/firestore");function _(){return A.logLevel}function N(e){A.setLogLevel(e)}function D(e){if(A.logLevel<=g.in.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(R);A.debug.apply(A,["Firestore (".concat(S,"): ").concat(e)].concat((0,f.Z)(i)))}}function Z(e){if(A.logLevel<=g.in.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(R);A.error.apply(A,["Firestore (".concat(S,"): ").concat(e)].concat((0,f.Z)(i)))}}function C(e){if(A.logLevel<=g.in.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n.map(R);A.warn.apply(A,["Firestore (".concat(S,"): ").concat(e)].concat((0,f.Z)(i)))}}function R(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state",t="FIRESTORE (".concat(S,") INTERNAL ASSERTION FAILED: ")+e;throw Z(t),new Error(t)}function M(e,t){e||L()}function F(e,t){e||L()}function O(e,t){return e}var P={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},V=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,r)).code=e,i.message=r,i.name="FirebaseError",i.toString=function(){return"".concat(i.name,": [code=").concat(i.code,"]: ").concat(i.message)},i}return(0,d.Z)(n)}((0,l.Z)(Error)),q=(0,d.Z)((function e(){var t=this;(0,h.Z)(this,e),this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))})),U=(0,d.Z)((function e(t,n){(0,h.Z)(this,e),this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))})),B=function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(null)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(E.UNAUTHENTICATED)}))}},{key:"shutdown",value:function(){}}]),e}(),K=function(){function e(t){(0,h.Z)(this,e),this.token=t,this.changeListener=null}return(0,d.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(this.token)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){var n=this;this.changeListener=t,e.enqueueRetryable((function(){return t(n.token.user)}))}},{key:"shutdown",value:function(){this.changeListener=null}}]),e}(),j=function(){function e(t){(0,h.Z)(this,e),this.t=t,this.currentUser=E.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}return(0,d.Z)(e,[{key:"start",value:function(e,t){var n=this,r=this.i,i=function(e){return n.i!==r?(r=n.i,t(e)):Promise.resolve()},a=new q;this.o=function(){n.i++,n.currentUser=n.u(),a.resolve(),a=new q,e.enqueueRetryable((function(){return i(n.currentUser)}))};var o=function(){var t=a;e.enqueueRetryable((0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.promise;case 2:return e.next=4,i(n.currentUser);case 4:case"end":return e.stop()}}),e)}))))},s=function(e){D("FirebaseAuthCredentialsProvider","Auth detected"),n.auth=e,n.auth.addAuthTokenListener(n.o),o()};this.t.onInit((function(e){return s(e)})),setTimeout((function(){if(!n.auth){var e=n.t.getImmediate({optional:!0});e?s(e):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),a.resolve(),a=new q)}}),0),o()}},{key:"getToken",value:function(){var e=this,t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return e.i!==t?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),e.getToken()):n?(M("string"==typeof n.accessToken),new U(n.accessToken,e.currentUser)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.auth&&this.auth.removeAuthTokenListener(this.o)}},{key:"u",value:function(){var e=this.auth&&this.auth.getUid();return M(null===e||"string"==typeof e),new E(e)}}]),e}(),G=(0,d.Z)((function e(t,n,r){(0,h.Z)(this,e),this.type="FirstParty",this.user=E.FIRST_PARTY,this.headers=new Map,this.headers.set("X-Goog-AuthUser",n);var i=t.auth.getAuthHeaderValueForFirstParty([]);i&&this.headers.set("Authorization",i),r&&this.headers.set("X-Goog-Iam-Authorization-Token",r)})),z=function(){function e(t,n,r){(0,h.Z)(this,e),this.h=t,this.l=n,this.m=r}return(0,d.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(new G(this.h,this.l,this.m))}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(E.FIRST_PARTY)}))}},{key:"shutdown",value:function(){}},{key:"invalidateToken",value:function(){}}]),e}(),Q=(0,d.Z)((function e(t){(0,h.Z)(this,e),this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)})),W=function(){function e(t){(0,h.Z)(this,e),this.g=t,this.forceRefresh=!1,this.appCheck=null}return(0,d.Z)(e,[{key:"start",value:function(e,t){var n=this;this.o=function(n){e.enqueueRetryable((function(){return function(e){return null!=e.error&&D("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message)),t(e.token)}(n)}))};var r=function(e){D("FirebaseAppCheckTokenProvider","AppCheck detected"),n.appCheck=e,n.appCheck.addTokenListener(n.o)};this.g.onInit((function(e){return r(e)})),setTimeout((function(){if(!n.appCheck){var e=n.g.getImmediate({optional:!0});e?r(e):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}},{key:"getToken",value:function(){var e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then((function(e){return e?(M("string"==typeof e.token),new Q(e.token)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}]),e}(),H=function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,[{key:"getToken",value:function(){return Promise.resolve(new Q(""))}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){}},{key:"shutdown",value:function(){}}]),e}(),Y=function(){function e(t,n){var r=this;(0,h.Z)(this,e),this.previousValue=t,n&&(n.sequenceNumberHandler=function(e){return r.p(e)},this.T=function(e){return n.writeSequenceNumber(e)})}return(0,d.Z)(e,[{key:"p",value:function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}},{key:"next",value:function(){var e=++this.previousValue;return this.T&&this.T(e),e}}]),e}();function J(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}Y.I=-1;var X=function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,null,[{key:"A",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";n.length<20;)for(var r=J(40),i=0;i<r.length;++i)n.length<20&&r[i]<t&&(n+=e.charAt(r[i]%e.length));return n}}]),e}();function $(e,t){return e<t?-1:e>t?1:0}function ee(e,t,n){return e.length===t.length&&e.every((function(e,r){return n(e,t[r])}))}function te(e){return e+"\0"}var ne=function(){function e(t,n){if((0,h.Z)(this,e),this.seconds=t,this.nanoseconds=n,n<0)throw new V(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new V(P.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new V(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new V(P.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return(0,d.Z)(e,[{key:"toDate",value:function(){return new Date(this.toMillis())}},{key:"toMillis",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function(e){return this.seconds===e.seconds?$(this.nanoseconds,e.nanoseconds):$(this.seconds,e.seconds)}},{key:"isEqual",value:function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:"toString",value:function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function(){return e.fromMillis(Date.now())}},{key:"fromDate",value:function(t){return e.fromMillis(t.getTime())}},{key:"fromMillis",value:function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))}}]),e}(),re=function(){function e(t){(0,h.Z)(this,e),this.timestamp=t}return(0,d.Z)(e,[{key:"compareTo",value:function(e){return this.timestamp._compareTo(e.timestamp)}},{key:"isEqual",value:function(e){return this.timestamp.isEqual(e.timestamp)}},{key:"toMicroseconds",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function(){return this.timestamp}}],[{key:"fromTimestamp",value:function(t){return new e(t)}},{key:"min",value:function(){return new e(new ne(0,0))}}]),e}();function ie(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function ae(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function ue(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}var oe=function(){function e(t,n,r){(0,h.Z)(this,e),void 0===n?n=0:n>t.length&&L(),void 0===r?r=t.length-n:r>t.length-n&&L(),this.segments=t,this.offset=n,this.len=r}return(0,d.Z)(e,[{key:"length",get:function(){return this.len}},{key:"isEqual",value:function(t){return 0===e.comparator(this,t)}},{key:"child",value:function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach((function(e){n.push(e)})):n.push(t),this.construct(n)}},{key:"limit",value:function(){return this.offset+this.length}},{key:"popFirst",value:function(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}},{key:"popLast",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function(){return this.segments[this.offset]}},{key:"lastSegment",value:function(){return this.get(this.length-1)}},{key:"get",value:function(e){return this.segments[this.offset+e]}},{key:"isEmpty",value:function(){return 0===this.length}},{key:"isPrefixOf",value:function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"isImmediateParentOf",value:function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"forEach",value:function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}},{key:"toArray",value:function(){return this.segments.slice(this.offset,this.limit())}}],[{key:"comparator",value:function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var i=e.get(r),a=t.get(r);if(i<a)return-1;if(i>a)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}]),e}(),se=function(e){(0,o.Z)(n,e);var t=I(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().join("/")}},{key:"toString",value:function(){return this.canonicalString()}}],[{key:"fromString",value:function(){for(var e=[],t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];for(var a=0,u=r;a<u.length;a++){var o=u[a];if(o.indexOf("//")>=0)throw new V(P.INVALID_ARGUMENT,"Invalid segment (".concat(o,"). Paths must not contain // in them."));e.push.apply(e,(0,f.Z)(o.split("/").filter((function(e){return e.length>0}))))}return new n(e)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(oe),ce=/^[_a-zA-Z][_a-zA-Z0-9]*$/,le=function(e){(0,o.Z)(n,e);var t=I(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().map((function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e})).join(".")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"isKeyField",value:function(){return 1===this.length&&"__name__"===this.get(0)}}],[{key:"isValidIdentifier",value:function(e){return ce.test(e)}},{key:"keyField",value:function(){return new n(["__name__"])}},{key:"fromServerFormat",value:function(e){for(var t=[],r="",i=0,a=function(){if(0===r.length)throw new V(P.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(r),r=""},u=!1;i<e.length;){var o=e[i];if("\\"===o){if(i+1===e.length)throw new V(P.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var s=e[i+1];if("\\"!==s&&"."!==s&&"`"!==s)throw new V(P.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=s,i+=2}else"`"===o?(u=!u,i++):"."!==o||u?(r+=o,i++):(a(),i++)}if(a(),u)throw new V(P.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(oe),fe=function(){function e(t){(0,h.Z)(this,e),this.fields=t,t.sort(le.comparator)}return(0,d.Z)(e,[{key:"covers",value:function(e){var t,n=b(this.fields);try{for(n.s();!(t=n.n()).done;){if(t.value.isPrefixOf(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"isEqual",value:function(e){return ee(this.fields,e.fields,(function(e,t){return e.isEqual(t)}))}}]),e}();function he(){return"undefined"!=typeof atob}var de=function(){function e(t){(0,h.Z)(this,e),this.binaryString=t}return(0,d.Z)(e,[{key:"toBase64",value:function(){return e=this.binaryString,btoa(e);var e}},{key:"toUint8Array",value:function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}},{key:"approximateByteSize",value:function(){return 2*this.binaryString.length}},{key:"compareTo",value:function(e){return $(this.binaryString,e.binaryString)}},{key:"isEqual",value:function(e){return this.binaryString===e.binaryString}}],[{key:"fromBase64String",value:function(t){return new e(atob(t))}},{key:"fromUint8Array",value:function(t){var n=function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(t);return new e(n)}}]),e}();de.EMPTY_BYTE_STRING=new de("");var ve=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function ye(e){if(M(!!e),"string"==typeof e){var t=0,n=ve.exec(e);if(M(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var i=new Date(e);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:pe(e.seconds),nanos:pe(e.nanos)}}function pe(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function me(e){return"string"==typeof e?de.fromBase64String(e):de.fromUint8Array(e)}function ge(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ke(e){var t=e.mapValue.fields.__previous_value__;return ge(t)?ke(t):t}function we(e){var t=ye(e.mapValue.fields.__local_write_time__.timestampValue);return new ne(t.seconds,t.nanos)}function be(e){return null==e}function xe(e){return 0===e&&1/e==-1/0}function Ie(e){return"number"==typeof e&&Number.isInteger(e)&&!xe(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}var Te=function(){function e(t){(0,h.Z)(this,e),this.path=t}return(0,d.Z)(e,[{key:"hasCollectionId",value:function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:"isEqual",value:function(e){return null!==e&&0===se.comparator(this.path,e.path)}},{key:"toString",value:function(){return this.path.toString()}}],[{key:"fromPath",value:function(t){return new e(se.fromString(t))}},{key:"fromName",value:function(t){return new e(se.fromString(t).popFirst(5))}},{key:"comparator",value:function(e,t){return se.comparator(e.path,t.path)}},{key:"isDocumentKey",value:function(e){return e.length%2==0}},{key:"fromSegments",value:function(t){return new e(new se(t.slice()))}}]),e}();function Ee(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?ge(e)?4:10:L()}function Se(e,t){var n=Ee(e);if(n!==Ee(t))return!1;switch(n){case 0:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return we(e).isEqual(we(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=ye(e.timestampValue),r=ye(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return me(e.bytesValue).isEqual(me(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return pe(e.geoPointValue.latitude)===pe(t.geoPointValue.latitude)&&pe(e.geoPointValue.longitude)===pe(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return pe(e.integerValue)===pe(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=pe(e.doubleValue),r=pe(t.doubleValue);return n===r?xe(n)===xe(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return ee(e.arrayValue.values||[],t.arrayValue.values||[],Se);case 10:return function(e,t){var n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(ie(n)!==ie(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Se(n[i],r[i])))return!1;return!0}(e,t);default:return L()}}function Ae(e,t){return void 0!==(e.values||[]).find((function(e){return Se(e,t)}))}function _e(e,t){var n=Ee(e),r=Ee(t);if(n!==r)return $(n,r);switch(n){case 0:return 0;case 1:return $(e.booleanValue,t.booleanValue);case 2:return function(e,t){var n=pe(e.integerValue||e.doubleValue),r=pe(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return Ne(e.timestampValue,t.timestampValue);case 4:return Ne(we(e),we(t));case 5:return $(e.stringValue,t.stringValue);case 6:return function(e,t){var n=me(e),r=me(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),i=0;i<n.length&&i<r.length;i++){var a=$(n[i],r[i]);if(0!==a)return a}return $(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){var n=$(pe(e.latitude),pe(t.latitude));return 0!==n?n:$(pe(e.longitude),pe(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],i=0;i<n.length&&i<r.length;++i){var a=_e(n[i],r[i]);if(a)return a}return $(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){var n=e.fields||{},r=Object.keys(n),i=t.fields||{},a=Object.keys(i);r.sort(),a.sort();for(var u=0;u<r.length&&u<a.length;++u){var o=$(r[u],a[u]);if(0!==o)return o;var s=_e(n[r[u]],i[a[u]]);if(0!==s)return s}return $(r.length,a.length)}(e.mapValue,t.mapValue);default:throw L()}}function Ne(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return $(e,t);var n=ye(e),r=ye(t),i=$(n.seconds,r.seconds);return 0!==i?i:$(n.nanos,r.nanos)}function De(e){return Ze(e)}function Ze(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){var t=ye(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?me(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,Te.fromName(n).toString()):"geoPointValue"in e?"geo(".concat((t=e.geoPointValue).latitude,",").concat(t.longitude,")"):"arrayValue"in e?function(e){var t,n="[",r=!0,i=b(e.values||[]);try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+=Ze(a)}}catch(u){i.e(u)}finally{i.f()}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){var t,n="{",r=!0,i=b(Object.keys(e.fields||{}).sort());try{for(i.s();!(t=i.n()).done;){var a=t.value;r?r=!1:n+=",",n+="".concat(a,":").concat(Ze(e.fields[a]))}}catch(u){i.e(u)}finally{i.f()}return n+"}"}(e.mapValue):L();var t,n}function Ce(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function Re(e){return!!e&&"integerValue"in e}function Le(e){return!!e&&"arrayValue"in e}function Me(e){return!!e&&"nullValue"in e}function Fe(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Oe(e){return!!e&&"mapValue"in e}function Pe(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return ae(e.mapValue.fields,(function(e,n){return t.mapValue.fields[e]=Pe(n)})),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Pe(e.arrayValue.values[r]);return n}return Object.assign({},e)}var Ve=function(){function e(t){(0,h.Z)(this,e),this.value=t}return(0,d.Z)(e,[{key:"field",value:function(e){if(e.isEmpty())return this.value;for(var t=this.value,n=0;n<e.length-1;++n)if(!Oe(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}},{key:"set",value:function(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Pe(t)}},{key:"setAll",value:function(e){var t=this,n=le.emptyPath(),r={},i=[];e.forEach((function(e,a){if(!n.isImmediateParentOf(a)){var u=t.getFieldsMap(n);t.applyChanges(u,r,i),r={},i=[],n=a.popLast()}e?r[a.lastSegment()]=Pe(e):i.push(a.lastSegment())}));var a=this.getFieldsMap(n);this.applyChanges(a,r,i)}},{key:"delete",value:function(e){var t=this.field(e.popLast());Oe(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}},{key:"isEqual",value:function(e){return Se(this.value,e.value)}},{key:"getFieldsMap",value:function(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var r=t.mapValue.fields[e.get(n)];Oe(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}},{key:"applyChanges",value:function(e,t,n){ae(t,(function(t,n){return e[t]=n}));var r,i=b(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;delete e[a]}}catch(u){i.e(u)}finally{i.f()}}},{key:"clone",value:function(){return new e(Pe(this.value))}}],[{key:"empty",value:function(){return new e({mapValue:{}})}}]),e}();function qe(e){var t=[];return ae(e.fields,(function(e,n){var r=new le([e]);if(Oe(n)){var i=qe(n.mapValue).fields;if(0===i.length)t.push(r);else{var a,u=b(i);try{for(u.s();!(a=u.n()).done;){var o=a.value;t.push(r.child(o))}}catch(s){u.e(s)}finally{u.f()}}}else t.push(r)})),new fe(t)}var Ue=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this.key=t,this.documentType=n,this.version=r,this.data=i,this.documentState=a}return(0,d.Z)(e,[{key:"convertToFoundDocument",value:function(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}},{key:"convertToNoDocument",value:function(e){return this.version=e,this.documentType=2,this.data=Ve.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function(e){return this.version=e,this.documentType=3,this.data=Ve.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function(){return this.documentState=1,this}},{key:"hasLocalMutations",get:function(){return 1===this.documentState}},{key:"hasCommittedMutations",get:function(){return 2===this.documentState}},{key:"hasPendingWrites",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:"isValidDocument",value:function(){return 0!==this.documentType}},{key:"isFoundDocument",value:function(){return 1===this.documentType}},{key:"isNoDocument",value:function(){return 2===this.documentType}},{key:"isUnknownDocument",value:function(){return 3===this.documentType}},{key:"isEqual",value:function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}},{key:"clone",value:function(){return new e(this.key,this.documentType,this.version,this.data.clone(),this.documentState)}},{key:"toString",value:function(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}],[{key:"newInvalidDocument",value:function(t){return new e(t,0,re.min(),Ve.empty(),0)}},{key:"newFoundDocument",value:function(t,n,r){return new e(t,1,n,r,0)}},{key:"newNoDocument",value:function(t,n){return new e(t,2,n,Ve.empty(),0)}},{key:"newUnknownDocument",value:function(t,n){return new e(t,3,n,Ve.empty(),2)}}]),e}(),Be=(0,d.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;(0,h.Z)(this,e),this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=i,this.limit=a,this.startAt=u,this.endAt=o,this.R=null}));function Ke(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return new Be(e,t,n,r,i,a,u)}function je(e){var t=O(e);if(null===t.R){var n=t.path.canonicalString();null!==t.collectionGroup&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map((function(e){return function(e){return e.field.canonicalString()+e.op.toString()+De(e.value)}(e)})).join(","),n+="|ob:",n+=t.orderBy.map((function(e){return function(e){return e.field.canonicalString()+e.dir}(e)})).join(","),be(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=rt(t.startAt)),t.endAt&&(n+="|ub:",n+=rt(t.endAt)),t.R=n}return t.R}function Ge(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!at(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(i=e.filters[r],a=t.filters[r],i.op!==a.op||!i.field.isEqual(a.field)||!Se(i.value,a.value))return!1;var i,a;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ot(e.startAt,t.startAt)&&ot(e.endAt,t.endAt)}function ze(e){return Te.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}var Qe=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this)).field=e,a.op=r,a.value=i,a}return(0,d.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.v(_e(t,this.value)):null!==t&&Ee(this.value)===Ee(t)&&this.v(_e(t,this.value))}},{key:"v",value:function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return L()}}},{key:"V",value:function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}],[{key:"create",value:function(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.P(e,t,r):new We(e,t,r):"array-contains"===t?new Xe(e,r):"in"===t?new $e(e,r):"not-in"===t?new et(e,r):"array-contains-any"===t?new tt(e,r):new n(e,t,r)}},{key:"P",value:function(e,t,n){return"in"===t?new He(e,n):new Ye(e,n)}}]),n}(function(){return(0,d.Z)((function e(){(0,h.Z)(this,e)}))}());var We=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this,e,r,i)).key=Te.fromName(i.referenceValue),a}return(0,d.Z)(n,[{key:"matches",value:function(e){var t=Te.comparator(e.key,this.key);return this.v(t)}}]),n}(Qe),He=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e,"in",r)).keys=Je("in",r),i}return(0,d.Z)(n,[{key:"matches",value:function(e){return this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(Qe),Ye=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e,"not-in",r)).keys=Je("not-in",r),i}return(0,d.Z)(n,[{key:"matches",value:function(e){return!this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(Qe);function Je(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(e){return Te.fromName(e.referenceValue)}))}var Xe=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){return(0,h.Z)(this,n),t.call(this,e,"array-contains",r)}return(0,d.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return Le(t)&&Ae(t.arrayValue,this.value)}}]),n}(Qe),$e=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){return(0,h.Z)(this,n),t.call(this,e,"in",r)}return(0,d.Z)(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return null!==t&&Ae(this.value.arrayValue,t)}}]),n}(Qe),et=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){return(0,h.Z)(this,n),t.call(this,e,"not-in",r)}return(0,d.Z)(n,[{key:"matches",value:function(e){if(Ae(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!Ae(this.value.arrayValue,t)}}]),n}(Qe),tt=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){return(0,h.Z)(this,n),t.call(this,e,"array-contains-any",r)}return(0,d.Z)(n,[{key:"matches",value:function(e){var t=this,n=e.data.field(this.field);return!(!Le(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(e){return Ae(t.value.arrayValue,e)}))}}]),n}(Qe),nt=(0,d.Z)((function e(t,n){(0,h.Z)(this,e),this.position=t,this.before=n}));function rt(e){return"".concat(e.before?"b":"a",":").concat(e.position.map((function(e){return De(e)})).join(","))}var it=(0,d.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";(0,h.Z)(this,e),this.field=t,this.dir=n}));function at(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function ut(e,t,n){for(var r=0,i=0;i<e.position.length;i++){var a=t[i],u=e.position[i];if(r=a.field.isKeyField()?Te.comparator(Te.fromName(u.referenceValue),n.key):_e(u,n.data.field(a.field)),"desc"===a.dir&&(r*=-1),0!==r)break}return e.before?r<=0:r<0}function ot(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.before!==t.before||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!Se(e.position[n],t.position[n]))return!1;return!0}var st=(0,d.Z)((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;(0,h.Z)(this,e),this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=i,this.limit=a,this.limitType=u,this.startAt=o,this.endAt=s,this.S=null,this.D=null,this.startAt,this.endAt}));function ct(e,t,n,r,i,a,u,o){return new st(e,t,n,r,i,a,u,o)}function lt(e){return new st(e)}function ft(e){return!be(e.limit)&&"F"===e.limitType}function ht(e){return!be(e.limit)&&"L"===e.limitType}function dt(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function vt(e){var t,n=b(e.filters);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.V())return r.field}}catch(i){n.e(i)}finally{n.f()}return null}function yt(e){return null!==e.collectionGroup}function pt(e){var t=O(e);if(null===t.S){t.S=[];var n=vt(t),r=dt(t);if(null!==n&&null===r)n.isKeyField()||t.S.push(new it(n)),t.S.push(new it(le.keyField(),"asc"));else{var i,a=!1,u=b(t.explicitOrderBy);try{for(u.s();!(i=u.n()).done;){var o=i.value;t.S.push(o),o.field.isKeyField()&&(a=!0)}}catch(c){u.e(c)}finally{u.f()}if(!a){var s=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t.S.push(new it(le.keyField(),s))}}}return t.S}function mt(e){var t=O(e);if(!t.D)if("F"===t.limitType)t.D=Ke(t.path,t.collectionGroup,pt(t),t.filters,t.limit,t.startAt,t.endAt);else{var n,r=[],i=b(pt(t));try{for(i.s();!(n=i.n()).done;){var a=n.value,u="desc"===a.dir?"asc":"desc";r.push(new it(a.field,u))}}catch(c){i.e(c)}finally{i.f()}var o=t.endAt?new nt(t.endAt.position,!t.endAt.before):null,s=t.startAt?new nt(t.startAt.position,!t.startAt.before):null;t.D=Ke(t.path,t.collectionGroup,r,t.filters,t.limit,o,s)}return t.D}function gt(e,t,n){return new st(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function kt(e,t){return Ge(mt(e),mt(t))&&e.limitType===t.limitType}function wt(e){return"".concat(je(mt(e)),"|lt:").concat(e.limitType)}function bt(e){return"Query(target=".concat(function(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map((function(e){return"".concat((t=e).field.canonicalString()," ").concat(t.op," ").concat(De(t.value));var t})).join(", "),"]")),be(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map((function(e){return function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)})).join(", "),"]")),e.startAt&&(t+=", startAt: "+rt(e.startAt)),e.endAt&&(t+=", endAt: "+rt(e.endAt)),"Target(".concat(t,")")}(mt(e)),"; limitType=").concat(e.limitType,")")}function xt(e,t){return t.isFoundDocument()&&function(e,t){var n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):Te.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){var n,r=b(e.explicitOrderBy);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.field.isKeyField()&&null===t.data.field(i.field))return!1}}catch(a){r.e(a)}finally{r.f()}return!0}(e,t)&&function(e,t){var n,r=b(e.filters);try{for(r.s();!(n=r.n()).done;){if(!n.value.matches(t))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}(e,t)&&function(e,t){return!(e.startAt&&!ut(e.startAt,pt(e),t))&&(!e.endAt||!ut(e.endAt,pt(e),t))}(e,t)}function It(e){return function(t,n){var r,i=!1,a=b(pt(e));try{for(a.s();!(r=a.n()).done;){var u=r.value,o=Tt(u,t,n);if(0!==o)return o;i=i||u.field.isKeyField()}}catch(s){a.e(s)}finally{a.f()}return 0}}function Tt(e,t,n){var r=e.field.isKeyField()?Te.comparator(t.key,n.key):function(e,t,n){var r=t.data.field(e),i=n.data.field(e);return null!==r&&null!==i?_e(r,i):L()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return L()}}function Et(e,t){if(e.C){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:xe(t)?"-0":t}}function St(e){return{integerValue:""+e}}function At(e,t){return Ie(t)?St(t):Et(e,t)}var _t=(0,d.Z)((function e(){(0,h.Z)(this,e),this._=void 0}));function Nt(e,t,n){return e instanceof Ct?function(e,t){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Rt?Lt(e,t):e instanceof Mt?Ft(e,t):function(e,t){var n=Zt(e,t),r=Pt(n)+Pt(e.N);return Re(n)&&Re(e.N)?St(r):Et(e.k,r)}(e,t)}function Dt(e,t,n){return e instanceof Rt?Lt(e,t):e instanceof Mt?Ft(e,t):n}function Zt(e,t){return e instanceof Ot?Re(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}var Ct=function(e){(0,o.Z)(n,e);var t=I(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n)}(_t),Rt=function(e){(0,o.Z)(n,e);var t=I(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).elements=e,r}return(0,d.Z)(n)}(_t);function Lt(e,t){var n,r=Vt(t),i=b(e.elements);try{var a=function(){var e=n.value;r.some((function(t){return Se(t,e)}))||r.push(e)};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return{arrayValue:{values:r}}}var Mt=function(e){(0,o.Z)(n,e);var t=I(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).elements=e,r}return(0,d.Z)(n)}(_t);function Ft(e,t){var n,r=Vt(t),i=b(e.elements);try{var a=function(){var e=n.value;r=r.filter((function(t){return!Se(t,e)}))};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return{arrayValue:{values:r}}}var Ot=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).k=e,i.N=r,i}return(0,d.Z)(n)}(_t);function Pt(e){return pe(e.integerValue||e.doubleValue)}function Vt(e){return Le(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var qt=(0,d.Z)((function e(t,n){(0,h.Z)(this,e),this.field=t,this.transform=n}));var Ut=(0,d.Z)((function e(t,n){(0,h.Z)(this,e),this.version=t,this.transformResults=n})),Bt=function(){function e(t,n){(0,h.Z)(this,e),this.updateTime=t,this.exists=n}return(0,d.Z)(e,[{key:"isNone",get:function(){return void 0===this.updateTime&&void 0===this.exists}},{key:"isEqual",value:function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:"none",value:function(){return new e}},{key:"exists",value:function(t){return new e(void 0,t)}},{key:"updateTime",value:function(t){return new e(t)}}]),e}();function Kt(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var jt=(0,d.Z)((function e(){(0,h.Z)(this,e)}));function Gt(e,t,n){e instanceof Yt?function(e,t,n){var r=e.value.clone(),i=$t(e.fieldTransforms,t,n.transformResults);r.setAll(i),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof Jt?function(e,t,n){if(Kt(e.precondition,t)){var r=$t(e.fieldTransforms,t,n.transformResults),i=t.data;i.setAll(Xt(e)),i.setAll(r),t.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else t.convertToUnknownDocument(n.version)}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function zt(e,t,n){e instanceof Yt?function(e,t,n){if(Kt(e.precondition,t)){var r=e.value.clone(),i=en(e.fieldTransforms,n,t);r.setAll(i),t.convertToFoundDocument(Ht(t),r).setHasLocalMutations()}}(e,t,n):e instanceof Jt?function(e,t,n){if(Kt(e.precondition,t)){var r=en(e.fieldTransforms,n,t),i=t.data;i.setAll(Xt(e)),i.setAll(r),t.convertToFoundDocument(Ht(t),i).setHasLocalMutations()}}(e,t,n):function(e,t){Kt(e.precondition,t)&&t.convertToNoDocument(re.min())}(e,t)}function Qt(e,t){var n,r=null,i=b(e.fieldTransforms);try{for(i.s();!(n=i.n()).done;){var a=n.value,u=t.data.field(a.field),o=Zt(a.transform,u||null);null!=o&&(null==r&&(r=Ve.empty()),r.set(a.field,o))}}catch(s){i.e(s)}finally{i.f()}return r||null}function Wt(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&ee(e,t,(function(e,t){return function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Rt&&t instanceof Rt||e instanceof Mt&&t instanceof Mt?ee(e.elements,t.elements,Se):e instanceof Ot&&t instanceof Ot?Se(e.N,t.N):e instanceof Ct&&t instanceof Ct}(e.transform,t.transform)}(e,t)}))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}function Ht(e){return e.isFoundDocument()?e.version:re.min()}var Yt=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i){var a,u=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return(0,h.Z)(this,n),(a=t.call(this)).key=e,a.value=r,a.precondition=i,a.fieldTransforms=u,a.type=0,a}return(0,d.Z)(n)}(jt),Jt=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i,a){var u,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return(0,h.Z)(this,n),(u=t.call(this)).key=e,u.data=r,u.fieldMask=i,u.precondition=a,u.fieldTransforms=o,u.type=1,u}return(0,d.Z)(n)}(jt);function Xt(e){var t=new Map;return e.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}})),t}function $t(e,t,n){var r=new Map;M(e.length===n.length);for(var i=0;i<n.length;i++){var a=e[i],u=a.transform,o=t.data.field(a.field);r.set(a.field,Dt(u,o,n[i]))}return r}function en(e,t,n){var r,i=new Map,a=b(e);try{for(a.s();!(r=a.n()).done;){var u=r.value,o=u.transform,s=n.data.field(u.field);i.set(u.field,Nt(o,s,t))}}catch(c){a.e(c)}finally{a.f()}return i}var tn,nn,rn=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=2,i.fieldTransforms=[],i}return(0,d.Z)(n)}(jt),an=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).key=e,i.precondition=r,i.type=3,i.fieldTransforms=[],i}return(0,d.Z)(n)}(jt),un=(0,d.Z)((function e(t){(0,h.Z)(this,e),this.count=t}));function on(e){switch(e){default:return L();case P.CANCELLED:case P.UNKNOWN:case P.DEADLINE_EXCEEDED:case P.RESOURCE_EXHAUSTED:case P.INTERNAL:case P.UNAVAILABLE:case P.UNAUTHENTICATED:return!1;case P.INVALID_ARGUMENT:case P.NOT_FOUND:case P.ALREADY_EXISTS:case P.PERMISSION_DENIED:case P.FAILED_PRECONDITION:case P.ABORTED:case P.OUT_OF_RANGE:case P.UNIMPLEMENTED:case P.DATA_LOSS:return!0}}function sn(e){if(void 0===e)return Z("GRPC error has no .code"),P.UNKNOWN;switch(e){case tn.OK:return P.OK;case tn.CANCELLED:return P.CANCELLED;case tn.UNKNOWN:return P.UNKNOWN;case tn.DEADLINE_EXCEEDED:return P.DEADLINE_EXCEEDED;case tn.RESOURCE_EXHAUSTED:return P.RESOURCE_EXHAUSTED;case tn.INTERNAL:return P.INTERNAL;case tn.UNAVAILABLE:return P.UNAVAILABLE;case tn.UNAUTHENTICATED:return P.UNAUTHENTICATED;case tn.INVALID_ARGUMENT:return P.INVALID_ARGUMENT;case tn.NOT_FOUND:return P.NOT_FOUND;case tn.ALREADY_EXISTS:return P.ALREADY_EXISTS;case tn.PERMISSION_DENIED:return P.PERMISSION_DENIED;case tn.FAILED_PRECONDITION:return P.FAILED_PRECONDITION;case tn.ABORTED:return P.ABORTED;case tn.OUT_OF_RANGE:return P.OUT_OF_RANGE;case tn.UNIMPLEMENTED:return P.UNIMPLEMENTED;case tn.DATA_LOSS:return P.DATA_LOSS;default:return L()}}(nn=tn||(tn={}))[nn.OK=0]="OK",nn[nn.CANCELLED=1]="CANCELLED",nn[nn.UNKNOWN=2]="UNKNOWN",nn[nn.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",nn[nn.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",nn[nn.NOT_FOUND=5]="NOT_FOUND",nn[nn.ALREADY_EXISTS=6]="ALREADY_EXISTS",nn[nn.PERMISSION_DENIED=7]="PERMISSION_DENIED",nn[nn.UNAUTHENTICATED=16]="UNAUTHENTICATED",nn[nn.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",nn[nn.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",nn[nn.ABORTED=10]="ABORTED",nn[nn.OUT_OF_RANGE=11]="OUT_OF_RANGE",nn[nn.UNIMPLEMENTED=12]="UNIMPLEMENTED",nn[nn.INTERNAL=13]="INTERNAL",nn[nn.UNAVAILABLE=14]="UNAVAILABLE",nn[nn.DATA_LOSS=15]="DATA_LOSS";var cn=function(){function e(t,n){(0,h.Z)(this,e),this.comparator=t,this.root=n||fn.EMPTY}return(0,d.Z)(e,[{key:"insert",value:function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,fn.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,fn.BLACK,null,null))}},{key:"get",value:function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}},{key:"indexOf",value:function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}},{key:"isEmpty",value:function(){return this.root.isEmpty()}},{key:"size",get:function(){return this.root.size}},{key:"minKey",value:function(){return this.root.minKey()}},{key:"maxKey",value:function(){return this.root.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root.inorderTraversal(e)}},{key:"forEach",value:function(e){this.inorderTraversal((function(t,n){return e(t,n),!1}))}},{key:"toString",value:function(){var e=[];return this.inorderTraversal((function(t,n){return e.push("".concat(t,":").concat(n)),!1})),"{".concat(e.join(", "),"}")}},{key:"reverseTraversal",value:function(e){return this.root.reverseTraversal(e)}},{key:"getIterator",value:function(){return new ln(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function(e){return new ln(this.root,e,this.comparator,!1)}},{key:"getReverseIterator",value:function(){return new ln(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function(e){return new ln(this.root,e,this.comparator,!0)}}]),e}(),ln=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.isReverse=i,this.nodeStack=[];for(var a=1;!t.isEmpty();)if(a=n?r(t.key,n):1,i&&(a*=-1),a<0)t=this.isReverse?t.left:t.right;else{if(0===a){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return(0,d.Z)(e,[{key:"getNext",value:function(){var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}},{key:"hasNext",value:function(){return this.nodeStack.length>0}},{key:"peek",value:function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}]),e}(),fn=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=i?i:e.EMPTY,this.right=null!=a?a:e.EMPTY,this.size=this.left.size+1+this.right.size}return(0,d.Z)(e,[{key:"copy",value:function(t,n,r,i,a){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=a?a:this.right)}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function(){return this.min().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,i=n(e,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===i?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}},{key:"removeMin",value:function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()}},{key:"remove",value:function(t,n){var r,i=this;if(n(t,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(t,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(t,i.key)){if(i.right.isEmpty())return e.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(t,n))}return i.fixUp()}},{key:"isRed",value:function(){return this.color}},{key:"fixUp",value:function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:"moveRedLeft",value:function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}},{key:"moveRedRight",value:function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}},{key:"rotateLeft",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth",value:function(){var e=this.check();return Math.pow(2,e)<=this.size+1}},{key:"check",value:function(){if(this.isRed()&&this.left.isRed())throw L();if(this.right.isRed())throw L();var e=this.left.check();if(e!==this.right.check())throw L();return e+(this.isRed()?0:1)}}]),e}();fn.EMPTY=null,fn.RED=!0,fn.BLACK=!1,fn.EMPTY=new(function(){function e(){(0,h.Z)(this,e),this.size=0}return(0,d.Z)(e,[{key:"key",get:function(){throw L()}},{key:"value",get:function(){throw L()}},{key:"color",get:function(){throw L()}},{key:"left",get:function(){throw L()}},{key:"right",get:function(){throw L()}},{key:"copy",value:function(e,t,n,r,i){return this}},{key:"insert",value:function(e,t,n){return new fn(e,t)}},{key:"remove",value:function(e,t){return this}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"isRed",value:function(){return!1}},{key:"checkMaxDepth",value:function(){return!0}},{key:"check",value:function(){return 0}}]),e}());var hn=function(){function e(t){(0,h.Z)(this,e),this.comparator=t,this.data=new cn(this.comparator)}return(0,d.Z)(e,[{key:"has",value:function(e){return null!==this.data.get(e)}},{key:"first",value:function(){return this.data.minKey()}},{key:"last",value:function(){return this.data.maxKey()}},{key:"size",get:function(){return this.data.size}},{key:"indexOf",value:function(e){return this.data.indexOf(e)}},{key:"forEach",value:function(e){this.data.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"forEachInRange",value:function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}},{key:"forEachWhile",value:function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}},{key:"firstAfterOrEqual",value:function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}},{key:"getIterator",value:function(){return new dn(this.data.getIterator())}},{key:"getIteratorFrom",value:function(e){return new dn(this.data.getIteratorFrom(e))}},{key:"add",value:function(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:"delete",value:function(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:"isEmpty",value:function(){return this.data.isEmpty()}},{key:"unionWith",value:function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach((function(e){t=t.add(e)})),t}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(0!==this.comparator(i,a))return!1}return!0}},{key:"toArray",value:function(){var e=[];return this.forEach((function(t){e.push(t)})),e}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){return e.push(t)})),"SortedSet("+e.toString()+")"}},{key:"copy",value:function(t){var n=new e(this.comparator);return n.data=t,n}}]),e}(),dn=function(){function e(t){(0,h.Z)(this,e),this.iter=t}return(0,d.Z)(e,[{key:"getNext",value:function(){return this.iter.getNext().key}},{key:"hasNext",value:function(){return this.iter.hasNext()}}]),e}(),vn=new cn(Te.comparator);function yn(){return vn}var pn=new cn(Te.comparator);function mn(){return pn}var gn=new cn(Te.comparator);function kn(){return gn}var wn=new hn(Te.comparator);function bn(){for(var e=wn,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0,a=n;i<a.length;i++){var u=a[i];e=e.add(u)}return e}var xn=new hn($);function In(){return xn}var Tn=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=a}return(0,d.Z)(e,null,[{key:"createSynthesizedRemoteEventForCurrentChange",value:function(t,n){var r=new Map;return r.set(t,En.createSynthesizedTargetChangeForCurrentChange(t,n)),new e(re.min(),r,In(),yn(),bn())}}]),e}(),En=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=a}return(0,d.Z)(e,null,[{key:"createSynthesizedTargetChangeForCurrentChange",value:function(t,n){return new e(de.EMPTY_BYTE_STRING,n,bn(),bn(),bn())}}]),e}(),Sn=(0,d.Z)((function e(t,n,r,i){(0,h.Z)(this,e),this.$=t,this.removedTargetIds=n,this.key=r,this.F=i})),An=(0,d.Z)((function e(t,n){(0,h.Z)(this,e),this.targetId=t,this.O=n})),_n=(0,d.Z)((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:de.EMPTY_BYTE_STRING,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;(0,h.Z)(this,e),this.state=t,this.targetIds=n,this.resumeToken=r,this.cause=i})),Nn=function(){function e(){(0,h.Z)(this,e),this.M=0,this.L=Cn(),this.B=de.EMPTY_BYTE_STRING,this.U=!1,this.q=!0}return(0,d.Z)(e,[{key:"current",get:function(){return this.U}},{key:"resumeToken",get:function(){return this.B}},{key:"K",get:function(){return 0!==this.M}},{key:"j",get:function(){return this.q}},{key:"W",value:function(e){e.approximateByteSize()>0&&(this.q=!0,this.B=e)}},{key:"G",value:function(){var e=bn(),t=bn(),n=bn();return this.L.forEach((function(r,i){switch(i){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:L()}})),new En(this.B,this.U,e,t,n)}},{key:"H",value:function(){this.q=!1,this.L=Cn()}},{key:"J",value:function(e,t){this.q=!0,this.L=this.L.insert(e,t)}},{key:"Y",value:function(e){this.q=!0,this.L=this.L.remove(e)}},{key:"X",value:function(){this.M+=1}},{key:"Z",value:function(){this.M-=1}},{key:"tt",value:function(){this.q=!0,this.U=!0}}]),e}(),Dn=function(){function e(t){(0,h.Z)(this,e),this.et=t,this.nt=new Map,this.st=yn(),this.it=Zn(),this.rt=new hn($)}return(0,d.Z)(e,[{key:"ot",value:function(e){var t,n=b(e.$);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.F&&e.F.isFoundDocument()?this.at(r,e.F):this.ct(r,e.key,e.F)}}catch(o){n.e(o)}finally{n.f()}var i,a=b(e.removedTargetIds);try{for(a.s();!(i=a.n()).done;){var u=i.value;this.ct(u,e.key,e.F)}}catch(o){a.e(o)}finally{a.f()}}},{key:"ut",value:function(e){var t=this;this.forEachTarget(e,(function(n){var r=t.ht(n);switch(e.state){case 0:t.lt(n)&&r.W(e.resumeToken);break;case 1:r.Z(),r.K||r.H(),r.W(e.resumeToken);break;case 2:r.Z(),r.K||t.removeTarget(n);break;case 3:t.lt(n)&&(r.tt(),r.W(e.resumeToken));break;case 4:t.lt(n)&&(t.ft(n),r.W(e.resumeToken));break;default:L()}}))}},{key:"forEachTarget",value:function(e,t){var n=this;e.targetIds.length>0?e.targetIds.forEach(t):this.nt.forEach((function(e,r){n.lt(r)&&t(r)}))}},{key:"dt",value:function(e){var t=e.targetId,n=e.O.count,r=this.wt(t);if(r){var i=r.target;if(ze(i))if(0===n){var a=new Te(i.path);this.ct(t,a,Ue.newNoDocument(a,re.min()))}else M(1===n);else this._t(t)!==n&&(this.ft(t),this.rt=this.rt.add(t))}}},{key:"gt",value:function(e){var t=this,n=new Map;this.nt.forEach((function(r,i){var a=t.wt(i);if(a){if(r.current&&ze(a.target)){var u=new Te(a.target.path);null!==t.st.get(u)||t.yt(i,u)||t.ct(i,u,Ue.newNoDocument(u,e))}r.j&&(n.set(i,r.G()),r.H())}}));var r=bn();this.it.forEach((function(e,n){var i=!0;n.forEachWhile((function(e){var n=t.wt(e);return!n||2===n.purpose||(i=!1,!1)})),i&&(r=r.add(e))}));var i=new Tn(e,n,this.rt,this.st,r);return this.st=yn(),this.it=Zn(),this.rt=new hn($),i}},{key:"at",value:function(e,t){if(this.lt(e)){var n=this.yt(e,t.key)?2:0;this.ht(e).J(t.key,n),this.st=this.st.insert(t.key,t),this.it=this.it.insert(t.key,this.Tt(t.key).add(e))}}},{key:"ct",value:function(e,t,n){if(this.lt(e)){var r=this.ht(e);this.yt(e,t)?r.J(t,1):r.Y(t),this.it=this.it.insert(t,this.Tt(t).delete(e)),n&&(this.st=this.st.insert(t,n))}}},{key:"removeTarget",value:function(e){this.nt.delete(e)}},{key:"_t",value:function(e){var t=this.ht(e).G();return this.et.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}},{key:"X",value:function(e){this.ht(e).X()}},{key:"ht",value:function(e){var t=this.nt.get(e);return t||(t=new Nn,this.nt.set(e,t)),t}},{key:"Tt",value:function(e){var t=this.it.get(e);return t||(t=new hn($),this.it=this.it.insert(e,t)),t}},{key:"lt",value:function(e){var t=null!==this.wt(e);return t||D("WatchChangeAggregator","Detected inactive target",e),t}},{key:"wt",value:function(e){var t=this.nt.get(e);return t&&t.K?null:this.et.Et(e)}},{key:"ft",value:function(e){var t=this;this.nt.set(e,new Nn),this.et.getRemoteKeysForTarget(e).forEach((function(n){t.ct(e,n,null)}))}},{key:"yt",value:function(e,t){return this.et.getRemoteKeysForTarget(e).has(t)}}]),e}();function Zn(){return new cn(Te.comparator)}function Cn(){return new cn(Te.comparator)}var Rn={asc:"ASCENDING",desc:"DESCENDING"},Ln={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Mn=(0,d.Z)((function e(t,n){(0,h.Z)(this,e),this.databaseId=t,this.C=n}));function Fn(e,t){return e.C?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function On(e,t){return e.C?t.toBase64():t.toUint8Array()}function Pn(e,t){return Fn(e,t.toTimestamp())}function Vn(e){return M(!!e),re.fromTimestamp(function(e){var t=ye(e);return new ne(t.seconds,t.nanos)}(e))}function qn(e,t){return function(e){return new se(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Un(e){var t=se.fromString(e);return M(hr(t)),t}function Bn(e,t){return qn(e.databaseId,t.path)}function Kn(e,t){var n=Un(t);if(n.get(1)!==e.databaseId.projectId)throw new V(P.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new V(P.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new Te(Qn(n))}function jn(e,t){return qn(e.databaseId,t)}function Gn(e){var t=Un(e);return 4===t.length?se.emptyPath():Qn(t)}function zn(e){return new se(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Qn(e){return M(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Wn(e,t,n){return{name:Bn(e,t),fields:n.value.mapValue.fields}}function Hn(e,t,n){var r=Kn(e,t.name),i=Vn(t.updateTime),a=new Ve({mapValue:{fields:t.fields}}),u=Ue.newFoundDocument(r,i,a);return n&&u.setHasCommittedMutations(),n?u.setHasCommittedMutations():u}function Yn(e,t){return"found"in t?function(e,t){M(!!t.found),t.found.name,t.found.updateTime;var n=Kn(e,t.found.name),r=Vn(t.found.updateTime),i=new Ve({mapValue:{fields:t.found.fields}});return Ue.newFoundDocument(n,r,i)}(e,t):"missing"in t?function(e,t){M(!!t.missing),M(!!t.readTime);var n=Kn(e,t.missing),r=Vn(t.readTime);return Ue.newNoDocument(n,r)}(e,t):L()}function Jn(e,t){var n;if(t instanceof Yt)n={update:Wn(e,t.key,t.value)};else if(t instanceof rn)n={delete:Bn(e,t.key)};else if(t instanceof Jt)n={update:Wn(e,t.key,t.data),updateMask:fr(t.fieldMask)};else{if(!(t instanceof an))return L();n={verify:Bn(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((function(e){return function(e,t){var n=t.transform;if(n instanceof Ct)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Rt)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Mt)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ot)return{fieldPath:t.field.canonicalString(),increment:n.N};throw L()}(0,e)}))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Pn(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:L()}(e,t.precondition)),n}function Xn(e,t){var n=t.currentDocument?function(e){return void 0!==e.updateTime?Bt.updateTime(Vn(e.updateTime)):void 0!==e.exists?Bt.exists(e.exists):Bt.none()}(t.currentDocument):Bt.none(),r=t.updateTransforms?t.updateTransforms.map((function(t){return function(e,t){var n=null;if("setToServerValue"in t)M("REQUEST_TIME"===t.setToServerValue),n=new Ct;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new Rt(r)}else if("removeAllFromArray"in t){var i=t.removeAllFromArray.values||[];n=new Mt(i)}else"increment"in t?n=new Ot(e,t.increment):L();var a=le.fromServerFormat(t.fieldPath);return new qt(a,n)}(e,t)})):[];if(t.update){t.update.name;var i=Kn(e,t.update.name),a=new Ve({mapValue:{fields:t.update.fields}});if(t.updateMask){var u=function(e){var t=e.fieldPaths||[];return new fe(t.map((function(e){return le.fromServerFormat(e)})))}(t.updateMask);return new Jt(i,a,u,n,r)}return new Yt(i,a,n,r)}if(t.delete){var o=Kn(e,t.delete);return new rn(o,n)}if(t.verify){var s=Kn(e,t.verify);return new an(s,n)}return L()}function $n(e,t){return{documents:[jn(e,t.path)]}}function er(e,t){var n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=jn(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=jn(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(e){if(0!==e.length){var t=e.map((function(e){return function(e){if("=="===e.op){if(Fe(e.value))return{unaryFilter:{field:or(e.field),op:"IS_NAN"}};if(Me(e.value))return{unaryFilter:{field:or(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Fe(e.value))return{unaryFilter:{field:or(e.field),op:"IS_NOT_NAN"}};if(Me(e.value))return{unaryFilter:{field:or(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:or(e.field),op:ur(e.op),value:e.value}}}(e)}));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(t.filters);i&&(n.structuredQuery.where=i);var a=function(e){if(0!==e.length)return e.map((function(e){return function(e){return{field:or(e.field),direction:ar(e.dir)}}(e)}))}(t.orderBy);a&&(n.structuredQuery.orderBy=a);var u=function(e,t){return e.C||be(t)?t:{value:t}}(e,t.limit);return null!==u&&(n.structuredQuery.limit=u),t.startAt&&(n.structuredQuery.startAt=rr(t.startAt)),t.endAt&&(n.structuredQuery.endAt=rr(t.endAt)),n}function tr(e){var t=Gn(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){M(1===r);var a=n.from[0];a.allDescendants?i=a.collectionId:t=t.child(a.collectionId)}var u=[];n.where&&(u=nr(n.where));var o=[];n.orderBy&&(o=n.orderBy.map((function(e){return function(e){return new it(sr(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)})));var s=null;n.limit&&(s=function(e){var t;return be(t="object"==typeof e?e.value:e)?null:t}(n.limit));var c=null;n.startAt&&(c=ir(n.startAt));var l=null;return n.endAt&&(l=ir(n.endAt)),ct(t,i,o,u,s,"F",c,l)}function nr(e){return e?void 0!==e.unaryFilter?[lr(e)]:void 0!==e.fieldFilter?[cr(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return nr(e)})).reduce((function(e,t){return e.concat(t)})):L():[]}function rr(e){return{before:e.before,values:e.position}}function ir(e){var t=!!e.before,n=e.values||[];return new nt(n,t)}function ar(e){return Rn[e]}function ur(e){return Ln[e]}function or(e){return{fieldPath:e.canonicalString()}}function sr(e){return le.fromServerFormat(e.fieldPath)}function cr(e){return Qe.create(sr(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return L()}}(e.fieldFilter.op),e.fieldFilter.value)}function lr(e){switch(e.unaryFilter.op){case"IS_NAN":var t=sr(e.unaryFilter.field);return Qe.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=sr(e.unaryFilter.field);return Qe.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=sr(e.unaryFilter.field);return Qe.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=sr(e.unaryFilter.field);return Qe.create(i,"!=",{nullValue:"NULL_VALUE"});default:return L()}}function fr(e){var t=[];return e.fields.forEach((function(e){return t.push(e.canonicalString())})),{fieldPaths:t}}function hr(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function dr(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t=yr(t)),t=vr(e.get(n),t);return yr(t)}function vr(e,t){for(var n=t,r=e.length,i=0;i<r;i++){var a=e.charAt(i);switch(a){case"\0":n+="";break;case"":n+="";break;default:n+=a}}return n}function yr(e){return e+""}function pr(e){var t=e.length;if(M(t>=2),2===t)return M(""===e.charAt(0)&&""===e.charAt(1)),se.emptyPath();for(var n=t-2,r=[],i="",a=0;a<t;){var u=e.indexOf("",a);switch((u<0||u>n)&&L(),e.charAt(u+1)){case"":var o=e.substring(a,u),s=void 0;0===i.length?s=o:(s=i+=o,i=""),r.push(s);break;case"":i+=e.substring(a,u),i+="\0";break;case"":i+=e.substring(a,u+1);break;default:L()}a=u+2}return new se(r)}var mr=(0,d.Z)((function e(t,n){(0,h.Z)(this,e),this.seconds=t,this.nanoseconds=n})),gr=(0,d.Z)((function e(t,n,r){(0,h.Z)(this,e),this.ownerId=t,this.allowTabSynchronization=n,this.leaseTimestampMs=r}));gr.store="owner",gr.key="owner";var kr=(0,d.Z)((function e(t,n,r){(0,h.Z)(this,e),this.userId=t,this.lastAcknowledgedBatchId=n,this.lastStreamToken=r}));kr.store="mutationQueues",kr.keyPath="userId";var wr=(0,d.Z)((function e(t,n,r,i,a){(0,h.Z)(this,e),this.userId=t,this.batchId=n,this.localWriteTimeMs=r,this.baseMutations=i,this.mutations=a}));wr.store="mutations",wr.keyPath="batchId",wr.userMutationsIndex="userMutationsIndex",wr.userMutationsKeyPath=["userId","batchId"];var br=function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,null,[{key:"prefixForUser",value:function(e){return[e]}},{key:"prefixForPath",value:function(e,t){return[e,dr(t)]}},{key:"key",value:function(e,t,n){return[e,dr(t),n]}}]),e}();br.store="documentMutations",br.PLACEHOLDER=new br;var xr=(0,d.Z)((function e(t,n){(0,h.Z)(this,e),this.path=t,this.readTime=n})),Ir=(0,d.Z)((function e(t,n){(0,h.Z)(this,e),this.path=t,this.version=n})),Tr=(0,d.Z)((function e(t,n,r,i,a,u){(0,h.Z)(this,e),this.unknownDocument=t,this.noDocument=n,this.document=r,this.hasCommittedMutations=i,this.readTime=a,this.parentPath=u}));Tr.store="remoteDocuments",Tr.readTimeIndex="readTimeIndex",Tr.readTimeIndexPath="readTime",Tr.collectionReadTimeIndex="collectionReadTimeIndex",Tr.collectionReadTimeIndexPath=["parentPath","readTime"];var Er=(0,d.Z)((function e(t){(0,h.Z)(this,e),this.byteSize=t}));Er.store="remoteDocumentGlobal",Er.key="remoteDocumentGlobalKey";var Sr=(0,d.Z)((function e(t,n,r,i,a,u,o){(0,h.Z)(this,e),this.targetId=t,this.canonicalId=n,this.readTime=r,this.resumeToken=i,this.lastListenSequenceNumber=a,this.lastLimboFreeSnapshotVersion=u,this.query=o}));Sr.store="targets",Sr.keyPath="targetId",Sr.queryTargetsIndexName="queryTargetsIndex",Sr.queryTargetsKeyPath=["canonicalId","targetId"];var Ar=(0,d.Z)((function e(t,n,r){(0,h.Z)(this,e),this.targetId=t,this.path=n,this.sequenceNumber=r}));Ar.store="targetDocuments",Ar.keyPath=["targetId","path"],Ar.documentTargetsIndex="documentTargetsIndex",Ar.documentTargetsKeyPath=["path","targetId"];var _r=(0,d.Z)((function e(t,n,r,i){(0,h.Z)(this,e),this.highestTargetId=t,this.highestListenSequenceNumber=n,this.lastRemoteSnapshotVersion=r,this.targetCount=i}));_r.key="targetGlobalKey",_r.store="targetGlobal";var Nr=(0,d.Z)((function e(t,n){(0,h.Z)(this,e),this.collectionId=t,this.parent=n}));Nr.store="collectionParents",Nr.keyPath=["collectionId","parent"];var Dr=(0,d.Z)((function e(t,n,r,i){(0,h.Z)(this,e),this.clientId=t,this.updateTimeMs=n,this.networkEnabled=r,this.inForeground=i}));Dr.store="clientMetadata",Dr.keyPath="clientId";var Zr=(0,d.Z)((function e(t,n,r){(0,h.Z)(this,e),this.bundleId=t,this.createTime=n,this.version=r}));Zr.store="bundles",Zr.keyPath="bundleId";var Cr=(0,d.Z)((function e(t,n,r){(0,h.Z)(this,e),this.name=t,this.readTime=n,this.bundledQuery=r}));Cr.store="namedQueries",Cr.keyPath="name";var Rr=[kr.store,wr.store,br.store,Tr.store,Sr.store,gr.store,_r.store,Ar.store].concat([Dr.store]).concat([Er.store]).concat([Nr.store]).concat([Zr.store,Cr.store]),Lr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Mr=function(){function e(){(0,h.Z)(this,e),this.onCommittedListeners=[]}return(0,d.Z)(e,[{key:"addOnCommittedListener",value:function(e){this.onCommittedListeners.push(e)}},{key:"raiseOnCommittedEvent",value:function(){this.onCommittedListeners.forEach((function(e){return e()}))}}]),e}(),Fr=function(){function e(t){var n=this;(0,h.Z)(this,e),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(e){n.isDone=!0,n.result=e,n.nextCallback&&n.nextCallback(e)}),(function(e){n.isDone=!0,n.error=e,n.catchCallback&&n.catchCallback(e)}))}return(0,d.Z)(e,[{key:"catch",value:function(e){return this.next(void 0,e)}},{key:"next",value:function(t,n){var r=this;return this.callbackAttached&&L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e((function(e,i){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,i)},r.catchCallback=function(t){r.wrapFailure(n,t).next(e,i)}}))}},{key:"toPromise",value:function(){var e=this;return new Promise((function(t,n){e.next(t,n)}))}},{key:"wrapUserFunction",value:function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}}},{key:"wrapSuccess",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.resolve(n)}},{key:"wrapFailure",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.reject(n)}}],[{key:"resolve",value:function(t){return new e((function(e,n){e(t)}))}},{key:"reject",value:function(t){return new e((function(e,n){n(t)}))}},{key:"waitFor",value:function(t){return new e((function(e,n){var r=0,i=0,a=!1;t.forEach((function(t){++r,t.next((function(){++i,a&&i===r&&e()}),(function(e){return n(e)}))})),a=!0,i===r&&e()}))}},{key:"or",value:function(t){var n,r=e.resolve(!1),i=b(t);try{var a=function(){var t=n.value;r=r.next((function(n){return n?e.resolve(n):t()}))};for(i.s();!(n=i.n()).done;)a()}catch(u){i.e(u)}finally{i.f()}return r}},{key:"forEach",value:function(e,t){var n=this,r=[];return e.forEach((function(e,i){r.push(t.call(n,e,i))})),this.waitFor(r)}}]),e}(),Or=function(){function e(t,n){var r=this;(0,h.Z)(this,e),this.action=t,this.transaction=n,this.aborted=!1,this.It=new q,this.transaction.oncomplete=function(){r.It.resolve()},this.transaction.onabort=function(){n.error?r.It.reject(new qr(t,n.error)):r.It.resolve()},this.transaction.onerror=function(e){var n=Gr(e.target.error);r.It.reject(new qr(t,n))}}return(0,d.Z)(e,[{key:"At",get:function(){return this.It.promise}},{key:"abort",value:function(e){e&&this.It.reject(e),this.aborted||(D("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}},{key:"store",value:function(e){var t=this.transaction.objectStore(e);return new Br(t)}}],[{key:"open",value:function(t,n,r,i){try{return new e(n,t.transaction(i,r))}catch(t){throw new qr(n,t)}}}]),e}(),Pr=function(){function e(t,n,r){(0,h.Z)(this,e),this.name=t,this.version=n,this.Rt=r,12.2===e.Pt((0,k.z$)())&&Z("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}var t,n;return(0,d.Z)(e,[{key:"Ct",value:(n=(0,u.Z)(y().mark((function e(t){var n=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.db,e.t0){e.next=6;break}return D("SimpleDb","Opening database:",this.name),e.next=5,new Promise((function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){var n=t.target.result;e(n)},i.onblocked=function(){r(new qr(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new V(P.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new V(P.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new qr(t,n))},i.onupgradeneeded=function(e){D("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;n.Rt.Nt(t,i.transaction,e.oldVersion,n.version).next((function(){D("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}));case 5:this.db=e.sent;case 6:return this.kt&&(this.db.onversionchange=function(e){return n.kt(e)}),e.abrupt("return",this.db);case 8:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"xt",value:function(e){this.kt=e,this.db&&(this.db.onversionchange=function(t){return e(t)})}},{key:"runTransaction",value:(t=(0,u.Z)(y().mark((function e(t,n,r,i){var a,u,o,s,c=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a="readonly"===n,u=0;case 2:return++u,e.prev=3,e.delegateYield(y().mark((function e(){var n,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,c.Ct(t);case 2:return c.db=e.sent,n=Or.open(c.db,t,a?"readonly":"readwrite",r),u=i(n).catch((function(e){return n.abort(e),Fr.reject(e)})).toPromise(),u.catch((function(){})),e.next=7,n.At;case 7:return e.t0=u,e.abrupt("return",{v:e.t0});case 9:case"end":return e.stop()}}),e)}))(),"t0",5);case 5:if("object"!=typeof(o=e.t0)){e.next=8;break}return e.abrupt("return",o.v);case 8:e.next=15;break;case 10:if(e.prev=10,e.t1=e.catch(3),s="FirebaseError"!==e.t1.name&&u<3,D("SimpleDb","Transaction failed with error:",e.t1.message,"Retrying:",s),this.close(),s){e.next=15;break}return e.abrupt("return",Promise.reject(e.t1));case 15:e.next=2;break;case 17:case"end":return e.stop()}}),e,this,[[3,10]])}))),function(e,n,r,i){return t.apply(this,arguments)})},{key:"close",value:function(){this.db&&this.db.close(),this.db=void 0}}],[{key:"delete",value:function(e){return D("SimpleDb","Removing database:",e),Kr(window.indexedDB.deleteDatabase(e)).toPromise()}},{key:"bt",value:function(){if(!(0,k.hl)())return!1;if(e.vt())return!0;var t=(0,k.z$)(),n=e.Pt(t),r=0<n&&n<10,i=e.Vt(t),a=0<i&&i<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||a)}},{key:"vt",value:function(){var e;return"undefined"!=typeof process&&"YES"===(null===(e={})||void 0===e?void 0:e.St)}},{key:"Dt",value:function(e,t){return e.store(t)}},{key:"Pt",value:function(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}},{key:"Vt",value:function(e){var t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}}]),e}(),Vr=function(){function e(t){(0,h.Z)(this,e),this.$t=t,this.Ft=!1,this.Ot=null}return(0,d.Z)(e,[{key:"isDone",get:function(){return this.Ft}},{key:"Mt",get:function(){return this.Ot}},{key:"cursor",set:function(e){this.$t=e}},{key:"done",value:function(){this.Ft=!0}},{key:"Lt",value:function(e){this.Ot=e}},{key:"delete",value:function(){return Kr(this.$t.delete())}}]),e}(),qr=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,P.UNAVAILABLE,"IndexedDB transaction '".concat(e,"' failed: ").concat(r))).name="IndexedDbTransactionError",i}return(0,d.Z)(n)}(V);function Ur(e){return"IndexedDbTransactionError"===e.name}var Br=function(){function e(t){(0,h.Z)(this,e),this.store=t}return(0,d.Z)(e,[{key:"put",value:function(e,t){var n;return void 0!==t?(D("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(D("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),Kr(n)}},{key:"add",value:function(e){return D("SimpleDb","ADD",this.store.name,e,e),Kr(this.store.add(e))}},{key:"get",value:function(e){var t=this;return Kr(this.store.get(e)).next((function(n){return void 0===n&&(n=null),D("SimpleDb","GET",t.store.name,e,n),n}))}},{key:"delete",value:function(e){return D("SimpleDb","DELETE",this.store.name,e),Kr(this.store.delete(e))}},{key:"count",value:function(){return D("SimpleDb","COUNT",this.store.name),Kr(this.store.count())}},{key:"Bt",value:function(e,t){var n=this.cursor(this.options(e,t)),r=[];return this.Ut(n,(function(e,t){r.push(t)})).next((function(){return r}))}},{key:"qt",value:function(e,t){D("SimpleDb","DELETE ALL",this.store.name);var n=this.options(e,t);n.Kt=!1;var r=this.cursor(n);return this.Ut(r,(function(e,t,n){return n.delete()}))}},{key:"jt",value:function(e,t){var n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.Ut(r,t)}},{key:"Qt",value:function(e){var t=this.cursor({});return new Fr((function(n,r){t.onerror=function(e){var t=Gr(e.target.error);r(t)},t.onsuccess=function(t){var r=t.target.result;r?e(r.primaryKey,r.value).next((function(e){e?r.continue():n()})):n()}}))}},{key:"Ut",value:function(e,t){var n=[];return new Fr((function(r,i){e.onerror=function(e){i(e.target.error)},e.onsuccess=function(e){var i=e.target.result;if(i){var a=new Vr(i),u=t(i.primaryKey,i.value,a);if(u instanceof Fr){var o=u.catch((function(e){return a.done(),Fr.reject(e)}));n.push(o)}a.isDone?r():null===a.Mt?i.continue():i.continue(a.Mt)}else r()}})).next((function(){return Fr.waitFor(n)}))}},{key:"options",value:function(e,t){var n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}},{key:"cursor",value:function(e){var t="next";if(e.reverse&&(t="prev"),e.index){var n=this.store.index(e.index);return e.Kt?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}]),e}();function Kr(e){return new Fr((function(t,n){e.onsuccess=function(e){var n=e.target.result;t(n)},e.onerror=function(e){var t=Gr(e.target.error);n(t)}}))}var jr=!1;function Gr(e){var t=Pr.Pt((0,k.z$)());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new V("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '".concat(n,"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround."));return jr||(jr=!0,setTimeout((function(){throw r}),0)),r}}return e}var zr=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).Wt=e,i.currentSequenceNumber=r,i}return(0,d.Z)(n)}(Mr);function Qr(e,t){var n=O(e);return Pr.Dt(n.Wt,t)}var Wr=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=i}return(0,d.Z)(e,[{key:"applyToRemoteDocument",value:function(e,t){for(var n=t.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(e.key)&&Gt(i,e,n[r])}}},{key:"applyToLocalView",value:function(e){var t,n=b(this.baseMutations);try{for(n.s();!(t=n.n()).done;){var r=t.value;r.key.isEqual(e.key)&&zt(r,e,this.localWriteTime)}}catch(o){n.e(o)}finally{n.f()}var i,a=b(this.mutations);try{for(a.s();!(i=a.n()).done;){var u=i.value;u.key.isEqual(e.key)&&zt(u,e,this.localWriteTime)}}catch(o){a.e(o)}finally{a.f()}}},{key:"applyToLocalDocumentSet",value:function(e){var t=this;this.mutations.forEach((function(n){var r=e.get(n.key),i=r;t.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(re.min())}))}},{key:"keys",value:function(){return this.mutations.reduce((function(e,t){return e.add(t.key)}),bn())}},{key:"isEqual",value:function(e){return this.batchId===e.batchId&&ee(this.mutations,e.mutations,(function(e,t){return Wt(e,t)}))&&ee(this.baseMutations,e.baseMutations,(function(e,t){return Wt(e,t)}))}}]),e}(),Hr=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=i}return(0,d.Z)(e,null,[{key:"from",value:function(t,n,r){M(t.mutations.length===r.length);for(var i=kn(),a=t.mutations,u=0;u<a.length;u++)i=i.insert(a[u].key,r[u].version);return new e(t,n,r,i)}}]),e}(),Yr=function(){function e(t,n,r,i){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:re.min(),u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:re.min(),o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:de.EMPTY_BYTE_STRING;(0,h.Z)(this,e),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=a,this.lastLimboFreeSnapshotVersion=u,this.resumeToken=o}return(0,d.Z)(e,[{key:"withSequenceNumber",value:function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}},{key:"withResumeToken",value:function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t)}},{key:"withLastLimboFreeSnapshotVersion",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}]),e}(),Jr=(0,d.Z)((function e(t){(0,h.Z)(this,e),this.Gt=t}));function Xr(e,t){if(t.document)return Hn(e.Gt,t.document,!!t.hasCommittedMutations);if(t.noDocument){var n=Te.fromSegments(t.noDocument.path),r=ri(t.noDocument.readTime),i=Ue.newNoDocument(n,r);return t.hasCommittedMutations?i.setHasCommittedMutations():i}if(t.unknownDocument){var a=Te.fromSegments(t.unknownDocument.path),u=ri(t.unknownDocument.version);return Ue.newUnknownDocument(a,u)}return L()}function $r(e,t,n){var r=ei(n),i=t.key.path.popLast().toArray();if(t.isFoundDocument()){var a=function(e,t){return{name:Bn(e,t.key),fields:t.data.value.mapValue.fields,updateTime:Fn(e,t.version.toTimestamp())}}(e.Gt,t),u=t.hasCommittedMutations;return new Tr(null,null,a,u,r,i)}if(t.isNoDocument()){var o=t.key.path.toArray(),s=ni(t.version),c=t.hasCommittedMutations;return new Tr(null,new xr(o,s),null,c,r,i)}if(t.isUnknownDocument()){var l=t.key.path.toArray(),f=ni(t.version);return new Tr(new Ir(l,f),null,null,!0,r,i)}return L()}function ei(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function ti(e){var t=new ne(e[0],e[1]);return re.fromTimestamp(t)}function ni(e){var t=e.toTimestamp();return new mr(t.seconds,t.nanoseconds)}function ri(e){var t=new ne(e.seconds,e.nanoseconds);return re.fromTimestamp(t)}function ii(e,t){for(var n=(t.baseMutations||[]).map((function(t){return Xn(e.Gt,t)})),r=0;r<t.mutations.length-1;++r){var i=t.mutations[r];if(r+1<t.mutations.length&&void 0!==t.mutations[r+1].transform){var a=t.mutations[r+1];i.updateTransforms=a.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}var u=t.mutations.map((function(t){return Xn(e.Gt,t)})),o=ne.fromMillis(t.localWriteTimeMs);return new Wr(t.batchId,o,n,u)}function ai(e){var t,n,r=ri(e.readTime),i=void 0!==e.lastLimboFreeSnapshotVersion?ri(e.lastLimboFreeSnapshotVersion):re.min();return void 0!==e.query.documents?(M(1===(n=e.query).documents.length),t=mt(lt(Gn(n.documents[0])))):t=function(e){return mt(tr(e))}(e.query),new Yr(t,e.targetId,0,e.lastListenSequenceNumber,r,i,de.fromBase64String(e.resumeToken))}function ui(e,t){var n,r=ni(t.snapshotVersion),i=ni(t.lastLimboFreeSnapshotVersion);n=ze(t.target)?$n(e.Gt,t.target):er(e.Gt,t.target);var a=t.resumeToken.toBase64();return new Sr(t.targetId,je(t.target),r,a,t.sequenceNumber,i,n)}function oi(e){var t=tr({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?gt(t,t.limit,"L"):t}var si=function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,[{key:"getBundleMetadata",value:function(e,t){return ci(e).get(t).next((function(e){if(e)return{id:(t=e).bundleId,createTime:ri(t.createTime),version:t.version};var t}))}},{key:"saveBundleMetadata",value:function(e,t){return ci(e).put({bundleId:(n=t).id,createTime:ni(Vn(n.createTime)),version:n.version});var n}},{key:"getNamedQuery",value:function(e,t){return li(e).get(t).next((function(e){if(e)return{name:(t=e).name,query:oi(t.bundledQuery),readTime:ri(t.readTime)};var t}))}},{key:"saveNamedQuery",value:function(e,t){return li(e).put(function(e){return{name:e.name,readTime:ni(Vn(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}]),e}();function ci(e){return Qr(e,Zr.store)}function li(e){return Qr(e,Cr.store)}var fi=function(){function e(){(0,h.Z)(this,e),this.zt=new hi}return(0,d.Z)(e,[{key:"addToCollectionParentIndex",value:function(e,t){return this.zt.add(t),Fr.resolve()}},{key:"getCollectionParents",value:function(e,t){return Fr.resolve(this.zt.getEntries(t))}}]),e}(),hi=function(){function e(){(0,h.Z)(this,e),this.index={}}return(0,d.Z)(e,[{key:"add",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new hn(se.comparator),i=!r.has(n);return this.index[t]=r.add(n),i}},{key:"has",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}},{key:"getEntries",value:function(e){return(this.index[e]||new hn(se.comparator)).toArray()}}]),e}(),di=function(){function e(){(0,h.Z)(this,e),this.Ht=new hi}return(0,d.Z)(e,[{key:"addToCollectionParentIndex",value:function(e,t){var n=this;if(!this.Ht.has(t)){var r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener((function(){n.Ht.add(t)}));var a={collectionId:r,parent:dr(i)};return vi(e).put(a)}return Fr.resolve()}},{key:"getCollectionParents",value:function(e,t){var n=[],r=IDBKeyRange.bound([t,""],[te(t),""],!1,!0);return vi(e).Bt(r).next((function(e){var r,i=b(e);try{for(i.s();!(r=i.n()).done;){var a=r.value;if(a.collectionId!==t)break;n.push(pr(a.parent))}}catch(u){i.e(u)}finally{i.f()}return n}))}}]),e}();function vi(e){return Qr(e,Nr.store)}var yi={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},pi=function(){function e(t,n,r){(0,h.Z)(this,e),this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return(0,d.Z)(e,null,[{key:"withCacheSize",value:function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]),e}();function mi(e,t,n){var r=e.store(wr.store),i=e.store(br.store),a=[],u=IDBKeyRange.only(n.batchId),o=0,s=r.jt({range:u},(function(e,t,n){return o++,n.delete()}));a.push(s.next((function(){M(1===o)})));var c,l=[],f=b(n.mutations);try{for(f.s();!(c=f.n()).done;){var h=c.value,d=br.key(t,h.key.path,n.batchId);a.push(i.delete(d)),l.push(h.key)}}catch(v){f.e(v)}finally{f.f()}return Fr.waitFor(a).next((function(){return l}))}function gi(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw L();t=e.noDocument}return JSON.stringify(t).length}pi.DEFAULT_COLLECTION_PERCENTILE=10,pi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,pi.DEFAULT=new pi(41943040,pi.DEFAULT_COLLECTION_PERCENTILE,pi.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),pi.DISABLED=new pi(-1,0,0);var ki=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.userId=t,this.k=n,this.Jt=r,this.referenceDelegate=i,this.Yt={}}return(0,d.Z)(e,[{key:"checkEmpty",value:function(e){var t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return bi(e).jt({index:wr.userMutationsIndex,range:n},(function(e,n,r){t=!1,r.done()})).next((function(){return t}))}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this,a=xi(e),u=bi(e);return u.add({}).next((function(o){M("number"==typeof o);var s,c=new Wr(o,t,n,r),l=function(e,t,n){var r=n.baseMutations.map((function(t){return Jn(e.Gt,t)})),i=n.mutations.map((function(t){return Jn(e.Gt,t)}));return new wr(t,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.k,i.userId,c),f=[],h=new hn((function(e,t){return $(e.canonicalString(),t.canonicalString())})),d=b(r);try{for(d.s();!(s=d.n()).done;){var v=s.value,y=br.key(i.userId,v.key.path,o);h=h.add(v.key.path.popLast()),f.push(u.put(l)),f.push(a.put(y,br.PLACEHOLDER))}}catch(p){d.e(p)}finally{d.f()}return h.forEach((function(t){f.push(i.Jt.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((function(){i.Yt[o]=c.keys()})),Fr.waitFor(f).next((function(){return c}))}))}},{key:"lookupMutationBatch",value:function(e,t){var n=this;return bi(e).get(t).next((function(e){return e?(M(e.userId===n.userId),ii(n.k,e)):null}))}},{key:"Zt",value:function(e,t){var n=this;return this.Yt[t]?Fr.resolve(this.Yt[t]):this.lookupMutationBatch(e,t).next((function(e){if(e){var r=e.keys();return n.Yt[t]=r,r}return null}))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=this,r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),a=null;return bi(e).jt({index:wr.userMutationsIndex,range:i},(function(e,t,i){t.userId===n.userId&&(M(t.batchId>=r),a=ii(n.k,t)),i.done()})).next((function(){return a}))}},{key:"getHighestUnacknowledgedBatchId",value:function(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return bi(e).jt({index:wr.userMutationsIndex,range:t,reverse:!0},(function(e,t,r){n=t.batchId,r.done()})).next((function(){return n}))}},{key:"getAllMutationBatches",value:function(e){var t=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return bi(e).Bt(wr.userMutationsIndex,n).next((function(e){return e.map((function(e){return ii(t.k,e)}))}))}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=br.prefixForPath(this.userId,t.path),i=IDBKeyRange.lowerBound(r),u=[];return xi(e).jt({range:i},(function(r,i,o){var s=(0,a.Z)(r,3),c=s[0],l=s[1],f=s[2],h=pr(l);if(c===n.userId&&t.path.isEqual(h))return bi(e).get(f).next((function(e){if(!e)throw L();M(e.userId===n.userId),u.push(ii(n.k,e))}));o.done()})).next((function(){return u}))}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new hn($),i=[];return t.forEach((function(t){var u=br.prefixForPath(n.userId,t.path),o=IDBKeyRange.lowerBound(u),s=xi(e).jt({range:o},(function(e,i,u){var o=(0,a.Z)(e,3),s=o[0],c=o[1],l=o[2],f=pr(c);s===n.userId&&t.path.isEqual(f)?r=r.add(l):u.done()}));i.push(s)})),Fr.waitFor(i).next((function(){return n.te(e,r)}))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=this,r=t.path,i=r.length+1,u=br.prefixForPath(this.userId,r),o=IDBKeyRange.lowerBound(u),s=new hn($);return xi(e).jt({range:o},(function(e,t,u){var o=(0,a.Z)(e,3),c=o[0],l=o[1],f=o[2],h=pr(l);c===n.userId&&r.isPrefixOf(h)?h.length===i&&(s=s.add(f)):u.done()})).next((function(){return n.te(e,s)}))}},{key:"te",value:function(e,t){var n=this,r=[],i=[];return t.forEach((function(t){i.push(bi(e).get(t).next((function(e){if(null===e)throw L();M(e.userId===n.userId),r.push(ii(n.k,e))})))})),Fr.waitFor(i).next((function(){return r}))}},{key:"removeMutationBatch",value:function(e,t){var n=this;return mi(e.Wt,this.userId,t).next((function(r){return e.addOnCommittedListener((function(){n.ee(t.batchId)})),Fr.forEach(r,(function(t){return n.referenceDelegate.markPotentiallyOrphaned(e,t)}))}))}},{key:"ee",value:function(e){delete this.Yt[e]}},{key:"performConsistencyCheck",value:function(e){var t=this;return this.checkEmpty(e).next((function(n){if(!n)return Fr.resolve();var r=IDBKeyRange.lowerBound(br.prefixForUser(t.userId)),i=[];return xi(e).jt({range:r},(function(e,n,r){if(e[0]===t.userId){var a=pr(e[1]);i.push(a)}else r.done()})).next((function(){M(0===i.length)}))}))}},{key:"containsKey",value:function(e,t){return wi(e,this.userId,t)}},{key:"ne",value:function(e){var t=this;return Ii(e).get(this.userId).next((function(e){return e||new kr(t.userId,-1,"")}))}}],[{key:"Xt",value:function(t,n,r,i){return M(""!==t.uid),new e(t.isAuthenticated()?t.uid:"",n,r,i)}}]),e}();function wi(e,t,n){var r=br.prefixForPath(t,n.path),i=r[1],u=IDBKeyRange.lowerBound(r),o=!1;return xi(e).jt({range:u,Kt:!0},(function(e,n,r){var u=(0,a.Z)(e,3),s=u[0],c=u[1];u[2];s===t&&c===i&&(o=!0),r.done()})).next((function(){return o}))}function bi(e){return Qr(e,wr.store)}function xi(e){return Qr(e,br.store)}function Ii(e){return Qr(e,kr.store)}var Ti=function(){function e(t){(0,h.Z)(this,e),this.se=t}return(0,d.Z)(e,[{key:"next",value:function(){return this.se+=2,this.se}}],[{key:"ie",value:function(){return new e(0)}},{key:"re",value:function(){return new e(-1)}}]),e}(),Ei=function(){function e(t,n){(0,h.Z)(this,e),this.referenceDelegate=t,this.k=n}return(0,d.Z)(e,[{key:"allocateTargetId",value:function(e){var t=this;return this.oe(e).next((function(n){var r=new Ti(n.highestTargetId);return n.highestTargetId=r.next(),t.ae(e,n).next((function(){return n.highestTargetId}))}))}},{key:"getLastRemoteSnapshotVersion",value:function(e){return this.oe(e).next((function(e){return re.fromTimestamp(new ne(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))}))}},{key:"getHighestSequenceNumber",value:function(e){return this.oe(e).next((function(e){return e.highestListenSequenceNumber}))}},{key:"setTargetsMetadata",value:function(e,t,n){var r=this;return this.oe(e).next((function(i){return i.highestListenSequenceNumber=t,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),r.ae(e,i)}))}},{key:"addTargetData",value:function(e,t){var n=this;return this.ce(e,t).next((function(){return n.oe(e).next((function(r){return r.targetCount+=1,n.ue(t,r),n.ae(e,r)}))}))}},{key:"updateTargetData",value:function(e,t){return this.ce(e,t)}},{key:"removeTargetData",value:function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next((function(){return Si(e).delete(t.targetId)})).next((function(){return n.oe(e)})).next((function(t){return M(t.targetCount>0),t.targetCount-=1,n.ae(e,t)}))}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return Si(e).jt((function(u,o){var s=ai(o);s.sequenceNumber<=t&&null===n.get(s.targetId)&&(i++,a.push(r.removeTargetData(e,s)))})).next((function(){return Fr.waitFor(a)})).next((function(){return i}))}},{key:"forEachTarget",value:function(e,t){return Si(e).jt((function(e,n){var r=ai(n);t(r)}))}},{key:"oe",value:function(e){return Ai(e).get(_r.key).next((function(e){return M(null!==e),e}))}},{key:"ae",value:function(e,t){return Ai(e).put(_r.key,t)}},{key:"ce",value:function(e,t){return Si(e).put(ui(this.k,t))}},{key:"ue",value:function(e,t){var n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}},{key:"getTargetCount",value:function(e){return this.oe(e).next((function(e){return e.targetCount}))}},{key:"getTargetData",value:function(e,t){var n=je(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Si(e).jt({range:r,index:Sr.queryTargetsIndexName},(function(e,n,r){var a=ai(n);Ge(t,a.target)&&(i=a,r.done())})).next((function(){return i}))}},{key:"addMatchingKeys",value:function(e,t,n){var r=this,i=[],a=_i(e);return t.forEach((function(t){var u=dr(t.path);i.push(a.put(new Ar(n,u))),i.push(r.referenceDelegate.addReference(e,n,t))})),Fr.waitFor(i)}},{key:"removeMatchingKeys",value:function(e,t,n){var r=this,i=_i(e);return Fr.forEach(t,(function(t){var a=dr(t.path);return Fr.waitFor([i.delete([n,a]),r.referenceDelegate.removeReference(e,n,t)])}))}},{key:"removeMatchingKeysForTargetId",value:function(e,t){var n=_i(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=IDBKeyRange.bound([t],[t+1],!1,!0),r=_i(e),i=bn();return r.jt({range:n,Kt:!0},(function(e,t,n){var r=pr(e[1]),a=new Te(r);i=i.add(a)})).next((function(){return i}))}},{key:"containsKey",value:function(e,t){var n=dr(t.path),r=IDBKeyRange.bound([n],[te(n)],!1,!0),i=0;return _i(e).jt({index:Ar.documentTargetsIndex,Kt:!0,range:r},(function(e,t,n){var r=(0,a.Z)(e,2),u=r[0];r[1];0!==u&&(i++,n.done())})).next((function(){return i>0}))}},{key:"Et",value:function(e,t){return Si(e).get(t).next((function(e){return e?ai(e):null}))}}]),e}();function Si(e){return Qr(e,Sr.store)}function Ai(e){return Qr(e,_r.store)}function _i(e){return Qr(e,Ar.store)}function Ni(e){return Di.apply(this,arguments)}function Di(){return(Di=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.code===P.FAILED_PRECONDITION&&t.message===Lr){e.next=2;break}throw t;case 2:D("LocalStore","Unexpectedly lost primary lease");case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zi(e,t){var n=(0,a.Z)(e,2),r=n[0],i=n[1],u=(0,a.Z)(t,2),o=u[0],s=u[1],c=$(r,o);return 0===c?$(i,s):c}var Ci=function(){function e(t){(0,h.Z)(this,e),this.he=t,this.buffer=new hn(Zi),this.le=0}return(0,d.Z)(e,[{key:"fe",value:function(){return++this.le}},{key:"de",value:function(e){var t=[e,this.fe()];if(this.buffer.size<this.he)this.buffer=this.buffer.add(t);else{var n=this.buffer.last();Zi(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}},{key:"maxValue",get:function(){return this.buffer.last()[0]}}]),e}(),Ri=function(){function e(t,n){(0,h.Z)(this,e),this.garbageCollector=t,this.asyncQueue=n,this.we=!1,this._e=null}return(0,d.Z)(e,[{key:"start",value:function(e){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.me(e)}},{key:"stop",value:function(){this._e&&(this._e.cancel(),this._e=null)}},{key:"started",get:function(){return null!==this._e}},{key:"me",value:function(e){var t=this,n=this.we?3e5:6e4;D("LruGarbageCollector","Garbage collection scheduled in ".concat(n,"ms")),this._e=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,(0,u.Z)(y().mark((function n(){return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t._e=null,t.we=!0,n.prev=1,n.next=4,e.collectGarbage(t.garbageCollector);case 4:n.next=14;break;case 6:if(n.prev=6,n.t0=n.catch(1),!Ur(n.t0)){n.next=12;break}D("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",n.t0),n.next=14;break;case 12:return n.next=14,Ni(n.t0);case 14:return n.next=16,t.me(e);case 16:case"end":return n.stop()}}),n,null,[[1,6]])}))))}}]),e}(),Li=function(){function e(t,n){(0,h.Z)(this,e),this.ge=t,this.params=n}return(0,d.Z)(e,[{key:"calculateTargetCount",value:function(e,t){return this.ge.ye(e).next((function(e){return Math.floor(t/100*e)}))}},{key:"nthSequenceNumber",value:function(e,t){var n=this;if(0===t)return Fr.resolve(Y.I);var r=new Ci(t);return this.ge.forEachTarget(e,(function(e){return r.de(e.sequenceNumber)})).next((function(){return n.ge.pe(e,(function(e){return r.de(e)}))})).next((function(){return r.maxValue}))}},{key:"removeTargets",value:function(e,t,n){return this.ge.removeTargets(e,t,n)}},{key:"removeOrphanedDocuments",value:function(e,t){return this.ge.removeOrphanedDocuments(e,t)}},{key:"collect",value:function(e,t){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector","Garbage collection skipped; disabled"),Fr.resolve(yi)):this.getCacheSize(e).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(r," is lower than threshold ").concat(n.params.cacheSizeCollectionThreshold)),yi):n.Te(e,t)}))}},{key:"getCacheSize",value:function(e){return this.ge.getCacheSize(e)}},{key:"Te",value:function(e,t){var n,r,i,a,u,o,s,c=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((function(t){return t>c.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(c.params.maximumSequenceNumbersToCollect," from ").concat(t)),r=c.params.maximumSequenceNumbersToCollect):r=t,a=Date.now(),c.nthSequenceNumber(e,r)})).next((function(r){return n=r,u=Date.now(),c.removeTargets(e,n,t)})).next((function(t){return i=t,o=Date.now(),c.removeOrphanedDocuments(e,n)})).next((function(e){return s=Date.now(),_()<=g.in.DEBUG&&D("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(a-l,"ms\n\tDetermined least recently used ").concat(r," in ")+(u-a)+"ms\n"+"\tRemoved ".concat(i," targets in ")+(o-u)+"ms\n"+"\tRemoved ".concat(e," documents in ")+(s-o)+"ms\n"+"Total Duration: ".concat(s-l,"ms")),Fr.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:e})}))}}]),e}(),Mi=function(){function e(t,n){(0,h.Z)(this,e),this.db=t,this.garbageCollector=function(e,t){return new Li(e,t)}(this,n)}return(0,d.Z)(e,[{key:"ye",value:function(e){var t=this.Ee(e);return this.db.getTargetCache().getTargetCount(e).next((function(e){return t.next((function(t){return e+t}))}))}},{key:"Ee",value:function(e){var t=0;return this.pe(e,(function(e){t++})).next((function(){return t}))}},{key:"forEachTarget",value:function(e,t){return this.db.getTargetCache().forEachTarget(e,t)}},{key:"pe",value:function(e,t){return this.Ie(e,(function(e,n){return t(n)}))}},{key:"addReference",value:function(e,t,n){return Fi(e,n)}},{key:"removeReference",value:function(e,t,n){return Fi(e,n)}},{key:"removeTargets",value:function(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}},{key:"markPotentiallyOrphaned",value:function(e,t){return Fi(e,t)}},{key:"Ae",value:function(e,t){return function(e,t){var n=!1;return Ii(e).Qt((function(r){return wi(e,r,t).next((function(e){return e&&(n=!0),Fr.resolve(!e)}))})).next((function(){return n}))}(e,t)}},{key:"removeOrphanedDocuments",value:function(e,t){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],a=0;return this.Ie(e,(function(u,o){if(o<=t){var s=n.Ae(e,u).next((function(t){if(!t)return a++,r.getEntry(e,u).next((function(){return r.removeEntry(u),_i(e).delete([0,dr(u.path)])}))}));i.push(s)}})).next((function(){return Fr.waitFor(i)})).next((function(){return r.apply(e)})).next((function(){return a}))}},{key:"removeTarget",value:function(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}},{key:"updateLimboDocument",value:function(e,t){return Fi(e,t)}},{key:"Ie",value:function(e,t){var n,r=_i(e),i=Y.I;return r.jt({index:Ar.documentTargetsIndex},(function(e,r){var u=(0,a.Z)(e,2),o=u[0],s=(u[1],r.path),c=r.sequenceNumber;0===o?(i!==Y.I&&t(new Te(pr(n)),i),i=c,n=s):i=Y.I})).next((function(){i!==Y.I&&t(new Te(pr(n)),i)}))}},{key:"getCacheSize",value:function(e){return this.db.getRemoteDocumentCache().getSize(e)}}]),e}();function Fi(e,t){return _i(e).put(function(e,t){return new Ar(0,dr(e.path),t)}(t,e.currentSequenceNumber))}var Oi=function(){function e(t,n){(0,h.Z)(this,e),this.mapKeyFn=t,this.equalsFn=n,this.inner={}}return(0,d.Z)(e,[{key:"get",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){var r,i=b(n);try{for(i.s();!(r=i.n()).done;){var u=(0,a.Z)(r.value,2),o=u[0],s=u[1];if(this.equalsFn(o,e))return s}}catch(c){i.e(c)}finally{i.f()}}}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"set",value:function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return void(r[i]=[e,t]);r.push([e,t])}else this.inner[n]=[[e,t]]}},{key:"delete",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),!0;return!1}},{key:"forEach",value:function(e){ae(this.inner,(function(t,n){var r,i=b(n);try{for(i.s();!(r=i.n()).done;){var u=(0,a.Z)(r.value,2),o=u[0],s=u[1];e(o,s)}}catch(c){i.e(c)}finally{i.f()}}))}},{key:"isEmpty",value:function(){return ue(this.inner)}}]),e}(),Pi=function(){function e(){(0,h.Z)(this,e),this.changes=new Oi((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),this.changesApplied=!1}return(0,d.Z)(e,[{key:"getReadTime",value:function(e){var t=this.changes.get(e);return t?t.readTime:re.min()}},{key:"addEntry",value:function(e,t){this.assertNotApplied(),this.changes.set(e.key,{document:e,readTime:t})}},{key:"removeEntry",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;this.assertNotApplied(),this.changes.set(e,{document:Ue.newInvalidDocument(e),readTime:t})}},{key:"getEntry",value:function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?Fr.resolve(n.document):this.getFromCache(e,t)}},{key:"getEntries",value:function(e,t){return this.getAllFromCache(e,t)}},{key:"apply",value:function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}},{key:"assertNotApplied",value:function(){}}]),e}(),Vi=function(){function e(t,n){(0,h.Z)(this,e),this.k=t,this.Jt=n}return(0,d.Z)(e,[{key:"addEntry",value:function(e,t,n){return Bi(e).put(Ki(t),n)}},{key:"removeEntry",value:function(e,t){var n=Bi(e),r=Ki(t);return n.delete(r)}},{key:"updateMetadata",value:function(e,t){var n=this;return this.getMetadata(e).next((function(r){return r.byteSize+=t,n.Re(e,r)}))}},{key:"getEntry",value:function(e,t){var n=this;return Bi(e).get(Ki(t)).next((function(e){return n.Pe(t,e)}))}},{key:"be",value:function(e,t){var n=this;return Bi(e).get(Ki(t)).next((function(e){return{document:n.Pe(t,e),size:gi(e)}}))}},{key:"getEntries",value:function(e,t){var n=this,r=yn();return this.ve(e,t,(function(e,t){var i=n.Pe(e,t);r=r.insert(e,i)})).next((function(){return r}))}},{key:"Ve",value:function(e,t){var n=this,r=yn(),i=new cn(Te.comparator);return this.ve(e,t,(function(e,t){var a=n.Pe(e,t);r=r.insert(e,a),i=i.insert(e,gi(t))})).next((function(){return{documents:r,Se:i}}))}},{key:"ve",value:function(e,t,n){if(t.isEmpty())return Fr.resolve();var r=IDBKeyRange.bound(t.first().path.toArray(),t.last().path.toArray()),i=t.getIterator(),a=i.getNext();return Bi(e).jt({range:r},(function(e,t,r){for(var u=Te.fromSegments(e);a&&Te.comparator(a,u)<0;)n(a,null),a=i.getNext();a&&a.isEqual(u)&&(n(a,t),a=i.hasNext()?i.getNext():null),a?r.Lt(a.path.toArray()):r.done()})).next((function(){for(;a;)n(a,null),a=i.hasNext()?i.getNext():null}))}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){var r=this,i=yn(),a=t.path.length+1,u={};if(n.isEqual(re.min())){var o=t.path.toArray();u.range=IDBKeyRange.lowerBound(o)}else{var s=t.path.toArray(),c=ei(n);u.range=IDBKeyRange.lowerBound([s,c],!0),u.index=Tr.collectionReadTimeIndex}return Bi(e).jt(u,(function(e,n,u){if(e.length===a){var o=Xr(r.k,n);t.path.isPrefixOf(o.key.path)?xt(t,o)&&(i=i.insert(o.key,o)):u.done()}})).next((function(){return i}))}},{key:"newChangeBuffer",value:function(e){return new qi(this,!!e&&e.trackRemovals)}},{key:"getSize",value:function(e){return this.getMetadata(e).next((function(e){return e.byteSize}))}},{key:"getMetadata",value:function(e){return Ui(e).get(Er.key).next((function(e){return M(!!e),e}))}},{key:"Re",value:function(e,t){return Ui(e).put(Er.key,t)}},{key:"Pe",value:function(e,t){if(t){var n=Xr(this.k,t);if(!n.isNoDocument()||!n.version.isEqual(re.min()))return n}return Ue.newInvalidDocument(e)}}]),e}(),qi=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).De=e,i.trackRemovals=r,i.Ce=new Oi((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),i}return(0,d.Z)(n,[{key:"applyChanges",value:function(e){var t=this,n=[],r=0,i=new hn((function(e,t){return $(e.canonicalString(),t.canonicalString())}));return this.changes.forEach((function(a,u){var o=t.Ce.get(a);if(u.document.isValidDocument()){var s=$r(t.De.k,u.document,t.getReadTime(a));i=i.add(a.path.popLast());var c=gi(s);r+=c-o,n.push(t.De.addEntry(e,a,s))}else if(r-=o,t.trackRemovals){var l=$r(t.De.k,Ue.newNoDocument(a,re.min()),t.getReadTime(a));n.push(t.De.addEntry(e,a,l))}else n.push(t.De.removeEntry(e,a))})),i.forEach((function(r){n.push(t.De.Jt.addToCollectionParentIndex(e,r))})),n.push(this.De.updateMetadata(e,r)),Fr.waitFor(n)}},{key:"getFromCache",value:function(e,t){var n=this;return this.De.be(e,t).next((function(e){return n.Ce.set(t,e.size),e.document}))}},{key:"getAllFromCache",value:function(e,t){var n=this;return this.De.Ve(e,t).next((function(e){var t=e.documents;return e.Se.forEach((function(e,t){n.Ce.set(e,t)})),t}))}}]),n}(Pi);function Ui(e){return Qr(e,Er.store)}function Bi(e){return Qr(e,Tr.store)}function Ki(e){return e.path.toArray()}var ji=function(){function e(t){(0,h.Z)(this,e),this.k=t}return(0,d.Z)(e,[{key:"Nt",value:function(e,t,n,r){var i=this;M(n<r&&n>=0&&r<=11);var a=new Or("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore(gr.store)}(e),function(e){e.createObjectStore(kr.store,{keyPath:kr.keyPath}),e.createObjectStore(wr.store,{keyPath:wr.keyPath,autoIncrement:!0}).createIndex(wr.userMutationsIndex,wr.userMutationsKeyPath,{unique:!0}),e.createObjectStore(br.store)}(e),Gi(e),function(e){e.createObjectStore(Tr.store)}(e));var u=Fr.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore(Ar.store),e.deleteObjectStore(Sr.store),e.deleteObjectStore(_r.store)}(e),Gi(e)),u=u.next((function(){return function(e){var t=e.store(_r.store),n=new _r(0,0,re.min().toTimestamp(),0);return t.put(_r.key,n)}(a)}))),n<4&&r>=4&&(0!==n&&(u=u.next((function(){return function(e,t){return t.store(wr.store).Bt().next((function(n){e.deleteObjectStore(wr.store),e.createObjectStore(wr.store,{keyPath:wr.keyPath,autoIncrement:!0}).createIndex(wr.userMutationsIndex,wr.userMutationsKeyPath,{unique:!0});var r=t.store(wr.store),i=n.map((function(e){return r.put(e)}));return Fr.waitFor(i)}))}(e,a)}))),u=u.next((function(){!function(e){e.createObjectStore(Dr.store,{keyPath:Dr.keyPath})}(e)}))),n<5&&r>=5&&(u=u.next((function(){return i.Ne(a)}))),n<6&&r>=6&&(u=u.next((function(){return function(e){e.createObjectStore(Er.store)}(e),i.ke(a)}))),n<7&&r>=7&&(u=u.next((function(){return i.xe(a)}))),n<8&&r>=8&&(u=u.next((function(){return i.$e(e,a)}))),n<9&&r>=9&&(u=u.next((function(){!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e),function(e){var t=e.objectStore(Tr.store);t.createIndex(Tr.readTimeIndex,Tr.readTimeIndexPath,{unique:!1}),t.createIndex(Tr.collectionReadTimeIndex,Tr.collectionReadTimeIndexPath,{unique:!1})}(t)}))),n<10&&r>=10&&(u=u.next((function(){return i.Fe(a)}))),n<11&&r>=11&&(u=u.next((function(){!function(e){e.createObjectStore(Zr.store,{keyPath:Zr.keyPath})}(e),function(e){e.createObjectStore(Cr.store,{keyPath:Cr.keyPath})}(e)}))),u}},{key:"ke",value:function(e){var t=0;return e.store(Tr.store).jt((function(e,n){t+=gi(n)})).next((function(){var n=new Er(t);return e.store(Er.store).put(Er.key,n)}))}},{key:"Ne",value:function(e){var t=this,n=e.store(kr.store),r=e.store(wr.store);return n.Bt().next((function(n){return Fr.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Bt(wr.userMutationsIndex,i).next((function(r){return Fr.forEach(r,(function(r){M(r.userId===n.userId);var i=ii(t.k,r);return mi(e,n.userId,i).next((function(){}))}))}))}))}))}},{key:"xe",value:function(e){var t=e.store(Ar.store),n=e.store(Tr.store);return e.store(_r.store).get(_r.key).next((function(e){var r=[];return n.jt((function(n,i){var a=new se(n),u=function(e){return[0,dr(e)]}(a);r.push(t.get(u).next((function(n){return n?Fr.resolve():function(n){return t.put(new Ar(0,dr(n),e.highestListenSequenceNumber))}(a)})))})).next((function(){return Fr.waitFor(r)}))}))}},{key:"$e",value:function(e,t){e.createObjectStore(Nr.store,{keyPath:Nr.keyPath});var n=t.store(Nr.store),r=new hi,i=function(e){if(r.add(e)){var t=e.lastSegment(),i=e.popLast();return n.put({collectionId:t,parent:dr(i)})}};return t.store(Tr.store).jt({Kt:!0},(function(e,t){var n=new se(e);return i(n.popLast())})).next((function(){return t.store(br.store).jt({Kt:!0},(function(e,t){var n=(0,a.Z)(e,3),r=(n[0],n[1]),u=(n[2],pr(r));return i(u.popLast())}))}))}},{key:"Fe",value:function(e){var t=this,n=e.store(Sr.store);return n.jt((function(e,r){var i=ai(r),a=ui(t.k,i);return n.put(a)}))}}]),e}();function Gi(e){e.createObjectStore(Ar.store,{keyPath:Ar.keyPath}).createIndex(Ar.documentTargetsIndex,Ar.documentTargetsKeyPath,{unique:!0}),e.createObjectStore(Sr.store,{keyPath:Sr.keyPath}).createIndex(Sr.queryTargetsIndexName,Sr.queryTargetsKeyPath,{unique:!0}),e.createObjectStore(_r.store)}var zi="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Qi=function(){function e(t,n,r,i,a,u,o,s,c,l){if((0,h.Z)(this,e),this.allowTabSynchronization=t,this.persistenceKey=n,this.clientId=r,this.Oe=a,this.window=u,this.document=o,this.Me=c,this.Le=l,this.Be=null,this.Ue=!1,this.isPrimary=!1,this.networkEnabled=!0,this.qe=null,this.inForeground=!1,this.Ke=null,this.je=null,this.Qe=Number.NEGATIVE_INFINITY,this.We=function(e){return Promise.resolve()},!e.bt())throw new V(P.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Mi(this,i),this.Ge=n+"main",this.k=new Jr(s),this.ze=new Pr(this.Ge,11,new ji(this.k)),this.He=new Ei(this.referenceDelegate,this.k),this.Jt=new di,this.Je=function(e,t){return new Vi(e,t)}(this.k,this.Jt),this.Ye=new si,this.window&&this.window.localStorage?this.Xe=this.window.localStorage:(this.Xe=null,!1===l&&Z("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}var t,n;return(0,d.Z)(e,[{key:"start",value:function(){var e=this;return this.Ze().then((function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new V(P.FAILED_PRECONDITION,zi);return e.tn(),e.en(),e.nn(),e.runTransaction("getHighestListenSequenceNumber","readonly",(function(t){return e.He.getHighestSequenceNumber(t)}))})).then((function(t){e.Be=new Y(t,e.Me)})).then((function(){e.Ue=!0})).catch((function(t){return e.ze&&e.ze.close(),Promise.reject(t)}))}},{key:"sn",value:function(e){var t=this;return this.We=function(){var n=(0,u.Z)(y().mark((function n(r){return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.started){n.next=2;break}return n.abrupt("return",e(r));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e(this.isPrimary)}},{key:"setDatabaseDeletedListener",value:function(e){this.ze.xt(function(){var t=(0,u.Z)(y().mark((function t(n){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=null===n.newVersion,!t.t0){t.next=4;break}return t.next=4,e();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"setNetworkEnabled",value:function(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Oe.enqueueAndForget((0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.started,!e.t0){e.next=4;break}return e.next=4,t.Ze();case 4:case"end":return e.stop()}}),e)})))))}},{key:"Ze",value:function(){var e=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(t){return Hi(t).put(new Dr(e.clientId,Date.now(),e.networkEnabled,e.inForeground)).next((function(){if(e.isPrimary)return e.rn(t).next((function(t){t||(e.isPrimary=!1,e.Oe.enqueueRetryable((function(){return e.We(!1)})))}))})).next((function(){return e.on(t)})).next((function(n){return e.isPrimary&&!n?e.an(t).next((function(){return!1})):!!n&&e.cn(t).next((function(){return!0}))}))})).catch((function(t){if(Ur(t))return D("IndexedDbPersistence","Failed to extend owner lease: ",t),e.isPrimary;if(!e.allowTabSynchronization)throw t;return D("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((function(t){e.isPrimary!==t&&e.Oe.enqueueRetryable((function(){return e.We(t)})),e.isPrimary=t}))}},{key:"rn",value:function(e){var t=this;return Wi(e).get(gr.key).next((function(e){return Fr.resolve(t.un(e))}))}},{key:"hn",value:function(e){return Hi(e).delete(this.clientId)}},{key:"ln",value:(n=(0,u.Z)(y().mark((function e(){var t,n,r,i,a=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrimary||this.fn(this.Qe,18e5)){e.next=6;break}return this.Qe=Date.now(),e.next=4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var t=Qr(e,Dr.store);return t.Bt().next((function(e){var n=a.dn(e,18e5),r=e.filter((function(e){return-1===n.indexOf(e)}));return Fr.forEach(r,(function(e){return t.delete(e.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}));case 4:if(t=e.sent,this.Xe){n=b(t);try{for(n.s();!(r=n.n()).done;)i=r.value,this.Xe.removeItem(this.wn(i.clientId))}catch(u){n.e(u)}finally{n.f()}}case 6:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"nn",value:function(){var e=this;this.je=this.Oe.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return e.Ze().then((function(){return e.ln()})).then((function(){return e.nn()}))}))}},{key:"un",value:function(e){return!!e&&e.ownerId===this.clientId}},{key:"on",value:function(e){var t=this;return this.Le?Fr.resolve(!0):Wi(e).get(gr.key).next((function(n){if(null!==n&&t.fn(n.leaseTimestampMs,5e3)&&!t._n(n.ownerId)){if(t.un(n)&&t.networkEnabled)return!0;if(!t.un(n)){if(!n.allowTabSynchronization)throw new V(P.FAILED_PRECONDITION,zi);return!1}}return!(!t.networkEnabled||!t.inForeground)||Hi(e).Bt().next((function(e){return void 0===t.dn(e,5e3).find((function(e){if(t.clientId!==e.clientId){var n=!t.networkEnabled&&e.networkEnabled,r=!t.inForeground&&e.inForeground,i=t.networkEnabled===e.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(e){return t.isPrimary!==e&&D("IndexedDbPersistence","Client ".concat(e?"is":"is not"," eligible for a primary lease.")),e}))}},{key:"shutdown",value:(t=(0,u.Z)(y().mark((function e(){var t=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.Ue=!1,this.mn(),this.je&&(this.je.cancel(),this.je=null),this.gn(),this.yn(),e.next=7,this.ze.runTransaction("shutdown","readwrite",[gr.store,Dr.store],(function(e){var n=new zr(e,Y.I);return t.an(n).next((function(){return t.hn(n)}))}));case 7:this.ze.close(),this.pn();case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"dn",value:function(e,t){var n=this;return e.filter((function(e){return n.fn(e.updateTimeMs,t)&&!n._n(e.clientId)}))}},{key:"Tn",value:function(){var e=this;return this.runTransaction("getActiveClients","readonly",(function(t){return Hi(t).Bt().next((function(t){return e.dn(t,18e5).map((function(e){return e.clientId}))}))}))}},{key:"started",get:function(){return this.Ue}},{key:"getMutationQueue",value:function(e){return ki.Xt(e,this.k,this.Jt,this.referenceDelegate)}},{key:"getTargetCache",value:function(){return this.He}},{key:"getRemoteDocumentCache",value:function(){return this.Je}},{key:"getIndexManager",value:function(){return this.Jt}},{key:"getBundleCache",value:function(){return this.Ye}},{key:"runTransaction",value:function(e,t,n){var r=this;D("IndexedDbPersistence","Starting transaction:",e);var i,a="readonly"===t?"readonly":"readwrite";return this.ze.runTransaction(e,a,Rr,(function(a){return i=new zr(a,r.Be?r.Be.next():Y.I),"readwrite-primary"===t?r.rn(i).next((function(e){return!!e||r.on(i)})).next((function(t){if(!t)throw Z("Failed to obtain primary lease for action '".concat(e,"'.")),r.isPrimary=!1,r.Oe.enqueueRetryable((function(){return r.We(!1)})),new V(P.FAILED_PRECONDITION,Lr);return n(i)})).next((function(e){return r.cn(i).next((function(){return e}))})):r.En(i).next((function(){return n(i)}))})).then((function(e){return i.raiseOnCommittedEvent(),e}))}},{key:"En",value:function(e){var t=this;return Wi(e).get(gr.key).next((function(e){if(null!==e&&t.fn(e.leaseTimestampMs,5e3)&&!t._n(e.ownerId)&&!t.un(e)&&!(t.Le||t.allowTabSynchronization&&e.allowTabSynchronization))throw new V(P.FAILED_PRECONDITION,zi)}))}},{key:"cn",value:function(e){var t=new gr(this.clientId,this.allowTabSynchronization,Date.now());return Wi(e).put(gr.key,t)}},{key:"an",value:function(e){var t=this,n=Wi(e);return n.get(gr.key).next((function(e){return t.un(e)?(D("IndexedDbPersistence","Releasing primary lease."),n.delete(gr.key)):Fr.resolve()}))}},{key:"fn",value:function(e,t){var n=Date.now();return!(e<n-t||e>n&&(Z("Detected an update time that is in the future: ".concat(e," > ").concat(n)),1))}},{key:"tn",value:function(){var e=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Ke=function(){e.Oe.enqueueAndForget((function(){return e.inForeground="visible"===e.document.visibilityState,e.Ze()}))},this.document.addEventListener("visibilitychange",this.Ke),this.inForeground="visible"===this.document.visibilityState)}},{key:"gn",value:function(){this.Ke&&(this.document.removeEventListener("visibilitychange",this.Ke),this.Ke=null)}},{key:"en",value:function(){var e,t=this;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.qe=function(){t.mn(),(0,k.G6)()&&navigator.appVersion.match(/Version\/1[45]/)&&t.Oe.enterRestrictedMode(!0),t.Oe.enqueueAndForget((function(){return t.shutdown()}))},this.window.addEventListener("pagehide",this.qe))}},{key:"yn",value:function(){this.qe&&(this.window.removeEventListener("pagehide",this.qe),this.qe=null)}},{key:"_n",value:function(e){var t;try{var n=null!==(null===(t=this.Xe)||void 0===t?void 0:t.getItem(this.wn(e)));return D("IndexedDbPersistence","Client '".concat(e,"' ").concat(n?"is":"is not"," zombied in LocalStorage")),n}catch(e){return Z("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}},{key:"mn",value:function(){if(this.Xe)try{this.Xe.setItem(this.wn(this.clientId),String(Date.now()))}catch(e){Z("Failed to set zombie client id.",e)}}},{key:"pn",value:function(){if(this.Xe)try{this.Xe.removeItem(this.wn(this.clientId))}catch(e){}}},{key:"wn",value:function(e){return"firestore_zombie_".concat(this.persistenceKey,"_").concat(e)}}],[{key:"bt",value:function(){return Pr.bt()}}]),e}();function Wi(e){return Qr(e,gr.store)}function Hi(e){return Qr(e,Dr.store)}function Yi(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}var Ji=(0,d.Z)((function e(t,n){(0,h.Z)(this,e),this.progress=t,this.In=n})),Xi=function(){function e(t,n,r){(0,h.Z)(this,e),this.Je=t,this.An=n,this.Jt=r}return(0,d.Z)(e,[{key:"Rn",value:function(e,t){var n=this;return this.An.getAllMutationBatchesAffectingDocumentKey(e,t).next((function(r){return n.Pn(e,t,r)}))}},{key:"Pn",value:function(e,t,n){return this.Je.getEntry(e,t).next((function(e){var t,r=b(n);try{for(r.s();!(t=r.n()).done;){t.value.applyToLocalView(e)}}catch(i){r.e(i)}finally{r.f()}return e}))}},{key:"bn",value:function(e,t){e.forEach((function(e,n){var r,i=b(t);try{for(i.s();!(r=i.n()).done;){r.value.applyToLocalView(n)}}catch(a){i.e(a)}finally{i.f()}}))}},{key:"vn",value:function(e,t){var n=this;return this.Je.getEntries(e,t).next((function(t){return n.Vn(e,t).next((function(){return t}))}))}},{key:"Vn",value:function(e,t){var n=this;return this.An.getAllMutationBatchesAffectingDocumentKeys(e,t).next((function(e){return n.bn(t,e)}))}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){return function(e){return Te.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.Sn(e,t.path):yt(t)?this.Dn(e,t,n):this.Cn(e,t,n)}},{key:"Sn",value:function(e,t){return this.Rn(e,new Te(t)).next((function(e){var t=mn();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}},{key:"Dn",value:function(e,t,n){var r=this,i=t.collectionGroup,a=mn();return this.Jt.getCollectionParents(e,i).next((function(u){return Fr.forEach(u,(function(u){var o=function(e,t){return new st(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,u.child(i));return r.Cn(e,o,n).next((function(e){e.forEach((function(e,t){a=a.insert(e,t)}))}))})).next((function(){return a}))}))}},{key:"Cn",value:function(e,t,n){var r,i,a=this;return this.Je.getDocumentsMatchingQuery(e,t,n).next((function(n){return r=n,a.An.getAllMutationBatchesAffectingQuery(e,t)})).next((function(t){return i=t,a.Nn(e,i,r).next((function(e){r=e;var t,n=b(i);try{for(n.s();!(t=n.n()).done;){var a,u=t.value,o=b(u.mutations);try{for(o.s();!(a=o.n()).done;){var s=a.value,c=s.key,l=r.get(c);null==l&&(l=Ue.newInvalidDocument(c),r=r.insert(c,l)),zt(s,l,u.localWriteTime),l.isFoundDocument()||(r=r.remove(c))}}catch(f){o.e(f)}finally{o.f()}}}catch(f){n.e(f)}finally{n.f()}}))})).next((function(){return r.forEach((function(e,n){xt(t,n)||(r=r.remove(e))})),r}))}},{key:"Nn",value:function(e,t,n){var r,i=bn(),a=b(t);try{for(a.s();!(r=a.n()).done;){var u,o=b(r.value.mutations);try{for(o.s();!(u=o.n()).done;){var s=u.value;s instanceof Jt&&null===n.get(s.key)&&(i=i.add(s.key))}}catch(l){o.e(l)}finally{o.f()}}}catch(l){a.e(l)}finally{a.f()}var c=n;return this.Je.getEntries(e,i).next((function(e){return e.forEach((function(e,t){t.isFoundDocument()&&(c=c.insert(e,t))})),c}))}}]),e}(),$i=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.targetId=t,this.fromCache=n,this.kn=r,this.xn=i}return(0,d.Z)(e,null,[{key:"$n",value:function(t,n){var r,i=bn(),a=bn(),u=b(n.docChanges);try{for(u.s();!(r=u.n()).done;){var o=r.value;switch(o.type){case 0:i=i.add(o.doc.key);break;case 1:a=a.add(o.doc.key)}}}catch(s){u.e(s)}finally{u.f()}return new e(t,n.fromCache,i,a)}}]),e}(),ea=function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,[{key:"Fn",value:function(e){this.On=e}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){var i=this;return function(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}(t)||n.isEqual(re.min())?this.Mn(e,t):this.On.vn(e,r).next((function(a){var u=i.Ln(t,a);return(ft(t)||ht(t))&&i.Bn(t.limitType,u,r,n)?i.Mn(e,t):(_()<=g.in.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),bt(t)),i.On.getDocumentsMatchingQuery(e,t,n).next((function(e){return u.forEach((function(t){e=e.insert(t.key,t)})),e})))}))}},{key:"Ln",value:function(e,t){var n=new hn(It(e));return t.forEach((function(t,r){xt(e,r)&&(n=n.add(r))})),n}},{key:"Bn",value:function(e,t,n,r){if(n.size!==t.size)return!0;var i="F"===e?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}},{key:"Mn",value:function(e,t){return _()<=g.in.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",bt(t)),this.On.getDocumentsMatchingQuery(e,t,re.min())}}]),e}(),ta=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.persistence=t,this.Un=n,this.k=i,this.qn=new cn($),this.Kn=new Oi((function(e){return je(e)}),Ge),this.jn=re.min(),this.An=t.getMutationQueue(r),this.Qn=t.getRemoteDocumentCache(),this.He=t.getTargetCache(),this.Wn=new Xi(this.Qn,this.An,this.persistence.getIndexManager()),this.Ye=t.getBundleCache(),this.Un.Fn(this.Wn)}return(0,d.Z)(e,[{key:"collectGarbage",value:function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return e.collect(n,t.qn)}))}}]),e}();function na(e,t,n,r){return new ta(e,t,n,r)}function ra(e,t){return ia.apply(this,arguments)}function ia(){return(ia=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=O(t),i=r.An,a=r.Wn,e.next=4,r.persistence.runTransaction("Handle user change","readonly",(function(e){var t;return r.An.getAllMutationBatches(e).next((function(u){return t=u,i=r.persistence.getMutationQueue(n),a=new Xi(r.Qn,i,r.persistence.getIndexManager()),i.getAllMutationBatches(e)})).next((function(n){var r,i=[],u=[],o=bn(),s=b(t);try{for(s.s();!(r=s.n()).done;){var c=r.value;i.push(c.batchId);var l,f=b(c.mutations);try{for(f.s();!(l=f.n()).done;){var h=l.value;o=o.add(h.key)}}catch(k){f.e(k)}finally{f.f()}}}catch(k){s.e(k)}finally{s.f()}var d,v=b(n);try{for(v.s();!(d=v.n()).done;){var y=d.value;u.push(y.batchId);var p,m=b(y.mutations);try{for(m.s();!(p=m.n()).done;){var g=p.value;o=o.add(g.key)}}catch(k){m.e(k)}finally{m.f()}}}catch(k){v.e(k)}finally{v.f()}return a.vn(e,o).next((function(e){return{Gn:e,removedBatchIds:i,addedBatchIds:u}}))}))}));case 4:return u=e.sent,e.abrupt("return",(r.An=i,r.Wn=a,r.Un.Fn(r.Wn),u));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function aa(e,t){var n=O(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(e){var r=t.batch.keys(),i=n.Qn.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){var i=n.batch,a=i.keys(),u=Fr.resolve();return a.forEach((function(e){u=u.next((function(){return r.getEntry(t,e)})).next((function(t){var a=n.docVersions.get(e);M(null!==a),t.version.compareTo(a)<0&&(i.applyToRemoteDocument(t,n),t.isValidDocument()&&r.addEntry(t,n.commitVersion))}))})),u.next((function(){return e.An.removeMutationBatch(t,i)}))}(n,e,t,i).next((function(){return i.apply(e)})).next((function(){return n.An.performConsistencyCheck(e)})).next((function(){return n.Wn.vn(e,r)}))}))}function ua(e){var t=O(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.He.getLastRemoteSnapshotVersion(e)}))}function oa(e,t){var n=O(e),r=t.snapshotVersion,i=n.qn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(e){var a=n.Qn.newChangeBuffer({trackRemovals:!0});i=n.qn;var u=[];t.targetChanges.forEach((function(t,a){var o=i.get(a);if(o){u.push(n.He.removeMatchingKeys(e,t.removedDocuments,a).next((function(){return n.He.addMatchingKeys(e,t.addedDocuments,a)})));var s=t.resumeToken;if(s.approximateByteSize()>0){var c=o.withResumeToken(s,r).withSequenceNumber(e.currentSequenceNumber);i=i.insert(a,c),function(e,t,n){return M(t.resumeToken.approximateByteSize()>0),0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(o,c,t)&&u.push(n.He.updateTargetData(e,c))}}}));var o=yn();if(t.documentUpdates.forEach((function(r,i){t.resolvedLimboDocuments.has(r)&&u.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),u.push(sa(e,a,t.documentUpdates,r,void 0).next((function(e){o=e}))),!r.isEqual(re.min())){var s=n.He.getLastRemoteSnapshotVersion(e).next((function(t){return n.He.setTargetsMetadata(e,e.currentSequenceNumber,r)}));u.push(s)}return Fr.waitFor(u).next((function(){return a.apply(e)})).next((function(){return n.Wn.Vn(e,o)})).next((function(){return o}))})).then((function(e){return n.qn=i,e}))}function sa(e,t,n,r,i){var a=bn();return n.forEach((function(e){return a=a.add(e)})),t.getEntries(e,a).next((function(e){var a=yn();return n.forEach((function(n,u){var o=e.get(n),s=(null==i?void 0:i.get(n))||r;u.isNoDocument()&&u.version.isEqual(re.min())?(t.removeEntry(n,s),a=a.insert(n,u)):!o.isValidDocument()||u.version.compareTo(o.version)>0||0===u.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(u,s),a=a.insert(n,u)):D("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",u.version)})),a}))}function ca(e,t){var n=O(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(e){return void 0===t&&(t=-1),n.An.getNextMutationBatchAfterBatchId(e,t)}))}function la(e,t){var n=O(e);return n.persistence.runTransaction("Allocate target","readwrite",(function(e){var r;return n.He.getTargetData(e,t).next((function(i){return i?(r=i,Fr.resolve(r)):n.He.allocateTargetId(e).next((function(i){return r=new Yr(t,i,0,e.currentSequenceNumber),n.He.addTargetData(e,r).next((function(){return r}))}))}))})).then((function(e){var r=n.qn.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.qn=n.qn.insert(e.targetId,e),n.Kn.set(t,e.targetId)),e}))}function fa(e,t,n){return ha.apply(this,arguments)}function ha(){return(ha=(0,u.Z)(y().mark((function e(t,n,r){var i,a,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=O(t),a=i.qn.get(n),u=r?"readwrite":"readwrite-primary",e.prev=1,e.t0=r,e.t0){e.next=6;break}return e.next=6,i.persistence.runTransaction("Release target",u,(function(e){return i.persistence.referenceDelegate.removeTarget(e,a)}));case 6:e.next=13;break;case 8:if(e.prev=8,e.t1=e.catch(1),Ur(e.t1)){e.next=12;break}throw e.t1;case 12:D("LocalStore","Failed to update sequence numbers for target ".concat(n,": ").concat(e.t1));case 13:i.qn=i.qn.remove(n),i.Kn.delete(a.target);case 14:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function da(e,t,n){var r=O(e),i=re.min(),a=bn();return r.persistence.runTransaction("Execute query","readonly",(function(e){return function(e,t,n){var r=O(e),i=r.Kn.get(n);return void 0!==i?Fr.resolve(r.qn.get(i)):r.He.getTargetData(t,n)}(r,e,mt(t)).next((function(t){if(t)return i=t.lastLimboFreeSnapshotVersion,r.He.getMatchingKeysForTargetId(e,t.targetId).next((function(e){a=e}))})).next((function(){return r.Un.getDocumentsMatchingQuery(e,t,n?i:re.min(),n?a:bn())})).next((function(e){return{documents:e,zn:a}}))}))}function va(e,t){var n=O(e),r=O(n.He),i=n.qn.get(t);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",(function(e){return r.Et(e,t).next((function(e){return e?e.target:null}))}))}function ya(e){var t=O(e);return t.persistence.runTransaction("Get new document changes","readonly",(function(e){return function(e,t,n){var r=O(e),i=yn(),a=ei(n),u=Bi(t),o=IDBKeyRange.lowerBound(a,!0);return u.jt({index:Tr.readTimeIndex,range:o},(function(e,t){var n=Xr(r.k,t);i=i.insert(n.key,n),a=t.readTime})).next((function(){return{In:i,readTime:ti(a)}}))}(t.Qn,e,t.jn)})).then((function(e){var n=e.In,r=e.readTime;return t.jn=r,n}))}function pa(e){return ma.apply(this,arguments)}function ma(){return(ma=(0,u.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=O(t),e.abrupt("return",n.persistence.runTransaction("Synchronize last document change read time","readonly",(function(e){return function(e){var t=Bi(e),n=re.min();return t.jt({index:Tr.readTimeIndex,reverse:!0},(function(e,t,r){t.readTime&&(n=ti(t.readTime)),r.done()})).next((function(){return n}))}(e)})).then((function(e){n.jn=e})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ga(e,t,n,r){return ka.apply(this,arguments)}function ka(){return(ka=(0,u.Z)(y().mark((function e(t,n,r,i){var a,u,o,s,c,l,f,h,d,v;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=O(t),u=bn(),o=yn(),s=kn(),c=b(r);try{for(c.s();!(l=c.n()).done;)f=l.value,h=n.Hn(f.metadata.name),f.document&&(u=u.add(h)),o=o.insert(h,n.Jn(f)),s=s.insert(h,n.Yn(f.metadata.readTime))}catch(y){c.e(y)}finally{c.f()}return d=a.Qn.newChangeBuffer({trackRemovals:!0}),e.next=7,la(a,function(e){return mt(lt(se.fromString("__bundle__/docs/".concat(e))))}(i));case 7:return v=e.sent,e.abrupt("return",a.persistence.runTransaction("Apply bundle documents","readwrite",(function(e){return sa(e,d,o,re.min(),s).next((function(t){return d.apply(e),t})).next((function(t){return a.He.removeMatchingKeysForTargetId(e,v.targetId).next((function(){return a.He.addMatchingKeys(e,u,v.targetId)})).next((function(){return a.Wn.Vn(e,t)})).next((function(){return t}))}))})));case 9:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wa(e,t){return ba.apply(this,arguments)}function ba(){return ba=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u=arguments;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=u.length>2&&void 0!==u[2]?u[2]:bn(),e.next=3,la(t,mt(oi(n.bundledQuery)));case 3:return i=e.sent,a=O(t),e.abrupt("return",a.persistence.runTransaction("Save named query","readwrite",(function(e){var t=Vn(n.readTime);if(i.snapshotVersion.compareTo(t)>=0)return a.Ye.saveNamedQuery(e,n);var u=i.withResumeToken(de.EMPTY_BYTE_STRING,t);return a.qn=a.qn.insert(u.targetId,u),a.He.updateTargetData(e,u).next((function(){return a.He.removeMatchingKeysForTargetId(e,i.targetId)})).next((function(){return a.He.addMatchingKeys(e,r,i.targetId)})).next((function(){return a.Ye.saveNamedQuery(e,n)}))})));case 6:case"end":return e.stop()}}),e)}))),ba.apply(this,arguments)}var xa=function(){function e(t){(0,h.Z)(this,e),this.k=t,this.Xn=new Map,this.Zn=new Map}return(0,d.Z)(e,[{key:"getBundleMetadata",value:function(e,t){return Fr.resolve(this.Xn.get(t))}},{key:"saveBundleMetadata",value:function(e,t){var n;return this.Xn.set(t.id,{id:(n=t).id,version:n.version,createTime:Vn(n.createTime)}),Fr.resolve()}},{key:"getNamedQuery",value:function(e,t){return Fr.resolve(this.Zn.get(t))}},{key:"saveNamedQuery",value:function(e,t){return this.Zn.set(t.name,function(e){return{name:e.name,query:oi(e.bundledQuery),readTime:Vn(e.readTime)}}(t)),Fr.resolve()}}]),e}(),Ia=function(){function e(){(0,h.Z)(this,e),this.ts=new hn(Ta.es),this.ns=new hn(Ta.ss)}return(0,d.Z)(e,[{key:"isEmpty",value:function(){return this.ts.isEmpty()}},{key:"addReference",value:function(e,t){var n=new Ta(e,t);this.ts=this.ts.add(n),this.ns=this.ns.add(n)}},{key:"rs",value:function(e,t){var n=this;e.forEach((function(e){return n.addReference(e,t)}))}},{key:"removeReference",value:function(e,t){this.os(new Ta(e,t))}},{key:"cs",value:function(e,t){var n=this;e.forEach((function(e){return n.removeReference(e,t)}))}},{key:"us",value:function(e){var t=this,n=new Te(new se([])),r=new Ta(n,e),i=new Ta(n,e+1),a=[];return this.ns.forEachInRange([r,i],(function(e){t.os(e),a.push(e.key)})),a}},{key:"hs",value:function(){var e=this;this.ts.forEach((function(t){return e.os(t)}))}},{key:"os",value:function(e){this.ts=this.ts.delete(e),this.ns=this.ns.delete(e)}},{key:"ls",value:function(e){var t=new Te(new se([])),n=new Ta(t,e),r=new Ta(t,e+1),i=bn();return this.ns.forEachInRange([n,r],(function(e){i=i.add(e.key)})),i}},{key:"containsKey",value:function(e){var t=new Ta(e,0),n=this.ts.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}]),e}(),Ta=function(){function e(t,n){(0,h.Z)(this,e),this.key=t,this.fs=n}return(0,d.Z)(e,null,[{key:"es",value:function(e,t){return Te.comparator(e.key,t.key)||$(e.fs,t.fs)}},{key:"ss",value:function(e,t){return $(e.fs,t.fs)||Te.comparator(e.key,t.key)}}]),e}(),Ea=function(){function e(t,n){(0,h.Z)(this,e),this.Jt=t,this.referenceDelegate=n,this.An=[],this.ds=1,this.ws=new hn(Ta.es)}return(0,d.Z)(e,[{key:"checkEmpty",value:function(e){return Fr.resolve(0===this.An.length)}},{key:"addMutationBatch",value:function(e,t,n,r){var i=this.ds;this.ds++,this.An.length>0&&this.An[this.An.length-1];var a=new Wr(i,t,n,r);this.An.push(a);var u,o=b(r);try{for(o.s();!(u=o.n()).done;){var s=u.value;this.ws=this.ws.add(new Ta(s.key,i)),this.Jt.addToCollectionParentIndex(e,s.key.path.popLast())}}catch(c){o.e(c)}finally{o.f()}return Fr.resolve(a)}},{key:"lookupMutationBatch",value:function(e,t){return Fr.resolve(this._s(t))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=t+1,r=this.gs(n),i=r<0?0:r;return Fr.resolve(this.An.length>i?this.An[i]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function(){return Fr.resolve(0===this.An.length?-1:this.ds-1)}},{key:"getAllMutationBatches",value:function(e){return Fr.resolve(this.An.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=new Ta(t,0),i=new Ta(t,Number.POSITIVE_INFINITY),a=[];return this.ws.forEachInRange([r,i],(function(e){var t=n._s(e.fs);a.push(t)})),Fr.resolve(a)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new hn($);return t.forEach((function(e){var t=new Ta(e,0),i=new Ta(e,Number.POSITIVE_INFINITY);n.ws.forEachInRange([t,i],(function(e){r=r.add(e.fs)}))})),Fr.resolve(this.ys(r))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=t.path,r=n.length+1,i=n;Te.isDocumentKey(i)||(i=i.child(""));var a=new Ta(new Te(i),0),u=new hn($);return this.ws.forEachWhile((function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(u=u.add(e.fs)),!0)}),a),Fr.resolve(this.ys(u))}},{key:"ys",value:function(e){var t=this,n=[];return e.forEach((function(e){var r=t._s(e);null!==r&&n.push(r)})),n}},{key:"removeMutationBatch",value:function(e,t){var n=this;M(0===this.ps(t.batchId,"removed")),this.An.shift();var r=this.ws;return Fr.forEach(t.mutations,(function(i){var a=new Ta(i.key,t.batchId);return r=r.delete(a),n.referenceDelegate.markPotentiallyOrphaned(e,i.key)})).next((function(){n.ws=r}))}},{key:"ee",value:function(e){}},{key:"containsKey",value:function(e,t){var n=new Ta(t,0),r=this.ws.firstAfterOrEqual(n);return Fr.resolve(t.isEqual(r&&r.key))}},{key:"performConsistencyCheck",value:function(e){return this.An.length,Fr.resolve()}},{key:"ps",value:function(e,t){return this.gs(e)}},{key:"gs",value:function(e){return 0===this.An.length?0:e-this.An[0].batchId}},{key:"_s",value:function(e){var t=this.gs(e);return t<0||t>=this.An.length?null:this.An[t]}}]),e}(),Sa=function(){function e(t,n){(0,h.Z)(this,e),this.Jt=t,this.Ts=n,this.docs=new cn(Te.comparator),this.size=0}return(0,d.Z)(e,[{key:"addEntry",value:function(e,t,n){var r=t.key,i=this.docs.get(r),a=i?i.size:0,u=this.Ts(t);return this.docs=this.docs.insert(r,{document:t.clone(),size:u,readTime:n}),this.size+=u-a,this.Jt.addToCollectionParentIndex(e,r.path.popLast())}},{key:"removeEntry",value:function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}},{key:"getEntry",value:function(e,t){var n=this.docs.get(t);return Fr.resolve(n?n.document.clone():Ue.newInvalidDocument(t))}},{key:"getEntries",value:function(e,t){var n=this,r=yn();return t.forEach((function(e){var t=n.docs.get(e);r=r.insert(e,t?t.document.clone():Ue.newInvalidDocument(e))})),Fr.resolve(r)}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){for(var r=yn(),i=new Te(t.path.child("")),a=this.docs.getIteratorFrom(i);a.hasNext();){var u=a.getNext(),o=u.key,s=u.value,c=s.document,l=s.readTime;if(!t.path.isPrefixOf(o.path))break;l.compareTo(n)<=0||xt(t,c)&&(r=r.insert(c.key,c.clone()))}return Fr.resolve(r)}},{key:"Es",value:function(e,t){return Fr.forEach(this.docs,(function(e){return t(e)}))}},{key:"newChangeBuffer",value:function(e){return new Aa(this)}},{key:"getSize",value:function(e){return Fr.resolve(this.size)}}]),e}(),Aa=function(e){(0,o.Z)(n,e);var t=I(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).De=e,r}return(0,d.Z)(n,[{key:"applyChanges",value:function(e){var t=this,n=[];return this.changes.forEach((function(r,i){i.document.isValidDocument()?n.push(t.De.addEntry(e,i.document,t.getReadTime(r))):t.De.removeEntry(r)})),Fr.waitFor(n)}},{key:"getFromCache",value:function(e,t){return this.De.getEntry(e,t)}},{key:"getAllFromCache",value:function(e,t){return this.De.getEntries(e,t)}}]),n}(Pi),_a=function(){function e(t){(0,h.Z)(this,e),this.persistence=t,this.Is=new Oi((function(e){return je(e)}),Ge),this.lastRemoteSnapshotVersion=re.min(),this.highestTargetId=0,this.As=0,this.Rs=new Ia,this.targetCount=0,this.Ps=Ti.ie()}return(0,d.Z)(e,[{key:"forEachTarget",value:function(e,t){return this.Is.forEach((function(e,n){return t(n)})),Fr.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function(e){return Fr.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function(e){return Fr.resolve(this.As)}},{key:"allocateTargetId",value:function(e){return this.highestTargetId=this.Ps.next(),Fr.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.As&&(this.As=t),Fr.resolve()}},{key:"ce",value:function(e){this.Is.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.Ps=new Ti(t),this.highestTargetId=t),e.sequenceNumber>this.As&&(this.As=e.sequenceNumber)}},{key:"addTargetData",value:function(e,t){return this.ce(t),this.targetCount+=1,Fr.resolve()}},{key:"updateTargetData",value:function(e,t){return this.ce(t),Fr.resolve()}},{key:"removeTargetData",value:function(e,t){return this.Is.delete(t.target),this.Rs.us(t.targetId),this.targetCount-=1,Fr.resolve()}},{key:"removeTargets",value:function(e,t,n){var r=this,i=0,a=[];return this.Is.forEach((function(u,o){o.sequenceNumber<=t&&null===n.get(o.targetId)&&(r.Is.delete(u),a.push(r.removeMatchingKeysForTargetId(e,o.targetId)),i++)})),Fr.waitFor(a).next((function(){return i}))}},{key:"getTargetCount",value:function(e){return Fr.resolve(this.targetCount)}},{key:"getTargetData",value:function(e,t){var n=this.Is.get(t)||null;return Fr.resolve(n)}},{key:"addMatchingKeys",value:function(e,t,n){return this.Rs.rs(t,n),Fr.resolve()}},{key:"removeMatchingKeys",value:function(e,t,n){this.Rs.cs(t,n);var r=this.persistence.referenceDelegate,i=[];return r&&t.forEach((function(t){i.push(r.markPotentiallyOrphaned(e,t))})),Fr.waitFor(i)}},{key:"removeMatchingKeysForTargetId",value:function(e,t){return this.Rs.us(t),Fr.resolve()}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=this.Rs.ls(t);return Fr.resolve(n)}},{key:"containsKey",value:function(e,t){return Fr.resolve(this.Rs.containsKey(t))}}]),e}(),Na=function(){function e(t,n){var r=this;(0,h.Z)(this,e),this.bs={},this.Be=new Y(0),this.Ue=!1,this.Ue=!0,this.referenceDelegate=t(this),this.He=new _a(this),this.Jt=new fi,this.Je=function(e,t){return new Sa(e,(function(e){return r.referenceDelegate.vs(e)}))}(this.Jt),this.k=new Jr(n),this.Ye=new xa(this.k)}return(0,d.Z)(e,[{key:"start",value:function(){return Promise.resolve()}},{key:"shutdown",value:function(){return this.Ue=!1,Promise.resolve()}},{key:"started",get:function(){return this.Ue}},{key:"setDatabaseDeletedListener",value:function(){}},{key:"setNetworkEnabled",value:function(){}},{key:"getIndexManager",value:function(){return this.Jt}},{key:"getMutationQueue",value:function(e){var t=this.bs[e.toKey()];return t||(t=new Ea(this.Jt,this.referenceDelegate),this.bs[e.toKey()]=t),t}},{key:"getTargetCache",value:function(){return this.He}},{key:"getRemoteDocumentCache",value:function(){return this.Je}},{key:"getBundleCache",value:function(){return this.Ye}},{key:"runTransaction",value:function(e,t,n){var r=this;D("MemoryPersistence","Starting transaction:",e);var i=new Da(this.Be.next());return this.referenceDelegate.Vs(),n(i).next((function(e){return r.referenceDelegate.Ss(i).next((function(){return e}))})).toPromise().then((function(e){return i.raiseOnCommittedEvent(),e}))}},{key:"Ds",value:function(e,t){return Fr.or(Object.values(this.bs).map((function(n){return function(){return n.containsKey(e,t)}})))}}]),e}(),Da=function(e){(0,o.Z)(n,e);var t=I(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).currentSequenceNumber=e,r}return(0,d.Z)(n)}(Mr),Za=function(){function e(t){(0,h.Z)(this,e),this.persistence=t,this.Cs=new Ia,this.Ns=null}return(0,d.Z)(e,[{key:"xs",get:function(){if(this.Ns)return this.Ns;throw L()}},{key:"addReference",value:function(e,t,n){return this.Cs.addReference(n,t),this.xs.delete(n.toString()),Fr.resolve()}},{key:"removeReference",value:function(e,t,n){return this.Cs.removeReference(n,t),this.xs.add(n.toString()),Fr.resolve()}},{key:"markPotentiallyOrphaned",value:function(e,t){return this.xs.add(t.toString()),Fr.resolve()}},{key:"removeTarget",value:function(e,t){var n=this;this.Cs.us(t.targetId).forEach((function(e){return n.xs.add(e.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((function(e){e.forEach((function(e){return n.xs.add(e.toString())}))})).next((function(){return r.removeTargetData(e,t)}))}},{key:"Vs",value:function(){this.Ns=new Set}},{key:"Ss",value:function(e){var t=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Fr.forEach(this.xs,(function(r){var i=Te.fromPath(r);return t.$s(e,i).next((function(e){e||n.removeEntry(i)}))})).next((function(){return t.Ns=null,n.apply(e)}))}},{key:"updateLimboDocument",value:function(e,t){var n=this;return this.$s(e,t).next((function(e){e?n.xs.delete(t.toString()):n.xs.add(t.toString())}))}},{key:"vs",value:function(e){return 0}},{key:"$s",value:function(e,t){var n=this;return Fr.or([function(){return Fr.resolve(n.Cs.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.Ds(e,t)}])}}],[{key:"ks",value:function(t){return new e(t)}}]),e}();function Ca(e,t){return"firestore_clients_".concat(e,"_").concat(t)}function Ra(e,t,n){var r="firestore_mutations_".concat(e,"_").concat(n);return t.isAuthenticated()&&(r+="_".concat(t.uid)),r}function La(e,t){return"firestore_targets_".concat(e,"_").concat(t)}var Ma=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.user=t,this.batchId=n,this.state=r,this.error=i}return(0,d.Z)(e,[{key:"Os",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Fs",value:function(t,n,r){var i,a=JSON.parse(r),u="object"==typeof a&&-1!==["pending","acknowledged","rejected"].indexOf(a.state)&&(void 0===a.error||"object"==typeof a.error);return u&&a.error&&((u="string"==typeof a.error.message&&"string"==typeof a.error.code)&&(i=new V(a.error.code,a.error.message))),u?new e(t,n,a.state,i):(Z("SharedClientState","Failed to parse mutation state for ID '".concat(n,"': ").concat(r)),null)}}]),e}(),Fa=function(){function e(t,n,r){(0,h.Z)(this,e),this.targetId=t,this.state=n,this.error=r}return(0,d.Z)(e,[{key:"Os",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Fs",value:function(t,n){var r,i=JSON.parse(n),a="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return a&&i.error&&((a="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new V(i.error.code,i.error.message))),a?new e(t,i.state,r):(Z("SharedClientState","Failed to parse target state for ID '".concat(t,"': ").concat(n)),null)}}]),e}(),Oa=function(){function e(t,n){(0,h.Z)(this,e),this.clientId=t,this.activeTargetIds=n}return(0,d.Z)(e,null,[{key:"Fs",value:function(t,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,a=In(),u=0;i&&u<r.activeTargetIds.length;++u)i=Ie(r.activeTargetIds[u]),a=a.add(r.activeTargetIds[u]);return i?new e(t,a):(Z("SharedClientState","Failed to parse client data for instance '".concat(t,"': ").concat(n)),null)}}]),e}(),Pa=function(){function e(t,n){(0,h.Z)(this,e),this.clientId=t,this.onlineState=n}return(0,d.Z)(e,null,[{key:"Fs",value:function(t){var n=JSON.parse(t);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new e(n.clientId,n.onlineState):(Z("SharedClientState","Failed to parse online state: ".concat(t)),null)}}]),e}(),Va=function(){function e(){(0,h.Z)(this,e),this.activeTargetIds=In()}return(0,d.Z)(e,[{key:"Ms",value:function(e){this.activeTargetIds=this.activeTargetIds.add(e)}},{key:"Ls",value:function(e){this.activeTargetIds=this.activeTargetIds.delete(e)}},{key:"Os",value:function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}]),e}(),qa=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this.window=t,this.Oe=n,this.persistenceKey=r,this.Bs=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.Us=this.qs.bind(this),this.Ks=new cn($),this.started=!1,this.js=[];var u=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=a,this.Qs=Ca(this.persistenceKey,this.Bs),this.Ws=function(e){return"firestore_sequence_number_".concat(e)}(this.persistenceKey),this.Ks=this.Ks.insert(this.Bs,new Va),this.Gs=new RegExp("^firestore_clients_".concat(u,"_([^_]*)$")),this.zs=new RegExp("^firestore_mutations_".concat(u,"_(\\d+)(?:_(.*))?$")),this.Hs=new RegExp("^firestore_targets_".concat(u,"_(\\d+)$")),this.Js=function(e){return"firestore_online_state_".concat(e)}(this.persistenceKey),this.Ys=function(e){return"firestore_bundle_loaded_".concat(e)}(this.persistenceKey),this.window.addEventListener("storage",this.Us)}var t,n;return(0,d.Z)(e,[{key:"start",value:(n=(0,u.Z)(y().mark((function e(){var t,n,r,i,a,u,o,s,c,l,f,h=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.syncEngine.Tn();case 2:t=e.sent,n=b(t),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=14;break}if((i=r.value)!==this.Bs){e.next=10;break}return e.abrupt("continue",12);case 10:(a=this.getItem(Ca(this.persistenceKey,i)))&&(u=Oa.Fs(i,a))&&(this.Ks=this.Ks.insert(u.clientId,u));case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:this.Xs(),(o=this.storage.getItem(this.Js))&&(s=this.Zs(o))&&this.ti(s),c=b(this.js);try{for(c.s();!(l=c.n()).done;)f=l.value,this.qs(f)}catch(d){c.e(d)}finally{c.f()}this.js=[],this.window.addEventListener("pagehide",(function(){return h.shutdown()})),this.started=!0;case 28:case"end":return e.stop()}}),e,this,[[4,16,19,22]])}))),function(){return n.apply(this,arguments)})},{key:"writeSequenceNumber",value:function(e){this.setItem(this.Ws,JSON.stringify(e))}},{key:"getAllActiveQueryTargets",value:function(){return this.ei(this.Ks)}},{key:"isActiveQueryTarget",value:function(e){var t=!1;return this.Ks.forEach((function(n,r){r.activeTargetIds.has(e)&&(t=!0)})),t}},{key:"addPendingMutation",value:function(e){this.ni(e,"pending")}},{key:"updateMutationState",value:function(e,t,n){this.ni(e,t,n),this.si(e)}},{key:"addLocalQueryTarget",value:function(e){var t="not-current";if(this.isActiveQueryTarget(e)){var n=this.storage.getItem(La(this.persistenceKey,e));if(n){var r=Fa.Fs(e,n);r&&(t=r.state)}}return this.ii.Ms(e),this.Xs(),t}},{key:"removeLocalQueryTarget",value:function(e){this.ii.Ls(e),this.Xs()}},{key:"isLocalQueryTarget",value:function(e){return this.ii.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){this.removeItem(La(this.persistenceKey,e))}},{key:"updateQueryState",value:function(e,t,n){this.ri(e,t,n)}},{key:"handleUserChange",value:function(e,t,n){var r=this;t.forEach((function(e){r.si(e)})),this.currentUser=e,n.forEach((function(e){r.addPendingMutation(e)}))}},{key:"setOnlineState",value:function(e){this.oi(e)}},{key:"notifyBundleLoaded",value:function(){this.ai()}},{key:"shutdown",value:function(){this.started&&(this.window.removeEventListener("storage",this.Us),this.removeItem(this.Qs),this.started=!1)}},{key:"getItem",value:function(e){var t=this.storage.getItem(e);return D("SharedClientState","READ",e,t),t}},{key:"setItem",value:function(e,t){D("SharedClientState","SET",e,t),this.storage.setItem(e,t)}},{key:"removeItem",value:function(e){D("SharedClientState","REMOVE",e),this.storage.removeItem(e)}},{key:"qs",value:function(e){var t=this,n=e;if(n.storageArea===this.storage){if(D("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Qs)return void Z("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Oe.enqueueRetryable((0,u.Z)(y().mark((function e(){var r,i,a,u,o,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.started){e.next=41;break}if(null===n.key){e.next=39;break}if(!t.Gs.test(n.key)){e.next=11;break}if(null!=n.newValue){e.next=6;break}return r=t.ci(n.key),e.abrupt("return",t.ui(r,null));case 6:if(!(i=t.hi(n.key,n.newValue))){e.next=9;break}return e.abrupt("return",t.ui(i.clientId,i));case 9:e.next=39;break;case 11:if(!t.zs.test(n.key)){e.next=18;break}if(null===n.newValue){e.next=16;break}if(!(a=t.li(n.key,n.newValue))){e.next=16;break}return e.abrupt("return",t.fi(a));case 16:e.next=39;break;case 18:if(!t.Hs.test(n.key)){e.next=25;break}if(null===n.newValue){e.next=23;break}if(!(u=t.di(n.key,n.newValue))){e.next=23;break}return e.abrupt("return",t.wi(u));case 23:e.next=39;break;case 25:if(n.key!==t.Js){e.next=32;break}if(null===n.newValue){e.next=30;break}if(!(o=t.Zs(n.newValue))){e.next=30;break}return e.abrupt("return",t.ti(o));case 30:e.next=39;break;case 32:if(n.key!==t.Ws){e.next=37;break}s=function(e){var t=Y.I;if(null!=e)try{var n=JSON.parse(e);M("number"==typeof n),t=n}catch(e){Z("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(n.newValue),s!==Y.I&&t.sequenceNumberHandler(s),e.next=39;break;case 37:if(n.key!==t.Ys){e.next=39;break}return e.abrupt("return",t.syncEngine._i());case 39:e.next=42;break;case 41:t.js.push(n);case 42:case"end":return e.stop()}}),e)}))))}}},{key:"ii",get:function(){return this.Ks.get(this.Bs)}},{key:"Xs",value:function(){this.setItem(this.Qs,this.ii.Os())}},{key:"ni",value:function(e,t,n){var r=new Ma(this.currentUser,e,t,n),i=Ra(this.persistenceKey,this.currentUser,e);this.setItem(i,r.Os())}},{key:"si",value:function(e){var t=Ra(this.persistenceKey,this.currentUser,e);this.removeItem(t)}},{key:"oi",value:function(e){var t={clientId:this.Bs,onlineState:e};this.storage.setItem(this.Js,JSON.stringify(t))}},{key:"ri",value:function(e,t,n){var r=La(this.persistenceKey,e),i=new Fa(e,t,n);this.setItem(r,i.Os())}},{key:"ai",value:function(){this.setItem(this.Ys,"value-not-used")}},{key:"ci",value:function(e){var t=this.Gs.exec(e);return t?t[1]:null}},{key:"hi",value:function(e,t){var n=this.ci(e);return Oa.Fs(n,t)}},{key:"li",value:function(e,t){var n=this.zs.exec(e),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Ma.Fs(new E(i),r,t)}},{key:"di",value:function(e,t){var n=this.Hs.exec(e),r=Number(n[1]);return Fa.Fs(r,t)}},{key:"Zs",value:function(e){return Pa.Fs(e)}},{key:"fi",value:(t=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.user.uid!==this.currentUser.uid){e.next=2;break}return e.abrupt("return",this.syncEngine.mi(t.batchId,t.state,t.error));case 2:D("SharedClientState","Ignoring mutation for non-active user ".concat(t.user.uid));case 3:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"wi",value:function(e){return this.syncEngine.gi(e.targetId,e.state,e.error)}},{key:"ui",value:function(e,t){var n=this,r=t?this.Ks.insert(e,t):this.Ks.remove(e),i=this.ei(this.Ks),a=this.ei(r),u=[],o=[];return a.forEach((function(e){i.has(e)||u.push(e)})),i.forEach((function(e){a.has(e)||o.push(e)})),this.syncEngine.yi(u,o).then((function(){n.Ks=r}))}},{key:"ti",value:function(e){this.Ks.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}},{key:"ei",value:function(e){var t=In();return e.forEach((function(e,n){t=t.unionWith(n.activeTargetIds)})),t}}],[{key:"bt",value:function(e){return!(!e||!e.localStorage)}}]),e}(),Ua=function(){function e(){(0,h.Z)(this,e),this.pi=new Va,this.Ti={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return(0,d.Z)(e,[{key:"addPendingMutation",value:function(e){}},{key:"updateMutationState",value:function(e,t,n){}},{key:"addLocalQueryTarget",value:function(e){return this.pi.Ms(e),this.Ti[e]||"not-current"}},{key:"updateQueryState",value:function(e,t,n){this.Ti[e]=t}},{key:"removeLocalQueryTarget",value:function(e){this.pi.Ls(e)}},{key:"isLocalQueryTarget",value:function(e){return this.pi.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){delete this.Ti[e]}},{key:"getAllActiveQueryTargets",value:function(){return this.pi.activeTargetIds}},{key:"isActiveQueryTarget",value:function(e){return this.pi.activeTargetIds.has(e)}},{key:"start",value:function(){return this.pi=new Va,Promise.resolve()}},{key:"handleUserChange",value:function(e,t,n){}},{key:"setOnlineState",value:function(e){}},{key:"shutdown",value:function(){}},{key:"writeSequenceNumber",value:function(e){}},{key:"notifyBundleLoaded",value:function(){}}]),e}(),Ba=function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,[{key:"Ei",value:function(e){}},{key:"shutdown",value:function(){}}]),e}(),Ka=function(){function e(){var t=this;(0,h.Z)(this,e),this.Ii=function(){return t.Ai()},this.Ri=function(){return t.Pi()},this.bi=[],this.vi()}return(0,d.Z)(e,[{key:"Ei",value:function(e){this.bi.push(e)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.Ii),window.removeEventListener("offline",this.Ri)}},{key:"vi",value:function(){window.addEventListener("online",this.Ii),window.addEventListener("offline",this.Ri)}},{key:"Ai",value:function(){D("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var e,t=b(this.bi);try{for(t.s();!(e=t.n()).done;){(0,e.value)(0)}}catch(n){t.e(n)}finally{t.f()}}},{key:"Pi",value:function(){D("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var e,t=b(this.bi);try{for(t.s();!(e=t.n()).done;){(0,e.value)(1)}}catch(n){t.e(n)}finally{t.f()}}}],[{key:"bt",value:function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]),e}(),ja={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Ga=function(){function e(t){(0,h.Z)(this,e),this.Vi=t.Vi,this.Si=t.Si}return(0,d.Z)(e,[{key:"Di",value:function(e){this.Ci=e}},{key:"Ni",value:function(e){this.ki=e}},{key:"onMessage",value:function(e){this.xi=e}},{key:"close",value:function(){this.Si()}},{key:"send",value:function(e){this.Vi(e)}},{key:"$i",value:function(){this.Ci()}},{key:"Fi",value:function(e){this.ki(e)}},{key:"Oi",value:function(e){this.xi(e)}}]),e}(),za=function(e){(0,o.Z)(n,e);var t=I(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this,e)).forceLongPolling=e.forceLongPolling,r.autoDetectLongPolling=e.autoDetectLongPolling,r.useFetchStreams=e.useFetchStreams,r}return(0,d.Z)(n,[{key:"Ki",value:function(e,t,n,r){return new Promise((function(i,a){var u=new w.JJ;u.listenOnce(w.tw.COMPLETE,(function(){try{switch(u.getLastErrorCode()){case w.jK.NO_ERROR:var t=u.getResponseJson();D("Connection","XHR received:",JSON.stringify(t)),i(t);break;case w.jK.TIMEOUT:D("Connection",'RPC "'+e+'" timed out'),a(new V(P.DEADLINE_EXCEEDED,"Request time out"));break;case w.jK.HTTP_ERROR:var n=u.getStatus();if(D("Connection",'RPC "'+e+'" failed with status:',n,"response text:",u.getResponseText()),n>0){var r=u.getResponseJson().error;if(r&&r.status&&r.message){var o=function(e){var t=e.toLowerCase().replace(/_/g,"-");return Object.values(P).indexOf(t)>=0?t:P.UNKNOWN}(r.status);a(new V(o,r.message))}else a(new V(P.UNKNOWN,"Server responded with status "+u.getStatus()))}else a(new V(P.UNAVAILABLE,"Connection failed."));break;default:L()}}finally{D("Connection",'RPC "'+e+'" completed.')}}));var o=JSON.stringify(r);u.send(t,"POST",o,n,15)}))}},{key:"Qi",value:function(e,t,n){var r=[this.Mi,"/","google.firestore.v1.Firestore","/",e,"/channel"],i=(0,w.UE)(),a=(0,w.FJ)(),u={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(u.xmlHttpFactory=new w.zI({})),this.qi(u.initMessageHeaders,t,n),(0,k.uI)()||(0,k.b$)()||(0,k.d)()||(0,k.w1)()||(0,k.Mn)()||(0,k.ru)()||(u.httpHeadersOverwriteParam="$httpHeaders");var o=r.join("");D("Connection","Creating WebChannel: "+o,u);var s=i.createWebChannel(o,u),c=!1,l=!1,f=new Ga({Vi:function(e){l?D("Connection","Not sending because WebChannel is closed:",e):(c||(D("Connection","Opening WebChannel transport."),s.open(),c=!0),D("Connection","WebChannel sending:",e),s.send(e))},Si:function(){return s.close()}}),h=function(e,t,n){e.listen(t,(function(e){try{n(e)}catch(e){setTimeout((function(){throw e}),0)}}))};return h(s,w.ii.EventType.OPEN,(function(){l||D("Connection","WebChannel transport opened.")})),h(s,w.ii.EventType.CLOSE,(function(){l||(l=!0,D("Connection","WebChannel transport closed"),f.Fi())})),h(s,w.ii.EventType.ERROR,(function(e){l||(l=!0,C("Connection","WebChannel transport errored:",e),f.Fi(new V(P.UNAVAILABLE,"The operation could not be completed")))})),h(s,w.ii.EventType.MESSAGE,(function(e){var t;if(!l){var n=e.data[0];M(!!n);var r=n,i=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(i){D("Connection","WebChannel received error:",i);var a=i.status,u=function(e){var t=tn[e];if(void 0!==t)return sn(t)}(a),o=i.message;void 0===u&&(u=P.INTERNAL,o="Unknown error status: "+a+" with message "+i.message),l=!0,f.Fi(new V(u,o)),s.close()}else D("Connection","WebChannel received:",n),f.Oi(n)}})),h(a,w.ju.STAT_EVENT,(function(e){e.stat===w.kN.PROXY?D("Connection","Detected buffering proxy"):e.stat===w.kN.NOPROXY&&D("Connection","Detected no buffering proxy")})),setTimeout((function(){f.$i()}),0),f}}]),n}(function(){function e(t){(0,h.Z)(this,e),this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http";this.Mi=n+"://"+t.host,this.Li="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return(0,d.Z)(e,[{key:"Bi",value:function(e,t,n,r,i){var a=this.Ui(e,t);D("RestConnection","Sending: ",a,n);var u={};return this.qi(u,r,i),this.Ki(e,a,u,n).then((function(e){return D("RestConnection","Received: ",e),e}),(function(t){throw C("RestConnection","".concat(e," failed with error: "),t,"url: ",a,"request:",n),t}))}},{key:"ji",value:function(e,t,n,r,i){return this.Bi(e,t,n,r,i)}},{key:"qi",value:function(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+S,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((function(t,n){return e[n]=t})),n&&n.headers.forEach((function(t,n){return e[n]=t}))}},{key:"Ui",value:function(e,t){var n=ja[e];return"".concat(this.Mi,"/v1/").concat(t,":").concat(n)}}]),e}());function Qa(){return"undefined"!=typeof window?window:null}function Wa(){return"undefined"!=typeof document?document:null}function Ha(e){return new Mn(e,!0)}var Ya=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;(0,h.Z)(this,e),this.Oe=t,this.timerId=n,this.Wi=r,this.Gi=i,this.zi=a,this.Hi=0,this.Ji=null,this.Yi=Date.now(),this.reset()}return(0,d.Z)(e,[{key:"reset",value:function(){this.Hi=0}},{key:"Xi",value:function(){this.Hi=this.zi}},{key:"Zi",value:function(e){var t=this;this.cancel();var n=Math.floor(this.Hi+this.tr()),r=Math.max(0,Date.now()-this.Yi),i=Math.max(0,n-r);i>0&&D("ExponentialBackoff","Backing off for ".concat(i," ms (base delay: ").concat(this.Hi," ms, delay with jitter: ").concat(n," ms, last attempt: ").concat(r," ms ago)")),this.Ji=this.Oe.enqueueAfterDelay(this.timerId,i,(function(){return t.Yi=Date.now(),e()})),this.Hi*=this.Gi,this.Hi<this.Wi&&(this.Hi=this.Wi),this.Hi>this.zi&&(this.Hi=this.zi)}},{key:"er",value:function(){null!==this.Ji&&(this.Ji.skipDelay(),this.Ji=null)}},{key:"cancel",value:function(){null!==this.Ji&&(this.Ji.cancel(),this.Ji=null)}},{key:"tr",value:function(){return(Math.random()-.5)*this.Hi}}]),e}(),Ja=function(){function e(t,n,r,i,a,u,o,s){(0,h.Z)(this,e),this.Oe=t,this.nr=r,this.sr=i,this.ir=a,this.authCredentialsProvider=u,this.appCheckCredentialsProvider=o,this.listener=s,this.state=0,this.rr=0,this.ar=null,this.cr=null,this.stream=null,this.ur=new Ya(t,n)}var t,n,r;return(0,d.Z)(e,[{key:"hr",value:function(){return 1===this.state||5===this.state||this.lr()}},{key:"lr",value:function(){return 2===this.state||3===this.state}},{key:"start",value:function(){4!==this.state?this.auth():this.dr()}},{key:"stop",value:(r=(0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.hr(),!e.t0){e.next=4;break}return e.next=4,this.close(0);case 4:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"wr",value:function(){this.state=0,this.ur.reset()}},{key:"_r",value:function(){var e=this;this.lr()&&null===this.ar&&(this.ar=this.Oe.enqueueAfterDelay(this.nr,6e4,(function(){return e.mr()})))}},{key:"gr",value:function(e){this.yr(),this.stream.send(e)}},{key:"mr",value:(n=(0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.lr()){e.next=2;break}return e.abrupt("return",this.close(0));case 2:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"yr",value:function(){this.ar&&(this.ar.cancel(),this.ar=null)}},{key:"pr",value:function(){this.cr&&(this.cr.cancel(),this.cr=null)}},{key:"close",value:(t=(0,u.Z)(y().mark((function e(t,n){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.yr(),this.pr(),this.ur.cancel(),this.rr++,4!==t?this.ur.reset():n&&n.code===P.RESOURCE_EXHAUSTED?(Z(n.toString()),Z("Using maximum backoff delay to prevent overloading the backend."),this.ur.Xi()):n&&n.code===P.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.Tr(),this.stream.close(),this.stream=null),this.state=t,e.next=9,this.listener.Ni(n);case 9:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"Tr",value:function(){}},{key:"auth",value:function(){var e=this;this.state=1;var t=this.Er(this.rr),n=this.rr;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((function(t){var r=(0,a.Z)(t,2),i=r[0],u=r[1];e.rr===n&&e.Ir(i,u)}),(function(n){t((function(){var t=new V(P.UNKNOWN,"Fetching auth token failed: "+n.message);return e.Ar(t)}))}))}},{key:"Ir",value:function(e,t){var n=this,r=this.Er(this.rr);this.stream=this.Rr(e,t),this.stream.Di((function(){r((function(){return n.state=2,n.cr=n.Oe.enqueueAfterDelay(n.sr,1e4,(function(){return n.lr()&&(n.state=3),Promise.resolve()})),n.listener.Di()}))})),this.stream.Ni((function(e){r((function(){return n.Ar(e)}))})),this.stream.onMessage((function(e){r((function(){return n.onMessage(e)}))}))}},{key:"dr",value:function(){var e=this;this.state=5,this.ur.Zi((0,u.Z)(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.state=0,e.start();case 1:case"end":return t.stop()}}),t)}))))}},{key:"Ar",value:function(e){return D("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}},{key:"Er",value:function(e){var t=this;return function(n){t.Oe.enqueueAndForget((function(){return t.rr===e?n():(D("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}}}]),e}(),Xa=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i,a,u,o){var s;return(0,h.Z)(this,n),(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,i,a,o)).k=u,s}return(0,d.Z)(n,[{key:"Rr",value:function(e,t){return this.ir.Qi("Listen",e,t)}},{key:"onMessage",value:function(e){this.ur.reset();var t=function(e,t){var n;if("targetChange"in t){t.targetChange;var r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:L()}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],a=function(e,t){return e.C?(M(void 0===t||"string"==typeof t),de.fromBase64String(t||"")):(M(void 0===t||t instanceof Uint8Array),de.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),u=t.targetChange.cause,o=u&&function(e){var t=void 0===e.code?P.UNKNOWN:sn(e.code);return new V(t,e.message||"")}(u);n=new _n(r,i,a,o||null)}else if("documentChange"in t){t.documentChange;var s=t.documentChange;s.document,s.document.name,s.document.updateTime;var c=Kn(e,s.document.name),l=Vn(s.document.updateTime),f=new Ve({mapValue:{fields:s.document.fields}}),h=Ue.newFoundDocument(c,l,f),d=s.targetIds||[],v=s.removedTargetIds||[];n=new Sn(d,v,h.key,h)}else if("documentDelete"in t){t.documentDelete;var y=t.documentDelete;y.document;var p=Kn(e,y.document),m=y.readTime?Vn(y.readTime):re.min(),g=Ue.newNoDocument(p,m),k=y.removedTargetIds||[];n=new Sn([],k,g.key,g)}else if("documentRemove"in t){t.documentRemove;var w=t.documentRemove;w.document;var b=Kn(e,w.document),x=w.removedTargetIds||[];n=new Sn([],x,b,null)}else{if(!("filter"in t))return L();t.filter;var I=t.filter;I.targetId;var T=I.count||0,E=new un(T),S=I.targetId;n=new An(S,E)}return n}(this.k,e),n=function(e){if(!("targetChange"in e))return re.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length?re.min():t.readTime?Vn(t.readTime):re.min()}(e);return this.listener.Pr(t,n)}},{key:"br",value:function(e){var t={};t.database=zn(this.k),t.addTarget=function(e,t){var n,r=t.target;return(n=ze(r)?{documents:$n(e,r)}:{query:er(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=On(e,t.resumeToken):t.snapshotVersion.compareTo(re.min())>0&&(n.readTime=Fn(e,t.snapshotVersion.toTimestamp())),n}(this.k,e);var n=function(e,t){var n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return L()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.k,e);n&&(t.labels=n),this.gr(t)}},{key:"vr",value:function(e){var t={};t.database=zn(this.k),t.removeTarget=e,this.gr(t)}}]),n}(Ja),$a=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i,a,u,o){var s;return(0,h.Z)(this,n),(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,i,a,o)).k=u,s.Vr=!1,s}return(0,d.Z)(n,[{key:"Sr",get:function(){return this.Vr}},{key:"start",value:function(){this.Vr=!1,this.lastStreamToken=void 0,(0,i.Z)((0,c.Z)(n.prototype),"start",this).call(this)}},{key:"Tr",value:function(){this.Vr&&this.Dr([])}},{key:"Rr",value:function(e,t){return this.ir.Qi("Write",e,t)}},{key:"onMessage",value:function(e){if(M(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Vr){this.ur.reset();var t=function(e,t){return e&&e.length>0?(M(void 0!==t),e.map((function(e){return function(e,t){var n=e.updateTime?Vn(e.updateTime):Vn(t);return n.isEqual(re.min())&&(n=Vn(t)),new Ut(n,e.transformResults||[])}(e,t)}))):[]}(e.writeResults,e.commitTime),n=Vn(e.commitTime);return this.listener.Cr(n,t)}return M(!e.writeResults||0===e.writeResults.length),this.Vr=!0,this.listener.Nr()}},{key:"kr",value:function(){var e={};e.database=zn(this.k),this.gr(e)}},{key:"Dr",value:function(e){var t=this,n={streamToken:this.lastStreamToken,writes:e.map((function(e){return Jn(t.k,e)}))};this.gr(n)}}]),n}(Ja),eu=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i,a){var u;return(0,h.Z)(this,n),(u=t.call(this)).authCredentials=e,u.appCheckCredentials=r,u.ir=i,u.k=a,u.$r=!1,u}return(0,d.Z)(n,[{key:"Fr",value:function(){if(this.$r)throw new V(P.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"Bi",value:function(e,t,n){var r=this;return this.Fr(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(i){var u=(0,a.Z)(i,2),o=u[0],s=u[1];return r.ir.Bi(e,t,n,o,s)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===P.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),e):new V(P.UNKNOWN,e.toString())}))}},{key:"ji",value:function(e,t,n){var r=this;return this.Fr(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(i){var u=(0,a.Z)(i,2),o=u[0],s=u[1];return r.ir.ji(e,t,n,o,s)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===P.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),e):new V(P.UNKNOWN,e.toString())}))}},{key:"terminate",value:function(){this.$r=!0}}]),n}(function(){return(0,d.Z)((function e(){(0,h.Z)(this,e)}))}()),tu=function(){function e(t,n){(0,h.Z)(this,e),this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.Or=0,this.Mr=null,this.Lr=!0}return(0,d.Z)(e,[{key:"Br",value:function(){var e=this;0===this.Or&&(this.Ur("Unknown"),this.Mr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return e.Mr=null,e.qr("Backend didn't respond within 10 seconds."),e.Ur("Offline"),Promise.resolve()})))}},{key:"Kr",value:function(e){"Online"===this.state?this.Ur("Unknown"):(this.Or++,this.Or>=1&&(this.jr(),this.qr("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.Ur("Offline")))}},{key:"set",value:function(e){this.jr(),this.Or=0,"Online"===e&&(this.Lr=!1),this.Ur(e)}},{key:"Ur",value:function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}},{key:"qr",value:function(e){var t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.Lr?(Z(t),this.Lr=!1):D("OnlineStateTracker",t)}},{key:"jr",value:function(){null!==this.Mr&&(this.Mr.cancel(),this.Mr=null)}}]),e}(),nu=(0,d.Z)((function e(t,n,r,i,a){var o=this;(0,h.Z)(this,e),this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.Qr=[],this.Wr=new Map,this.Gr=new Set,this.zr=[],this.Hr=a,this.Hr.Ei((function(e){r.enqueueAndForget((0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=du(o),!e.t0){e.next=5;break}return D("RemoteStore","Restarting streams for network reachability change."),e.next=5,function(){var e=(0,u.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=O(t)).Gr.add(4),e.next=4,au(n);case 4:return n.Jr.set("Unknown"),n.Gr.delete(4),e.next=8,ru(n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(o);case 5:case"end":return e.stop()}}),e)}))))})),this.Jr=new tu(r,i)}));function ru(e){return iu.apply(this,arguments)}function iu(){return(iu=(0,u.Z)(y().mark((function e(t){var n,r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!du(t)){e.next=18;break}n=b(t.zr),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return i=r.value,e.next=8,i(!0);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,12,15,18]])})))).apply(this,arguments)}function au(e){return uu.apply(this,arguments)}function uu(){return(uu=(0,u.Z)(y().mark((function e(t){var n,r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=b(t.zr),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return i=r.value,e.next=7,i(!1);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})))).apply(this,arguments)}function ou(e,t){var n=O(e);n.Wr.has(t.targetId)||(n.Wr.set(t.targetId,t),hu(n)?fu(n):qu(n).lr()&&cu(n,t))}function su(e,t){var n=O(e),r=qu(n);n.Wr.delete(t),r.lr()&&lu(n,t),0===n.Wr.size&&(r.lr()?r._r():du(n)&&n.Jr.set("Unknown"))}function cu(e,t){e.Yr.X(t.targetId),qu(e).br(t)}function lu(e,t){e.Yr.X(t),qu(e).vr(t)}function fu(e){e.Yr=new Dn({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},Et:function(t){return e.Wr.get(t)||null}}),qu(e).start(),e.Jr.Br()}function hu(e){return du(e)&&!qu(e).hr()&&e.Wr.size>0}function du(e){return 0===O(e).Gr.size}function vu(e){e.Yr=void 0}function yu(e){return pu.apply(this,arguments)}function pu(){return(pu=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.Wr.forEach((function(e,n){cu(t,e)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mu(e,t){return gu.apply(this,arguments)}function gu(){return(gu=(0,u.Z)(y().mark((function e(t,n){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:vu(t),hu(t)?(t.Jr.Kr(n),fu(t)):t.Jr.set("Unknown");case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ku(e,t,n){return wu.apply(this,arguments)}function wu(){return wu=(0,u.Z)(y().mark((function e(t,n,r){var i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.Jr.set("Online"),!(n instanceof _n&&2===n.state&&n.cause)){e.next=13;break}return e.prev=1,e.next=4,function(){var e=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.cause,i=b(n.targetIds),e.prev=2,i.s();case 4:if((a=i.n()).done){e.next=14;break}if(u=a.value,e.t0=t.Wr.has(u),!e.t0){e.next=12;break}return e.next=10,t.remoteSyncer.rejectListen(u,r);case 10:t.Wr.delete(u),t.Yr.removeTarget(u);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(2),i.e(e.t1);case 19:return e.prev=19,i.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[2,16,19,22]])})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(1),D("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),e.t0),e.next=11,bu(t,e.t0);case 11:case 22:e.next=29;break;case 13:if(n instanceof Sn?t.Yr.ot(n):n instanceof An?t.Yr.dt(n):t.Yr.ut(n),r.isEqual(re.min())){e.next=29;break}return e.prev=14,e.next=17,ua(t.localStore);case 17:if(i=e.sent,e.t1=r.compareTo(i)>=0,!e.t1){e.next=22;break}return e.next=22,function(e,t){var n=e.Yr.gt(t);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=e.Wr.get(r);i&&e.Wr.set(r,i.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((function(t){var n=e.Wr.get(t);if(n){e.Wr.set(t,n.withResumeToken(de.EMPTY_BYTE_STRING,n.snapshotVersion)),lu(e,t);var r=new Yr(n.target,t,1,n.sequenceNumber);cu(e,r)}})),e.remoteSyncer.applyRemoteEvent(n)}(t,r);case 24:return e.prev=24,e.t2=e.catch(14),D("RemoteStore","Failed to raise snapshot:",e.t2),e.next=29,bu(t,e.t2);case 29:case"end":return e.stop()}}),e,null,[[1,6],[14,24]])}))),wu.apply(this,arguments)}function bu(e,t,n){return xu.apply(this,arguments)}function xu(){return(xu=(0,u.Z)(y().mark((function e(t,n,r){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ur(n)){e.next=2;break}throw n;case 2:return t.Gr.add(1),e.next=5,au(t);case 5:t.Jr.set("Offline"),r||(r=function(){return ua(t.localStore)}),t.asyncQueue.enqueueRetryable((0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D("RemoteStore","Retrying IndexedDB access"),e.next=3,r();case 3:return t.Gr.delete(1),e.next=6,ru(t);case 6:case"end":return e.stop()}}),e)}))));case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Iu(e,t){return t().catch((function(n){return bu(e,n,t)}))}function Tu(e){return Eu.apply(this,arguments)}function Eu(){return(Eu=(0,u.Z)(y().mark((function e(t){var n,r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=O(t),r=Uu(n),i=n.Qr.length>0?n.Qr[n.Qr.length-1].batchId:-1;case 2:if(!Su(n)){e.next=19;break}return e.prev=3,e.next=6,ca(n.localStore,i);case 6:if(null!==(a=e.sent)){e.next=10;break}return 0===n.Qr.length&&r._r(),e.abrupt("break",19);case 10:i=a.batchId,Au(n,a),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(3),e.next=17,bu(n,e.t0);case 17:e.next=2;break;case 19:_u(n)&&Nu(n);case 20:case"end":return e.stop()}}),e,null,[[3,13]])})))).apply(this,arguments)}function Su(e){return du(e)&&e.Qr.length<10}function Au(e,t){e.Qr.push(t);var n=Uu(e);n.lr()&&n.Sr&&n.Dr(t.mutations)}function _u(e){return du(e)&&!Uu(e).hr()&&e.Qr.length>0}function Nu(e){Uu(e).start()}function Du(e){return Zu.apply(this,arguments)}function Zu(){return(Zu=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Uu(t).kr();case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Cu(e){return Ru.apply(this,arguments)}function Ru(){return(Ru=(0,u.Z)(y().mark((function e(t){var n,r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Uu(t),r=b(t.Qr);try{for(r.s();!(i=r.n()).done;)a=i.value,n.Dr(a.mutations)}catch(u){r.e(u)}finally{r.f()}case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Lu(e,t,n){return Mu.apply(this,arguments)}function Mu(){return(Mu=(0,u.Z)(y().mark((function e(t,n,r){var i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.Qr.shift(),a=Hr.from(i,n,r),e.next=3,Iu(t,(function(){return t.remoteSyncer.applySuccessfulWrite(a)}));case 3:return e.next=5,Tu(t);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fu(e,t){return Ou.apply(this,arguments)}function Ou(){return Ou=(0,u.Z)(y().mark((function e(t,n){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n&&Uu(t).Sr,!e.t0){e.next=4;break}return e.next=4,function(){var e=(0,u.Z)(y().mark((function e(t,n){var r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!on(i=n.code)||i===P.ABORTED){e.next=7;break}return r=t.Qr.shift(),Uu(t).wr(),e.next=5,Iu(t,(function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)}));case 5:return e.next=7,Tu(t);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:_u(t)&&Nu(t);case 5:case"end":return e.stop()}}),e)}))),Ou.apply(this,arguments)}function Pu(e,t){return Vu.apply(this,arguments)}function Vu(){return(Vu=(0,u.Z)(y().mark((function e(t,n){var r;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=O(t),!n){e.next=7;break}return r.Gr.delete(2),e.next=5,ru(r);case 5:e.next=13;break;case 7:if(e.t0=n,e.t0){e.next=13;break}return r.Gr.add(2),e.next=12,au(r);case 12:r.Jr.set("Unknown");case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qu(e){return e.Xr||(e.Xr=function(e,t,n){var r=O(e);return r.Fr(),new Xa(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:yu.bind(null,e),Ni:mu.bind(null,e),Pr:ku.bind(null,e)}),e.zr.push(function(){var t=(0,u.Z)(y().mark((function t(n){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=4;break}e.Xr.wr(),hu(e)?fu(e):e.Jr.set("Unknown"),t.next=7;break;case 4:return t.next=6,e.Xr.stop();case 6:vu(e);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.Xr}function Uu(e){return e.Zr||(e.Zr=function(e,t,n){var r=O(e);return r.Fr(),new $a(t,r.ir,r.authCredentials,r.appCheckCredentials,r.k,n)}(e.datastore,e.asyncQueue,{Di:Du.bind(null,e),Ni:Fu.bind(null,e),Nr:Cu.bind(null,e),Cr:Lu.bind(null,e)}),e.zr.push(function(){var t=(0,u.Z)(y().mark((function t(n){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return e.Zr.wr(),t.next=4,Tu(e);case 4:t.next=9;break;case 6:return t.next=8,e.Zr.stop();case 8:e.Qr.length>0&&(D("RemoteStore","Stopping write stream with ".concat(e.Qr.length," pending writes")),e.Qr=[]);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.Zr}var Bu=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=i,this.removalCallback=a,this.deferred=new q,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(e){}))}return(0,d.Z)(e,[{key:"start",value:function(e){var t=this;this.timerHandle=setTimeout((function(){return t.handleDelayElapsed()}),e)}},{key:"skipDelay",value:function(){return this.handleDelayElapsed()}},{key:"cancel",value:function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new V(P.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}},{key:"handleDelayElapsed",value:function(){var e=this;this.asyncQueue.enqueueAndForget((function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then((function(t){return e.deferred.resolve(t)}))):Promise.resolve()}))}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}))}],[{key:"createAndSchedule",value:function(t,n,r,i,a){var u=new e(t,n,Date.now()+r,i,a);return u.start(r),u}}]),e}();function Ku(e,t){if(Z("AsyncQueue","".concat(t,": ").concat(e)),Ur(e))return new V(P.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}var ju=function(){function e(t){(0,h.Z)(this,e),this.comparator=t?function(e,n){return t(e,n)||Te.comparator(e.key,n.key)}:function(e,t){return Te.comparator(e.key,t.key)},this.keyedMap=mn(),this.sortedSet=new cn(this.comparator)}return(0,d.Z)(e,[{key:"has",value:function(e){return null!=this.keyedMap.get(e)}},{key:"get",value:function(e){return this.keyedMap.get(e)}},{key:"first",value:function(){return this.sortedSet.minKey()}},{key:"last",value:function(){return this.sortedSet.maxKey()}},{key:"isEmpty",value:function(){return this.sortedSet.isEmpty()}},{key:"indexOf",value:function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}},{key:"size",get:function(){return this.sortedSet.size}},{key:"forEach",value:function(e){this.sortedSet.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"add",value:function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}},{key:"delete",value:function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,a=r.getNext().key;if(!i.isEqual(a))return!1}return!0}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}},{key:"copy",value:function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}}],[{key:"emptySet",value:function(t){return new e(t.comparator)}}]),e}(),Gu=function(){function e(){(0,h.Z)(this,e),this.eo=new cn(Te.comparator)}return(0,d.Z)(e,[{key:"track",value:function(e){var t=e.doc.key,n=this.eo.get(t);n?0!==e.type&&3===n.type?this.eo=this.eo.insert(t,e):3===e.type&&1!==n.type?this.eo=this.eo.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.eo=this.eo.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.eo=this.eo.remove(t):1===e.type&&2===n.type?this.eo=this.eo.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.eo=this.eo.insert(t,{type:2,doc:e.doc}):L():this.eo=this.eo.insert(t,e)}},{key:"no",value:function(){var e=[];return this.eo.inorderTraversal((function(t,n){e.push(n)})),e}}]),e}(),zu=function(){function e(t,n,r,i,a,u,o,s){(0,h.Z)(this,e),this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=a,this.fromCache=u,this.syncStateChanged=o,this.excludesMetadataChanges=s}return(0,d.Z)(e,[{key:"hasPendingWrites",get:function(){return!this.mutatedKeys.isEmpty()}},{key:"isEqual",value:function(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&kt(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}],[{key:"fromInitialDocuments",value:function(t,n,r,i){var a=[];return n.forEach((function(e){a.push({type:0,doc:e})})),new e(t,n,ju.emptySet(n),a,r,i,!0,!1)}}]),e}(),Qu=(0,d.Z)((function e(){(0,h.Z)(this,e),this.so=void 0,this.listeners=[]})),Wu=(0,d.Z)((function e(){(0,h.Z)(this,e),this.queries=new Oi((function(e){return wt(e)}),kt),this.onlineState="Unknown",this.io=new Set}));function Hu(e,t){return Yu.apply(this,arguments)}function Yu(){return(Yu=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=O(t),i=n.query,a=!1,(u=r.queries.get(i))||(a=!0,u=new Qu),!a){e.next=13;break}return e.prev=3,e.next=6,r.onListen(i);case 6:u.so=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),o=Ku(e.t0,"Initialization of query '".concat(bt(n.query),"' failed")),e.abrupt("return",void n.onError(o));case 13:r.queries.set(i,u),u.listeners.push(n),n.ro(r.onlineState),u.so&&n.oo(u.so)&&to(r);case 14:case"end":return e.stop()}}),e,null,[[3,9]])})))).apply(this,arguments)}function Ju(e,t){return Xu.apply(this,arguments)}function Xu(){return(Xu=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=O(t),i=n.query,a=!1,(u=r.queries.get(i))&&(o=u.listeners.indexOf(n))>=0&&(u.listeners.splice(o,1),a=0===u.listeners.length),!a){e.next=6;break}return e.abrupt("return",(r.queries.delete(i),r.onUnlisten(i)));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $u(e,t){var n,r=O(e),i=!1,a=b(t);try{for(a.s();!(n=a.n()).done;){var u=n.value,o=u.query,s=r.queries.get(o);if(s){var c,l=b(s.listeners);try{for(l.s();!(c=l.n()).done;){c.value.oo(u)&&(i=!0)}}catch(f){l.e(f)}finally{l.f()}s.so=u}}}catch(f){a.e(f)}finally{a.f()}i&&to(r)}function eo(e,t,n){var r=O(e),i=r.queries.get(t);if(i){var a,u=b(i.listeners);try{for(u.s();!(a=u.n()).done;){a.value.onError(n)}}catch(o){u.e(o)}finally{u.f()}}r.queries.delete(t)}function to(e){e.io.forEach((function(e){e.next()}))}var no=function(){function e(t,n,r){(0,h.Z)(this,e),this.query=t,this.ao=n,this.co=!1,this.uo=null,this.onlineState="Unknown",this.options=r||{}}return(0,d.Z)(e,[{key:"oo",value:function(e){if(!this.options.includeMetadataChanges){var t,n=[],r=b(e.docChanges);try{for(r.s();!(t=r.n()).done;){var i=t.value;3!==i.type&&n.push(i)}}catch(u){r.e(u)}finally{r.f()}e=new zu(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}var a=!1;return this.co?this.ho(e)&&(this.ao.next(e),a=!0):this.lo(e,this.onlineState)&&(this.fo(e),a=!0),this.uo=e,a}},{key:"onError",value:function(e){this.ao.error(e)}},{key:"ro",value:function(e){this.onlineState=e;var t=!1;return this.uo&&!this.co&&this.lo(this.uo,e)&&(this.fo(this.uo),t=!0),t}},{key:"lo",value:function(e,t){if(!e.fromCache)return!0;var n="Offline"!==t;return!(this.options.wo&&n||e.docs.isEmpty()&&"Offline"!==t)}},{key:"ho",value:function(e){if(e.docChanges.length>0)return!0;var t=this.uo&&this.uo.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}},{key:"fo",value:function(e){e=zu.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.co=!0,this.ao.next(e)}}]),e}(),ro=function(){function e(t,n){(0,h.Z)(this,e),this.payload=t,this.byteLength=n}return(0,d.Z)(e,[{key:"_o",value:function(){return"metadata"in this.payload}}]),e}(),io=function(){function e(t){(0,h.Z)(this,e),this.k=t}return(0,d.Z)(e,[{key:"Hn",value:function(e){return Kn(this.k,e)}},{key:"Jn",value:function(e){return e.metadata.exists?Hn(this.k,e.document,!1):Ue.newNoDocument(this.Hn(e.metadata.name),this.Yn(e.metadata.readTime))}},{key:"Yn",value:function(e){return Vn(e)}}]),e}(),ao=function(){function e(t,n,r){(0,h.Z)(this,e),this.mo=t,this.localStore=n,this.k=r,this.queries=[],this.documents=[],this.progress=uo(t)}var t;return(0,d.Z)(e,[{key:"yo",value:function(e){this.progress.bytesLoaded+=e.byteLength;var t=this.progress.documentsLoaded;return e.payload.namedQuery?this.queries.push(e.payload.namedQuery):e.payload.documentMetadata?(this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t):e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t),t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}},{key:"po",value:function(e){var t,n=new Map,r=new io(this.k),i=b(e);try{for(i.s();!(t=i.n()).done;){var a=t.value;if(a.metadata.queries){var u,o=r.Hn(a.metadata.name),s=b(a.metadata.queries);try{for(s.s();!(u=s.n()).done;){var c=u.value,l=(n.get(c)||bn()).add(o);n.set(c,l)}}catch(f){s.e(f)}finally{s.f()}}}}catch(f){i.e(f)}finally{i.f()}return n}},{key:"complete",value:(t=(0,u.Z)(y().mark((function e(){var t,n,r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ga(this.localStore,new io(this.k),this.documents,this.mo.id);case 2:t=e.sent,n=this.po(this.documents),r=b(this.queries),e.prev=5,r.s();case 7:if((i=r.n()).done){e.next=13;break}return a=i.value,e.next=11,wa(this.localStore,a,n.get(a.name));case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",(this.progress.taskState="Success",new Ji(Object.assign({},this.progress),t)));case 22:case"end":return e.stop()}}),e,this,[[5,15,18,21]])}))),function(){return t.apply(this,arguments)})}]),e}();function uo(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}var oo=(0,d.Z)((function e(t){(0,h.Z)(this,e),this.key=t})),so=(0,d.Z)((function e(t){(0,h.Z)(this,e),this.key=t})),co=function(){function e(t,n){(0,h.Z)(this,e),this.query=t,this.To=n,this.Eo=null,this.current=!1,this.Io=bn(),this.mutatedKeys=bn(),this.Ao=It(t),this.Ro=new ju(this.Ao)}return(0,d.Z)(e,[{key:"Po",get:function(){return this.To}},{key:"bo",value:function(e,t){var n=this,r=t?t.vo:new Gu,i=t?t.Ro:this.Ro,a=t?t.mutatedKeys:this.mutatedKeys,u=i,o=!1,s=ft(this.query)&&i.size===this.query.limit?i.last():null,c=ht(this.query)&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((function(e,t){var l=i.get(e),f=xt(n.query,t)?t:null,h=!!l&&n.mutatedKeys.has(l.key),d=!!f&&(f.hasLocalMutations||n.mutatedKeys.has(f.key)&&f.hasCommittedMutations),v=!1;l&&f?l.data.isEqual(f.data)?h!==d&&(r.track({type:3,doc:f}),v=!0):n.Vo(l,f)||(r.track({type:2,doc:f}),v=!0,(s&&n.Ao(f,s)>0||c&&n.Ao(f,c)<0)&&(o=!0)):!l&&f?(r.track({type:0,doc:f}),v=!0):l&&!f&&(r.track({type:1,doc:l}),v=!0,(s||c)&&(o=!0)),v&&(f?(u=u.add(f),a=d?a.add(e):a.delete(e)):(u=u.delete(e),a=a.delete(e)))})),ft(this.query)||ht(this.query))for(;u.size>this.query.limit;){var l=ft(this.query)?u.last():u.first();u=u.delete(l.key),a=a.delete(l.key),r.track({type:1,doc:l})}return{Ro:u,vo:r,Bn:o,mutatedKeys:a}}},{key:"Vo",value:function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}},{key:"applyChanges",value:function(e,t,n){var r=this,i=this.Ro;this.Ro=e.Ro,this.mutatedKeys=e.mutatedKeys;var a=e.vo.no();a.sort((function(e,t){return function(e,t){var n=function(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return L()}};return n(e)-n(t)}(e.type,t.type)||r.Ao(e.doc,t.doc)})),this.So(n);var u=t?this.Do():[],o=0===this.Io.size&&this.current?1:0,s=o!==this.Eo;return this.Eo=o,0!==a.length||s?{snapshot:new zu(this.query,e.Ro,i,a,e.mutatedKeys,0===o,s,!1),Co:u}:{Co:u}}},{key:"ro",value:function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Ro:this.Ro,vo:new Gu,mutatedKeys:this.mutatedKeys,Bn:!1},!1)):{Co:[]}}},{key:"No",value:function(e){return!this.To.has(e)&&!!this.Ro.has(e)&&!this.Ro.get(e).hasLocalMutations}},{key:"So",value:function(e){var t=this;e&&(e.addedDocuments.forEach((function(e){return t.To=t.To.add(e)})),e.modifiedDocuments.forEach((function(e){})),e.removedDocuments.forEach((function(e){return t.To=t.To.delete(e)})),this.current=e.current)}},{key:"Do",value:function(){var e=this;if(!this.current)return[];var t=this.Io;this.Io=bn(),this.Ro.forEach((function(t){e.No(t.key)&&(e.Io=e.Io.add(t.key))}));var n=[];return t.forEach((function(t){e.Io.has(t)||n.push(new so(t))})),this.Io.forEach((function(e){t.has(e)||n.push(new oo(e))})),n}},{key:"ko",value:function(e){this.To=e.zn,this.Io=bn();var t=this.bo(e.documents);return this.applyChanges(t,!0)}},{key:"xo",value:function(){return zu.fromInitialDocuments(this.query,this.Ro,this.mutatedKeys,0===this.Eo)}}]),e}(),lo=(0,d.Z)((function e(t,n,r){(0,h.Z)(this,e),this.query=t,this.targetId=n,this.view=r})),fo=(0,d.Z)((function e(t){(0,h.Z)(this,e),this.key=t,this.$o=!1})),ho=function(){function e(t,n,r,i,a,u){(0,h.Z)(this,e),this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=i,this.currentUser=a,this.maxConcurrentLimboResolutions=u,this.Fo={},this.Oo=new Oi((function(e){return wt(e)}),kt),this.Mo=new Map,this.Lo=new Set,this.Bo=new cn(Te.comparator),this.Uo=new Map,this.qo=new Ia,this.Ko={},this.jo=new Map,this.Qo=Ti.re(),this.onlineState="Unknown",this.Wo=void 0}return(0,d.Z)(e,[{key:"isPrimaryClient",get:function(){return!0===this.Wo}}]),e}();function vo(e,t){return yo.apply(this,arguments)}function yo(){return(yo=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u,o,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=os(t),!(u=r.Oo.get(n))){e.next=6;break}i=u.targetId,r.sharedClientState.addLocalQueryTarget(i),a=u.view.xo(),e.next=15;break;case 6:return e.next=8,la(r.localStore,mt(n));case 8:return o=e.sent,s=r.sharedClientState.addLocalQueryTarget(o.targetId),i=o.targetId,e.next=13,po(r,n,i,"current"===s);case 13:a=e.sent,r.isPrimaryClient&&ou(r.remoteStore,o);case 15:return e.abrupt("return",a);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function po(e,t,n,r){return mo.apply(this,arguments)}function mo(){return mo=(0,u.Z)(y().mark((function e(t,n,r,i){var a,o,s,c,l,f;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.Go=function(e,n,r){return(i=(0,u.Z)(y().mark((function e(t,n,r,i){var a,u,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=n.view.bo(r),e.t0=a.Bn,!e.t0){e.next=6;break}return e.next=5,da(t.localStore,n.query,!1).then((function(e){var t=e.documents;return n.view.bo(t,a)}));case 5:a=e.sent;case 6:return u=i&&i.targetChanges.get(n.targetId),o=n.view.applyChanges(a,t.isPrimaryClient,u),e.abrupt("return",(Oo(t,n.targetId,o.Co),o.snapshot));case 8:case"end":return e.stop()}}),e)}))),function(e,t,n,r){return i.apply(this,arguments)})(t,e,n,r);var i},e.next=3,da(t.localStore,n,!0);case 3:return a=e.sent,o=new co(n,a.zn),s=o.bo(a.documents),c=En.createSynthesizedTargetChangeForCurrentChange(r,i&&"Offline"!==t.onlineState),l=o.applyChanges(s,t.isPrimaryClient,c),Oo(t,r,l.Co),f=new lo(n,r,o),e.abrupt("return",(t.Oo.set(n,f),t.Mo.has(r)?t.Mo.get(r).push(n):t.Mo.set(r,[n]),l.snapshot));case 11:case"end":return e.stop()}}),e)}))),mo.apply(this,arguments)}function go(e,t){return ko.apply(this,arguments)}function ko(){return(ko=(0,u.Z)(y().mark((function e(t,n){var r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=O(t),i=r.Oo.get(n),!((a=r.Mo.get(i.targetId)).length>1)){e.next=3;break}return e.abrupt("return",(r.Mo.set(i.targetId,a.filter((function(e){return!kt(e,n)}))),void r.Oo.delete(n)));case 3:if(!r.isPrimaryClient){e.next=11;break}if(r.sharedClientState.removeLocalQueryTarget(i.targetId),e.t0=r.sharedClientState.isActiveQueryTarget(i.targetId),e.t0){e.next=9;break}return e.next=9,fa(r.localStore,i.targetId,!1).then((function(){r.sharedClientState.clearQueryState(i.targetId),su(r.remoteStore,i.targetId),Mo(r,i.targetId)})).catch(Ni);case 9:e.next=14;break;case 11:return Mo(r,i.targetId),e.next=14,fa(r.localStore,i.targetId,!0);case 14:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wo(e,t,n){return bo.apply(this,arguments)}function bo(){return(bo=(0,u.Z)(y().mark((function e(t,n,r){var i,a,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=ss(t),e.prev=1,e.next=4,function(e,t){var n,r=O(e),i=ne.now(),a=t.reduce((function(e,t){return e.add(t.key)}),bn());return r.persistence.runTransaction("Locally write mutations","readwrite",(function(e){return r.Wn.vn(e,a).next((function(a){n=a;var u,o=[],s=b(t);try{for(s.s();!(u=s.n()).done;){var c=u.value,l=Qt(c,n.get(c.key));null!=l&&o.push(new Jt(c.key,l,qe(l.value.mapValue),Bt.exists(!0)))}}catch(f){s.e(f)}finally{s.f()}return r.An.addMutationBatch(e,i,o,t)}))})).then((function(e){return e.applyToLocalDocumentSet(n),{batchId:e.batchId,changes:n}}))}(i.localStore,n);case 4:return a=e.sent,i.sharedClientState.addPendingMutation(a.batchId),function(e,t,n){var r=e.Ko[e.currentUser.toKey()];r||(r=new cn($)),r=r.insert(t,n),e.Ko[e.currentUser.toKey()]=r}(i,a.batchId,r),e.next=9,qo(i,a.changes);case 9:return e.next=11,Tu(i.remoteStore);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),u=Ku(e.t0,"Failed to persist write"),r.reject(u);case 17:case"end":return e.stop()}}),e,null,[[1,13]])})))).apply(this,arguments)}function xo(e,t){return Io.apply(this,arguments)}function Io(){return(Io=(0,u.Z)(y().mark((function e(t,n){var r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=O(t),e.prev=1,e.next=4,oa(r.localStore,n);case 4:return i=e.sent,n.targetChanges.forEach((function(e,t){var n=r.Uo.get(t);n&&(M(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?n.$o=!0:e.modifiedDocuments.size>0?M(n.$o):e.removedDocuments.size>0&&(M(n.$o),n.$o=!1))})),e.next=8,qo(r,i,n);case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,Ni(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,10]])})))).apply(this,arguments)}function To(e,t,n){var r=O(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Oo.forEach((function(e,n){var r=n.view.ro(t);r.snapshot&&i.push(r.snapshot)})),function(e,t){var n=O(e);n.onlineState=t;var r=!1;n.queries.forEach((function(e,n){var i,a=b(n.listeners);try{for(a.s();!(i=a.n()).done;){i.value.ro(t)&&(r=!0)}}catch(u){a.e(u)}finally{a.f()}})),r&&to(n)}(r.eventManager,t),i.length&&r.Fo.Pr(i),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Eo(e,t,n){return So.apply(this,arguments)}function So(){return(So=(0,u.Z)(y().mark((function e(t,n,r){var i,a,u,o,s,c;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((i=O(t)).sharedClientState.updateQueryState(n,"rejected",r),a=i.Uo.get(n),!(u=a&&a.key)){e.next=14;break}return o=(o=new cn(Te.comparator)).insert(u,Ue.newNoDocument(u,re.min())),s=bn().add(u),c=new Tn(re.min(),new Map,new hn($),o,s),e.next=9,xo(i,c);case 9:i.Bo=i.Bo.remove(u),i.Uo.delete(n),Vo(i),e.next=16;break;case 14:return e.next=16,fa(i.localStore,n,!1).then((function(){return Mo(i,n,r)})).catch(Ni);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ao(e,t){return _o.apply(this,arguments)}function _o(){return(_o=(0,u.Z)(y().mark((function e(t,n){var r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=O(t),i=n.batch.batchId,e.prev=1,e.next=4,aa(r.localStore,n);case 4:return a=e.sent,Lo(r,i,null),Ro(r,i),r.sharedClientState.updateMutationState(i,"acknowledged"),e.next=10,qo(r,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Ni(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}function No(e,t,n){return Do.apply(this,arguments)}function Do(){return(Do=(0,u.Z)(y().mark((function e(t,n,r){var i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=O(t),e.prev=1,e.next=4,function(e,t){var n=O(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(e){var r;return n.An.lookupMutationBatch(e,t).next((function(t){return M(null!==t),r=t.keys(),n.An.removeMutationBatch(e,t)})).next((function(){return n.An.performConsistencyCheck(e)})).next((function(){return n.Wn.vn(e,r)}))}))}(i.localStore,n);case 4:return a=e.sent,Lo(i,n,r),Ro(i,n),i.sharedClientState.updateMutationState(n,"rejected",r),e.next=10,qo(i,a);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,Ni(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])})))).apply(this,arguments)}function Zo(e,t){return Co.apply(this,arguments)}function Co(){return(Co=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return du((r=O(t)).remoteStore)||D("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),e.prev=2,e.next=5,function(e){var t=O(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(e){return t.An.getHighestUnacknowledgedBatchId(e)}))}(r.localStore);case 5:if(-1!==(i=e.sent)){e.next=8;break}return e.abrupt("return",void n.resolve());case 8:(a=r.jo.get(i)||[]).push(n),r.jo.set(i,a),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),u=Ku(e.t0,"Initialization of waitForPendingWrites() operation failed"),n.reject(u);case 16:case"end":return e.stop()}}),e,null,[[2,12]])})))).apply(this,arguments)}function Ro(e,t){(e.jo.get(t)||[]).forEach((function(e){e.resolve()})),e.jo.delete(t)}function Lo(e,t,n){var r=O(e),i=r.Ko[r.currentUser.toKey()];if(i){var a=i.get(t);a&&(n?a.reject(n):a.resolve(),i=i.remove(t)),r.Ko[r.currentUser.toKey()]=i}}function Mo(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);var r,i=b(e.Mo.get(t));try{for(i.s();!(r=i.n()).done;){var a=r.value;e.Oo.delete(a),n&&e.Fo.zo(a,n)}}catch(u){i.e(u)}finally{i.f()}e.Mo.delete(t),e.isPrimaryClient&&e.qo.us(t).forEach((function(t){e.qo.containsKey(t)||Fo(e,t)}))}function Fo(e,t){e.Lo.delete(t.path.canonicalString());var n=e.Bo.get(t);null!==n&&(su(e.remoteStore,n),e.Bo=e.Bo.remove(t),e.Uo.delete(n),Vo(e))}function Oo(e,t,n){var r,i=b(n);try{for(i.s();!(r=i.n()).done;){var a=r.value;a instanceof oo?(e.qo.addReference(a.key,t),Po(e,a)):a instanceof so?(D("SyncEngine","Document no longer in limbo: "+a.key),e.qo.removeReference(a.key,t),e.qo.containsKey(a.key)||Fo(e,a.key)):L()}}catch(u){i.e(u)}finally{i.f()}}function Po(e,t){var n=t.key,r=n.path.canonicalString();e.Bo.get(n)||e.Lo.has(r)||(D("SyncEngine","New document in limbo: "+n),e.Lo.add(r),Vo(e))}function Vo(e){for(;e.Lo.size>0&&e.Bo.size<e.maxConcurrentLimboResolutions;){var t=e.Lo.values().next().value;e.Lo.delete(t);var n=new Te(se.fromString(t)),r=e.Qo.next();e.Uo.set(r,new fo(n)),e.Bo=e.Bo.insert(n,r),ou(e.remoteStore,new Yr(mt(lt(n.path)),r,2,Y.I))}}function qo(e,t,n){return Uo.apply(this,arguments)}function Uo(){return Uo=(0,u.Z)(y().mark((function e(t,n,r){var i,a,o,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=O(t),a=[],o=[],s=[],e.t0=i.Oo.isEmpty(),e.t0){e.next=9;break}return i.Oo.forEach((function(e,t){s.push(i.Go(t,n,r).then((function(e){if(e){i.isPrimaryClient&&i.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),a.push(e);var n=$i.$n(t.targetId,e);o.push(n)}})))})),e.next=6,Promise.all(s);case 6:return i.Fo.Pr(a),e.next=9,function(){var e=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u,o,s,c,l;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=O(t),e.prev=1,e.next=4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(e){return Fr.forEach(n,(function(t){return Fr.forEach(t.kn,(function(n){return r.persistence.referenceDelegate.addReference(e,t.targetId,n)})).next((function(){return Fr.forEach(t.xn,(function(n){return r.persistence.referenceDelegate.removeReference(e,t.targetId,n)}))}))}))}));case 4:e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(1),Ur(e.t0)){e.next=10;break}throw e.t0;case 10:D("LocalStore","Failed to update sequence numbers: "+e.t0);case 11:i=b(n);try{for(i.s();!(a=i.n()).done;)u=a.value,o=u.targetId,u.fromCache||(s=r.qn.get(o),c=s.snapshotVersion,l=s.withLastLimboFreeSnapshotVersion(c),r.qn=r.qn.insert(o,l))}catch(f){i.e(f)}finally{i.f()}case 13:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}()(i.localStore,o);case 9:case"end":return e.stop()}}),e)}))),Uo.apply(this,arguments)}function Bo(e,t){return Ko.apply(this,arguments)}function Ko(){return(Ko=(0,u.Z)(y().mark((function e(t,n){var r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=O(t)).currentUser.isEqual(n)){e.next=11;break}return D("SyncEngine","User change. New user:",n.toKey()),e.next=5,ra(r.localStore,n);case 5:return i=e.sent,r.currentUser=n,function(e,t){e.jo.forEach((function(e){e.forEach((function(e){e.reject(new V(P.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.jo.clear()}(r),r.sharedClientState.handleUserChange(n,i.removedBatchIds,i.addedBatchIds),e.next=11,qo(r,i.Gn);case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function jo(e,t){var n=O(e),r=n.Uo.get(t);if(r&&r.$o)return bn().add(r.key);var i=bn(),a=n.Mo.get(t);if(!a)return i;var u,o=b(a);try{for(o.s();!(u=o.n()).done;){var s=u.value,c=n.Oo.get(s);i=i.unionWith(c.view.Po)}}catch(l){o.e(l)}finally{o.f()}return i}function Go(e,t){return zo.apply(this,arguments)}function zo(){return(zo=(0,u.Z)(y().mark((function e(t,n){var r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=O(t),e.next=3,da(r.localStore,n.query,!0);case 3:return i=e.sent,a=n.view.ko(i),e.abrupt("return",(r.isPrimaryClient&&Oo(r,n.targetId,a.Co),a));case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qo(e){return Wo.apply(this,arguments)}function Wo(){return(Wo=(0,u.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=O(t),e.abrupt("return",ya(n.localStore).then((function(e){return qo(n,e)})));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ho(e,t,n,r){return Yo.apply(this,arguments)}function Yo(){return(Yo=(0,u.Z)(y().mark((function e(t,n,r,i){var a,u;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=O(t),e.next=3,function(e,t){var n=O(e),r=O(n.An);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(e){return r.Zt(e,t).next((function(t){return t?n.Wn.vn(e,t):Fr.resolve(null)}))}))}(a.localStore,n);case 3:if(null===(u=e.sent)){e.next=15;break}if("pending"!==r){e.next=10;break}return e.next=8,Tu(a.remoteStore);case 8:e.next=11;break;case 10:"acknowledged"===r||"rejected"===r?(Lo(a,n,i||null),Ro(a,n),function(e,t){O(O(e).An).ee(t)}(a.localStore,n)):L();case 11:return e.next=13,qo(a,u);case 13:e.next=16;break;case 15:D("SyncEngine","Cannot apply mutation batch with id: "+n);case 16:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Jo(e,t){return Xo.apply(this,arguments)}function Xo(){return(Xo=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u,o,s,c,l;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(os(r=O(t)),ss(r),!0!==n||!0===r.Wo){e.next=13;break}return i=r.sharedClientState.getAllActiveQueryTargets(),e.next=5,$o(r,i.toArray());case 5:return a=e.sent,r.Wo=!0,e.next=9,Pu(r.remoteStore,!0);case 9:u=b(a);try{for(u.s();!(o=u.n()).done;)s=o.value,ou(r.remoteStore,s)}catch(f){u.e(f)}finally{u.f()}e.next=25;break;case 13:if(!1!==n||!1===r.Wo){e.next=25;break}return c=[],l=Promise.resolve(),r.Mo.forEach((function(e,t){r.sharedClientState.isLocalQueryTarget(t)?c.push(t):l=l.then((function(){return Mo(r,t),fa(r.localStore,t,!0)})),su(r.remoteStore,t)})),e.next=19,l;case 19:return e.next=21,$o(r,c);case 21:return function(e){var t=O(e);t.Uo.forEach((function(e,n){su(t.remoteStore,n)})),t.qo.hs(),t.Uo=new Map,t.Bo=new cn(Te.comparator)}(r),r.Wo=!1,e.next=25,Pu(r.remoteStore,!1);case 25:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $o(e,t,n){return es.apply(this,arguments)}function es(){return(es=(0,u.Z)(y().mark((function e(t,n,r){var i,a,u,o,s,c,l,f,h,d,v,p,m,g;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=O(t),a=[],u=[],o=b(n),e.prev=2,o.s();case 4:if((s=o.n()).done){e.next=45;break}if(c=s.value,l=void 0,!(f=i.Mo.get(c))||0===f.length){e.next=34;break}return e.next=11,la(i.localStore,mt(f[0]));case 11:l=e.sent,h=b(f),e.prev=13,h.s();case 15:if((d=h.n()).done){e.next=24;break}return v=d.value,p=i.Oo.get(v),e.next=20,Go(i,p);case 20:(m=e.sent).snapshot&&u.push(m.snapshot);case 22:e.next=15;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),h.e(e.t0);case 29:return e.prev=29,h.f(),e.finish(29);case 32:e.next=42;break;case 34:return e.next=36,va(i.localStore,c);case 36:return g=e.sent,e.next=39,la(i.localStore,g);case 39:return l=e.sent,e.next=42,po(i,ts(g),c,!1);case 42:a.push(l);case 43:e.next=4;break;case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(2),o.e(e.t1);case 50:return e.prev=50,o.f(),e.finish(50);case 53:return e.abrupt("return",(i.Fo.Pr(u),a));case 54:case"end":return e.stop()}}),e,null,[[2,47,50,53],[13,26,29,32]])})))).apply(this,arguments)}function ts(e){return ct(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function ns(e){var t=O(e);return O(O(t.localStore).persistence).Tn()}function rs(e,t,n,r){return is.apply(this,arguments)}function is(){return(is=(0,u.Z)(y().mark((function e(t,n,r,i){var a,u,o;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=O(t)).Wo){e.next=5;break}D("SyncEngine","Ignoring unexpected query state notification."),e.next=21;break;case 5:if(!a.Mo.has(n)){e.next=21;break}e.t0=r,e.next="current"===e.t0||"not-current"===e.t0?9:"rejected"===e.t0?16:20;break;case 9:return e.next=11,ya(a.localStore);case 11:return u=e.sent,o=Tn.createSynthesizedRemoteEventForCurrentChange(n,"current"===r),e.next=15,qo(a,u,o);case 15:return e.abrupt("break",21);case 16:return e.next=18,fa(a.localStore,n,!0);case 18:return Mo(a,n,i),e.abrupt("break",21);case 20:L();case 21:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function as(e,t,n){return us.apply(this,arguments)}function us(){return(us=(0,u.Z)(y().mark((function e(t,n,r){var i,a,u,o,s,c,l,f,h;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=os(t)).Wo){e.next=45;break}a=b(n),e.prev=3,a.s();case 5:if((u=a.n()).done){e.next=21;break}if(o=u.value,!i.Mo.has(o)){e.next=10;break}return D("SyncEngine","Adding an already active target "+o),e.abrupt("continue",19);case 10:return e.next=12,va(i.localStore,o);case 12:return s=e.sent,e.next=15,la(i.localStore,s);case 15:return c=e.sent,e.next=18,po(i,ts(s),c.targetId,!1);case 18:ou(i.remoteStore,c);case 19:e.next=5;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),a.e(e.t0);case 26:return e.prev=26,a.f(),e.finish(26);case 29:l=b(r),e.prev=30,h=y().mark((function e(){var t;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.value,e.t0=i.Mo.has(t),!e.t0){e.next=5;break}return e.next=5,fa(i.localStore,t,!1).then((function(){su(i.remoteStore,t),Mo(i,t)})).catch(Ni);case 5:case"end":return e.stop()}}),e)})),l.s();case 33:if((f=l.n()).done){e.next=37;break}return e.delegateYield(h(),"t1",35);case 35:e.next=33;break;case 37:e.next=42;break;case 39:e.prev=39,e.t2=e.catch(30),l.e(e.t2);case 42:return e.prev=42,l.f(),e.finish(42);case 45:case"end":return e.stop()}}),e,null,[[3,23,26,29],[30,39,42,45]])})))).apply(this,arguments)}function os(e){var t=O(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=xo.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=jo.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Eo.bind(null,t),t.Fo.Pr=$u.bind(null,t.eventManager),t.Fo.zo=eo.bind(null,t.eventManager),t}function ss(e){var t=O(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Ao.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=No.bind(null,t),t}function cs(e,t,n){var r,i=O(e);(r=(0,u.Z)(y().mark((function e(t,n,r){var i,a,u,o,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.getMetadata();case 3:return i=e.sent,e.next=6,function(e,t){var n=O(e),r=Vn(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(function(e){return n.Ye.getBundleMetadata(e,t.id)})).then((function(e){return!!e&&e.createTime.compareTo(r)>=0}))}(t.localStore,i);case 6:if(!e.sent){e.next=10;break}return e.next=9,n.close();case 9:return e.abrupt("return",void r._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(i)));case 10:return r._updateProgress(uo(i)),a=new ao(i,t.localStore,n.k),e.next=14,n.Ho();case 14:u=e.sent;case 15:if(!u){e.next=25;break}return e.next=18,a.yo(u);case 18:return(o=e.sent)&&r._updateProgress(o),e.next=22,n.Ho();case 22:u=e.sent;case 23:e.next=15;break;case 25:return e.next=27,a.complete();case 27:return s=e.sent,e.next=30,qo(t,s.In,void 0);case 30:return e.next=32,function(e,t){var n=O(e);return n.persistence.runTransaction("Save bundle","readwrite",(function(e){return n.Ye.saveBundleMetadata(e,t)}))}(t.localStore,i);case 32:r._completeWith(s.progress),e.next=38;break;case 35:e.prev=35,e.t0=e.catch(0),C("SyncEngine","Loading bundle failed with ".concat(e.t0)),r._failWith(e.t0);case 38:case"end":return e.stop()}}),e,null,[[0,35]])}))),function(e,t,n){return r.apply(this,arguments)})(i,t,n).then((function(){i.sharedClientState.notifyBundleLoaded()}))}var ls=function(){function e(){(0,h.Z)(this,e),this.synchronizeTabs=!1}var t,n;return(0,d.Z)(e,[{key:"initialize",value:(n=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.k=Ha(t.databaseInfo.databaseId),this.sharedClientState=this.Jo(t),this.persistence=this.Yo(t),e.next=5,this.persistence.start();case 5:this.gcScheduler=this.Xo(t),this.localStore=this.Zo(t);case 7:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"Xo",value:function(e){return null}},{key:"Zo",value:function(e){return na(this.persistence,new ea,e.initialUser,this.k)}},{key:"Yo",value:function(e){return new Na(Za.ks,this.k)}},{key:"Jo",value:function(e){return new Ua}},{key:"terminate",value:(t=(0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.gcScheduler&&this.gcScheduler.stop(),e.next=3,this.sharedClientState.shutdown();case 3:return e.next=5,this.persistence.shutdown();case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),fs=function(e){(0,o.Z)(r,e);var t,n=I(r);function r(e,t,i){var a;return(0,h.Z)(this,r),(a=n.call(this)).ta=e,a.cacheSizeBytes=t,a.forceOwnership=i,a.synchronizeTabs=!1,a}return(0,d.Z)(r,[{key:"initialize",value:(t=(0,u.Z)(y().mark((function e(t){var n=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.Z)((0,c.Z)(r.prototype),"initialize",this).call(this,t);case 2:return e.next=4,pa(this.localStore);case 4:return e.next=6,this.ta.initialize(this,t);case 6:return e.next=8,ss(this.ta.syncEngine);case 8:return e.next=10,Tu(this.ta.remoteStore);case 10:return e.next=12,this.persistence.sn((function(){return n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(n.localStore),Promise.resolve()}));case 12:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"Zo",value:function(e){return na(this.persistence,new ea,e.initialUser,this.k)}},{key:"Xo",value:function(e){var t=this.persistence.referenceDelegate.garbageCollector;return new Ri(t,e.asyncQueue)}},{key:"Yo",value:function(e){var t=Yi(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?pi.withCacheSize(this.cacheSizeBytes):pi.DEFAULT;return new Qi(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Qa(),Wa(),this.k,this.sharedClientState,!!this.forceOwnership)}},{key:"Jo",value:function(e){return new Ua}}]),r}(ls),hs=function(e){(0,o.Z)(r,e);var t,n=I(r);function r(e,t){var i;return(0,h.Z)(this,r),(i=n.call(this,e,t,!1)).ta=e,i.cacheSizeBytes=t,i.synchronizeTabs=!0,i}return(0,d.Z)(r,[{key:"initialize",value:(t=(0,u.Z)(y().mark((function e(t){var n,a=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,i.Z)((0,c.Z)(r.prototype),"initialize",this).call(this,t);case 2:if(n=this.ta.syncEngine,e.t0=this.sharedClientState instanceof qa,!e.t0){e.next=8;break}return this.sharedClientState.syncEngine={mi:Ho.bind(null,n),gi:rs.bind(null,n),yi:as.bind(null,n),Tn:ns.bind(null,n),_i:Qo.bind(null,n)},e.next=8,this.sharedClientState.start();case 8:return e.next=10,this.persistence.sn(function(){var e=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Jo(a.ta.syncEngine,t);case 2:a.gcScheduler&&(t&&!a.gcScheduler.started?a.gcScheduler.start(a.localStore):t||a.gcScheduler.stop());case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}}),e,this)}))),function(e){return t.apply(this,arguments)})},{key:"Jo",value:function(e){var t=Qa();if(!qa.bt(t))throw new V(P.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Yi(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new qa(t,e.asyncQueue,n,e.clientId,e.initialUser)}}]),r}(fs),ds=function(){function e(){(0,h.Z)(this,e)}var t;return(0,d.Z)(e,[{key:"initialize",value:(t=(0,u.Z)(y().mark((function e(t,n){var r=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.localStore,e.t0){e.next=12;break}return this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return To(r.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Bo.bind(null,this.syncEngine),e.next=12,Pu(this.remoteStore,this.syncEngine.isPrimaryClient);case 12:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"createEventManager",value:function(e){return new Wu}},{key:"createDatastore",value:function(e){var t,n=Ha(e.databaseInfo.databaseId),r=(t=e.databaseInfo,new za(t));return function(e,t,n,r){return new eu(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,r,n)}},{key:"createRemoteStore",value:function(e){var t,n,r,i,a,u=this;return t=this.localStore,n=this.datastore,r=e.asyncQueue,i=function(e){return To(u.syncEngine,e,0)},a=Ka.bt()?new Ka:new Ba,new nu(t,n,r,i,a)}},{key:"createSyncEngine",value:function(e,t){return function(e,t,n,r,i,a,u){var o=new ho(e,t,n,r,i,a);return u&&(o.Wo=!0),o}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}},{key:"terminate",value:function(){return(e=(0,u.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=O(t),D("RemoteStore","RemoteStore shutting down."),n.Gr.add(5),e.next=5,au(n);case 5:n.Hr.shutdown(),n.Jr.set("Unknown");case 7:case"end":return e.stop()}}),e)}))),function(t){return e.apply(this,arguments)})(this.remoteStore);var e}}]),e}();function vs(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10240,n=0;return{read:function(){return(0,u.Z)(y().mark((function r(){var i;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n<e.byteLength)){r.next=3;break}return i={value:e.slice(n,n+t),done:!1},r.abrupt("return",(n+=t,i));case 3:return r.abrupt("return",{done:!0});case 4:case"end":return r.stop()}}),r)})))()},cancel:function(){return(0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var ys=function(){function e(t){(0,h.Z)(this,e),this.observer=t,this.muted=!1}return(0,d.Z)(e,[{key:"next",value:function(e){this.observer.next&&this.ea(this.observer.next,e)}},{key:"error",value:function(e){this.observer.error?this.ea(this.observer.error,e):console.error("Uncaught Error in snapshot listener:",e)}},{key:"na",value:function(){this.muted=!0}},{key:"ea",value:function(e,t){var n=this;this.muted||setTimeout((function(){n.muted||e(t)}),0)}}]),e}(),ps=function(){function e(t,n){var r=this;(0,h.Z)(this,e),this.sa=t,this.k=n,this.metadata=new q,this.buffer=new Uint8Array,this.ia=new TextDecoder("utf-8"),this.ra().then((function(e){e&&e._o()?r.metadata.resolve(e.payload.metadata):r.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             ".concat(JSON.stringify(null==e?void 0:e.payload))))}),(function(e){return r.metadata.reject(e)}))}var t,n,r,i,a,o;return(0,d.Z)(e,[{key:"close",value:function(){return this.sa.cancel()}},{key:"getMetadata",value:(o=(0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.metadata.promise);case 1:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"Ho",value:(a=(0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadata();case 2:return e.abrupt("return",this.ra());case 3:case"end":return e.stop()}}),e,this)}))),function(){return a.apply(this,arguments)})},{key:"ra",value:(i=(0,u.Z)(y().mark((function e(){var t,n,r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.oa();case 2:if(null!==(t=e.sent)){e.next=5;break}return e.abrupt("return",null);case 5:return n=this.ia.decode(t),r=Number(n),isNaN(r)&&this.aa("length string (".concat(n,") is not valid number")),e.next=9,this.ca(r);case 9:return i=e.sent,e.abrupt("return",new ro(JSON.parse(i),t.length+r));case 11:case"end":return e.stop()}}),e,this)}))),function(){return i.apply(this,arguments)})},{key:"ua",value:function(){return this.buffer.findIndex((function(e){return e==="{".charCodeAt(0)}))}},{key:"oa",value:(r=(0,u.Z)(y().mark((function e(){var t,n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.ua()<0)){e.next=7;break}return e.next=3,this.ha();case 3:if(!e.sent){e.next=5;break}return e.abrupt("break",7);case 5:e.next=0;break;case 7:if(0!==this.buffer.length){e.next=9;break}return e.abrupt("return",null);case 9:return(t=this.ua())<0&&this.aa("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,t),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 13:case"end":return e.stop()}}),e,this)}))),function(){return r.apply(this,arguments)})},{key:"ca",value:(n=(0,u.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.buffer.length<t)){e.next=8;break}return e.next=3,this.ha();case 3:if(e.t0=e.sent,!e.t0){e.next=6;break}this.aa("Reached the end of bundle when more is expected.");case 6:e.next=0;break;case 8:return n=this.ia.decode(this.buffer.slice(0,t)),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 10:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"aa",value:function(e){throw this.sa.cancel(),new Error("Invalid bundle format: ".concat(e))}},{key:"ha",value:(t=(0,u.Z)(y().mark((function e(){var t,n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.sa.read();case 2:return(t=e.sent).done||((n=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),n.set(t.value,this.buffer.length),this.buffer=n),e.abrupt("return",t.done);case 5:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),ms=function(){function e(t){(0,h.Z)(this,e),this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}var t,n;return(0,d.Z)(e,[{key:"lookup",value:(n=(0,u.Z)(y().mark((function e(t){var n,r=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!(this.mutations.length>0)){e.next=2;break}throw new V(P.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");case 2:return e.next=4,function(){var e=(0,u.Z)(y().mark((function e(t,n){var r,i,a,u,o,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=O(t),i=zn(r.k)+"/documents",a={documents:n.map((function(e){return Bn(r.k,e)}))},e.next=5,r.ji("BatchGetDocuments",i,a);case 5:return u=e.sent,o=new Map,u.forEach((function(e){var t=Yn(r.k,e);o.set(t.key.toString(),t)})),s=[],e.abrupt("return",(n.forEach((function(e){var t=o.get(e.toString());M(!!t),s.push(t)})),s));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,t);case 4:return n=e.sent,e.abrupt("return",(n.forEach((function(e){return r.recordVersion(e)})),n));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"set",value:function(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"update",value:function(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}},{key:"delete",value:function(e){this.write(new rn(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"commit",value:(t=(0,u.Z)(y().mark((function e(){var t,n=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!this.lastWriteError){e.next=2;break}throw this.lastWriteError;case 2:return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(e,t){var r=Te.fromPath(t);n.mutations.push(new an(r,n.precondition(r)))})),e.next=7,function(){var e=(0,u.Z)(y().mark((function e(t,n){var r,i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=O(t),i=zn(r.k)+"/documents",a={writes:n.map((function(e){return Jn(r.k,e)}))},e.next=3,r.Bi("Commit",i,a);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,this.mutations);case 7:this.committed=!0;case 8:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"recordVersion",value:function(e){var t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw L();t=re.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new V(P.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}},{key:"precondition",value:function(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?Bt.updateTime(t):Bt.none()}},{key:"preconditionForUpdate",value:function(e){var t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(re.min()))throw new V(P.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Bt.updateTime(t)}return Bt.exists(!0)}},{key:"write",value:function(e){this.ensureCommitNotCalled(),this.mutations.push(e)}},{key:"ensureCommitNotCalled",value:function(){}}]),e}(),gs=function(){function e(t,n,r,i){(0,h.Z)(this,e),this.asyncQueue=t,this.datastore=n,this.updateFunction=r,this.deferred=i,this.la=5,this.ur=new Ya(this.asyncQueue,"transaction_retry")}return(0,d.Z)(e,[{key:"run",value:function(){this.la-=1,this.fa()}},{key:"fa",value:function(){var e=this;this.ur.Zi((0,u.Z)(y().mark((function t(){var n,r;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=new ms(e.datastore),(r=e.da(n))&&r.then((function(t){e.asyncQueue.enqueueAndForget((function(){return n.commit().then((function(){e.deferred.resolve(t)})).catch((function(t){e.wa(t)}))}))})).catch((function(t){e.wa(t)}));case 2:case"end":return t.stop()}}),t)}))))}},{key:"da",value:function(e){try{var t=this.updateFunction(e);return!be(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}},{key:"wa",value:function(e){var t=this;this.la>0&&this._a(e)?(this.la-=1,this.asyncQueue.enqueueAndForget((function(){return t.fa(),Promise.resolve()}))):this.deferred.reject(e)}},{key:"_a",value:function(e){if("FirebaseError"===e.name){var t=e.code;return"aborted"===t||"failed-precondition"===t||!on(t)}return!1}}]),e}(),ks=function(){function e(t,n,r,i){var a=this;(0,h.Z)(this,e),this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=i,this.user=E.UNAUTHENTICATED,this.clientId=X.A(),this.authCredentialListener=function(){return Promise.resolve()},this.authCredentials.start(r,function(){var e=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D("FirestoreClient","Received user=",t.uid),e.next=3,a.authCredentialListener(t);case 3:a.user=t;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.appCheckCredentials.start(r,(function(){return Promise.resolve()}))}var t;return(0,d.Z)(e,[{key:"getConfiguration",value:(t=(0,u.Z)(y().mark((function e(){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100});case 1:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"setCredentialChangeListener",value:function(e){this.authCredentialListener=e}},{key:"verifyNotTerminated",value:function(){if(this.asyncQueue.isShuttingDown)throw new V(P.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"terminate",value:function(){var e=this;this.asyncQueue.enterRestrictedMode();var t=new q;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((0,u.Z)(y().mark((function n(){var r;return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,n.t0=e.onlineComponents,!n.t0){n.next=5;break}return n.next=5,e.onlineComponents.terminate();case 5:if(n.t1=e.offlineComponents,!n.t1){n.next=9;break}return n.next=9,e.offlineComponents.terminate();case 9:e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve(),n.next=18;break;case 14:n.prev=14,n.t2=n.catch(0),r=Ku(n.t2,"Failed to shutdown persistence"),t.reject(r);case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))),t.promise}}]),e}();function ws(e,t){return bs.apply(this,arguments)}function bs(){return bs=(0,u.Z)(y().mark((function e(t,n){var r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),D("FirestoreClient","Initializing OfflineComponentProvider"),e.next=3,t.getConfiguration();case 3:return r=e.sent,e.next=6,n.initialize(r);case 6:i=r.initialUser,t.setCredentialChangeListener(function(){var e=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=i.isEqual(t),e.t0){e.next=5;break}return e.next=4,ra(n.localStore,t);case 4:i=t;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=n;case 8:case"end":return e.stop()}}),e)}))),bs.apply(this,arguments)}function xs(e,t){return Is.apply(this,arguments)}function Is(){return Is=(0,u.Z)(y().mark((function e(t,n){var r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),e.next=3,Ts(t);case 3:return r=e.sent,D("FirestoreClient","Initializing OnlineComponentProvider"),e.next=7,t.getConfiguration();case 7:return i=e.sent,e.next=10,n.initialize(r,i);case 10:t.setCredentialChangeListener((function(e){return(t=(0,u.Z)(y().mark((function e(t,n){var r,i;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=O(t)).asyncQueue.verifyOperationInProgress(),D("RemoteStore","RemoteStore received new credentials"),i=du(r),r.Gr.add(3),e.next=6,au(r);case 6:return i&&r.Jr.set("Unknown"),e.next=9,r.remoteSyncer.handleCredentialChange(n);case 9:return r.Gr.delete(3),e.next=12,ru(r);case 12:case"end":return e.stop()}}),e)}))),function(e,n){return t.apply(this,arguments)})(n.remoteStore,e);var t})),t.onlineComponents=n;case 12:case"end":return e.stop()}}),e)}))),Is.apply(this,arguments)}function Ts(e){return Es.apply(this,arguments)}function Es(){return(Es=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.offlineComponents,e.t0){e.next=5;break}return D("FirestoreClient","Using default OfflineComponentProvider"),e.next=5,ws(t,new ls);case 5:return e.abrupt("return",t.offlineComponents);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ss(e){return As.apply(this,arguments)}function As(){return(As=(0,u.Z)(y().mark((function e(t){return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.onlineComponents,e.t0){e.next=5;break}return D("FirestoreClient","Using default OnlineComponentProvider"),e.next=5,xs(t,new ds);case 5:return e.abrupt("return",t.onlineComponents);case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _s(e){return Ts(e).then((function(e){return e.persistence}))}function Ns(e){return Ts(e).then((function(e){return e.localStore}))}function Ds(e){return Ss(e).then((function(e){return e.remoteStore}))}function Zs(e){return Ss(e).then((function(e){return e.syncEngine}))}function Cs(e){return Rs.apply(this,arguments)}function Rs(){return(Rs=(0,u.Z)(y().mark((function e(t){var n,r;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ss(t);case 2:return n=e.sent,r=n.eventManager,e.abrupt("return",(r.onListen=vo.bind(null,n.syncEngine),r.onUnlisten=go.bind(null,n.syncEngine),r));case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ls(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new q;return e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function i(){return y().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new ys({next:function(a){t.enqueueAndForget((function(){return Ju(e,u)}));var o=a.docs.has(n);!o&&a.fromCache?i.reject(new V(P.UNAVAILABLE,"Failed to get document because the client is offline.")):o&&a.fromCache&&r&&"server"===r.source?i.reject(new V(P.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:function(e){return i.reject(e)}}),u=new no(lt(n.path),a,{includeMetadataChanges:!0,wo:!0});return Hu(e,u)},i.next=3,Cs(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}}),i)})))),r.promise}function Ms(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new q;return e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function i(){return y().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.t0=function(e,t,n,r,i){var a=new ys({next:function(n){t.enqueueAndForget((function(){return Ju(e,u)})),n.fromCache&&"server"===r.source?i.reject(new V(P.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(e){return i.reject(e)}}),u=new no(n,a,{includeMetadataChanges:!0,wo:!0});return Hu(e,u)},i.next=3,Cs(e);case 3:return i.t1=i.sent,i.t2=e.asyncQueue,i.t3=t,i.t4=n,i.t5=r,i.abrupt("return",(0,i.t0)(i.t1,i.t2,i.t3,i.t4,i.t5));case 9:case"end":return i.stop()}}),i)})))),r.promise}var Fs=(0,d.Z)((function e(t,n,r,i,a,u,o,s){(0,h.Z)(this,e),this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=i,this.ssl=a,this.forceLongPolling=u,this.autoDetectLongPolling=o,this.useFetchStreams=s})),Os=function(){function e(t,n){(0,h.Z)(this,e),this.projectId=t,this.database=n||"(default)"}return(0,d.Z)(e,[{key:"isDefaultDatabase",get:function(){return"(default)"===this.database}},{key:"isEqual",value:function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}}]),e}(),Ps=new Map;function Vs(e,t,n){if(!n)throw new V(P.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function qs(e,t,n,r){if(!0===t&&!0===r)throw new V(P.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))}function Us(e){if(!Te.isDocumentKey(e))throw new V(P.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function Bs(e){if(Te.isDocumentKey(e))throw new V(P.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function Ks(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";var t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}return"function"==typeof e?"a function":L()}function js(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new V(P.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Ks(e);throw new V(P.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}return e}function Gs(e,t){if(t<=0)throw new V(P.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}var zs=function(){function e(t){var n;if((0,h.Z)(this,e),void 0===t.host){if(void 0!==t.ssl)throw new V(P.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(n=t.ssl)||void 0===n||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new V(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,qs("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return(0,d.Z)(e,[{key:"isEqual",value:function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}]),e}(),Qs=function(){function e(t,n,r){(0,h.Z)(this,e),this._authCredentials=n,this._appCheckCredentials=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new zs({}),this._settingsFrozen=!1,t instanceof Os?this._databaseId=t:(this._app=t,this._databaseId=function(e){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new V(P.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Os(e.options.projectId)}(t))}return(0,d.Z)(e,[{key:"app",get:function(){if(!this._app)throw new V(P.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function(){return this._settingsFrozen}},{key:"_terminated",get:function(){return void 0!==this._terminateTask}},{key:"_setSettings",value:function(e){if(this._settingsFrozen)throw new V(P.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new zs(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new B;switch(e.type){case"gapi":var t=e.client;return M(!("object"!=typeof t||null===t||!t.auth||!t.auth.getAuthHeaderValueForFirstParty)),new z(t,e.sessionIndex||"0",e.iamToken||null);case"provider":return e.client;default:throw new V(P.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}},{key:"_getSettings",value:function(){return this._settings}},{key:"_freezeSettings",value:function(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}},{key:"toJSON",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function(){return e=this,(t=Ps.get(e))&&(D("ComponentProvider","Removing Datastore"),Ps.delete(e),t.terminate()),Promise.resolve();var e,t}}]),e}();function Ws(e,t,n){var r,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=(e=js(e,Qs))._getSettings();if("firestore.googleapis.com"!==a.host&&a.host!==t&&C("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},a),{host:"".concat(t,":").concat(n),ssl:!1})),i.mockUserToken){var u,o;if("string"==typeof i.mockUserToken)u=i.mockUserToken,o=E.MOCK_USER;else{u=(0,k.Sg)(i.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);var s=i.mockUserToken.sub||i.mockUserToken.user_id;if(!s)throw new V(P.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");o=new E(s)}e._authCredentials=new K(new U(u,o))}}var Hs=function(){function e(t,n,r){(0,h.Z)(this,e),this.converter=n,this._key=r,this.type="document",this.firestore=t}return(0,d.Z)(e,[{key:"_path",get:function(){return this._key.path}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"path",get:function(){return this._key.path.canonicalString()}},{key:"parent",get:function(){return new Js(this.firestore,this.converter,this._key.path.popLast())}},{key:"withConverter",value:function(t){return new e(this.firestore,t,this._key)}}]),e}(),Ys=function(){function e(t,n,r){(0,h.Z)(this,e),this.converter=n,this._query=r,this.type="query",this.firestore=t}return(0,d.Z)(e,[{key:"withConverter",value:function(t){return new e(this.firestore,t,this._query)}}]),e}(),Js=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this,e,r,lt(i)))._path=i,a.type="collection",a}return(0,d.Z)(n,[{key:"id",get:function(){return this._query.path.lastSegment()}},{key:"path",get:function(){return this._query.path.canonicalString()}},{key:"parent",get:function(){var e=this._path.popLast();return e.isEmpty()?null:new Hs(this.firestore,null,new Te(e))}},{key:"withConverter",value:function(e){return new n(this.firestore,e,this._path)}}]),n}(Ys);function Xs(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,k.m9)(e),Vs("collection","path",t),e instanceof Qs){var a=se.fromString.apply(se,[t].concat(r));return Bs(a),new Js(e,null,a)}if(!(e instanceof Hs||e instanceof Js))throw new V(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var u=e._path.child(se.fromString.apply(se,[t].concat(r)));return Bs(u),new Js(e.firestore,null,u)}function $s(e,t){if(e=js(e,Qs),Vs("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new V(P.INVALID_ARGUMENT,"Invalid collection ID '".concat(t,"' passed to function collectionGroup(). Collection IDs must not contain '/'."));return new Ys(e,null,function(e){return new st(se.emptyPath(),e)}(t))}function ec(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];if(e=(0,k.m9)(e),1===arguments.length&&(t=X.A()),Vs("doc","path",t),e instanceof Qs){var a=se.fromString.apply(se,[t].concat(r));return Us(a),new Hs(e,null,new Te(a))}if(!(e instanceof Hs||e instanceof Js))throw new V(P.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var u=e._path.child(se.fromString.apply(se,[t].concat(r)));return Us(u),new Hs(e.firestore,e instanceof Js?e.converter:null,new Te(u))}function tc(e,t){return e=(0,k.m9)(e),t=(0,k.m9)(t),(e instanceof Hs||e instanceof Js)&&(t instanceof Hs||t instanceof Js)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function nc(e,t){return e=(0,k.m9)(e),t=(0,k.m9)(t),e instanceof Ys&&t instanceof Ys&&e.firestore===t.firestore&&kt(e._query,t._query)&&e.converter===t.converter}var rc=function(){function e(){var t=this;(0,h.Z)(this,e),this.ma=Promise.resolve(),this.ga=[],this.ya=!1,this.pa=[],this.Ta=null,this.Ea=!1,this.Ia=!1,this.Aa=[],this.ur=new Ya(this,"async_queue_retry"),this.Ra=function(){var e=Wa();e&&D("AsyncQueue","Visibility state changed to "+e.visibilityState),t.ur.er()};var n=Wa();n&&"function"==typeof n.addEventListener&&n.addEventListener("visibilitychange",this.Ra)}var t,n;return(0,d.Z)(e,[{key:"isShuttingDown",get:function(){return this.ya}},{key:"enqueueAndForget",value:function(e){this.enqueue(e)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function(e){this.Pa(),this.ba(e)}},{key:"enterRestrictedMode",value:function(e){if(!this.ya){this.ya=!0,this.Ia=e||!1;var t=Wa();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.Ra)}}},{key:"enqueue",value:function(e){var t=this;if(this.Pa(),this.ya)return new Promise((function(){}));var n=new q;return this.ba((function(){return t.ya&&t.Ia?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))}},{key:"enqueueRetryable",value:function(e){var t=this;this.enqueueAndForget((function(){return t.ga.push(e),t.va()}))}},{key:"va",value:(n=(0,u.Z)(y().mark((function e(){var t=this;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.ga.length){e.next=14;break}return e.prev=1,e.next=4,this.ga[0]();case 4:this.ga.shift(),this.ur.reset(),e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(1),Ur(e.t0)){e.next=12;break}throw e.t0;case 12:D("AsyncQueue","Operation failed with retryable error: "+e.t0);case 13:this.ga.length>0&&this.ur.Zi((function(){return t.va()}));case 14:case"end":return e.stop()}}),e,this,[[1,8]])}))),function(){return n.apply(this,arguments)})},{key:"ba",value:function(e){var t=this,n=this.ma.then((function(){return t.Ea=!0,e().catch((function(e){t.Ta=e,t.Ea=!1;var n=function(e){var t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Z("INTERNAL UNHANDLED ERROR: ",n),e})).then((function(e){return t.Ea=!1,e}))}));return this.ma=n,n}},{key:"enqueueAfterDelay",value:function(e,t,n){var r=this;this.Pa(),this.Aa.indexOf(e)>-1&&(t=0);var i=Bu.createAndSchedule(this,e,t,n,(function(e){return r.Va(e)}));return this.pa.push(i),i}},{key:"Pa",value:function(){this.Ta&&L()}},{key:"verifyOperationInProgress",value:function(){}},{key:"Sa",value:(t=(0,u.Z)(y().mark((function e(){var t;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.ma,e.next=3,t;case 3:if(t!==this.ma){e.next=0;break}case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"Da",value:function(e){var t,n=b(this.pa);try{for(n.s();!(t=n.n()).done;){if(t.value.timerId===e)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"Ca",value:function(e){var t=this;return this.Sa().then((function(){t.pa.sort((function(e,t){return e.targetTimeMs-t.targetTimeMs}));var n,r=b(t.pa);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(i.skipDelay(),"all"!==e&&i.timerId===e)break}}catch(a){r.e(a)}finally{r.f()}return t.Sa()}))}},{key:"Na",value:function(e){this.Aa.push(e)}},{key:"Va",value:function(e){var t=this.pa.indexOf(e);this.pa.splice(t,1)}}]),e}();function ic(e){return function(e,t){if("object"!=typeof e||null===e)return!1;var n,r=e,i=b(["next","error","complete"]);try{for(i.s();!(n=i.n()).done;){var a=n.value;if(a in r&&"function"==typeof r[a])return!0}}catch(u){i.e(u)}finally{i.f()}return!1}(e)}var ac=function(){function e(){(0,h.Z)(this,e),this._progressObserver={},this._taskCompletionResolver=new q,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return(0,d.Z)(e,[{key:"onProgress",value:function(e,t,n){this._progressObserver={next:e,error:t,complete:n}}},{key:"catch",value:function(e){return this._taskCompletionResolver.promise.catch(e)}},{key:"then",value:function(e,t){return this._taskCompletionResolver.promise.then(e,t)}},{key:"_completeWith",value:function(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}},{key:"_failWith",value:function(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}},{key:"_updateProgress",value:function(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}]),e}(),uc=-1,oc=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this,e,r,i)).type="firestore",a._queue=new rc,a._persistenceKey="name"in e?e.name:"[DEFAULT]",a}return(0,d.Z)(n,[{key:"_terminate",value:function(){return this._firestoreClient||fc(this),this._firestoreClient.terminate()}}]),n}(Qs);function sc(e,t){var n=(0,p.qX)(e,"firestore");if(n.isInitialized()){var r=n.getImmediate(),i=n.getOptions();if((0,k.vZ)(i,t))return r;throw new V(P.FAILED_PRECONDITION,"initializeFirestore() has already been called with different options. To avoid this error, call initializeFirestore() with the same options as when it was originally called, or call getFirestore() to return the already initialized instance.")}if(void 0!==t.cacheSizeBytes&&-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new V(P.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");return n.initialize({options:t})}function cc(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,p.Mq)();return(0,p.qX)(e,"firestore").getImmediate()}function lc(e){return e._firestoreClient||fc(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function fc(e){var t,n=e._freezeSettings(),r=function(e,t,n,r){return new Fs(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new ks(e._authCredentials,e._appCheckCredentials,e._queue,r)}function hc(e,t){xc(e=js(e,oc));var n=lc(e),r=e._freezeSettings(),i=new ds;return vc(n,i,new fs(i,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}function dc(e){xc(e=js(e,oc));var t=lc(e),n=e._freezeSettings(),r=new ds;return vc(t,r,new hs(r,n.cacheSizeBytes))}function vc(e,t,n){var r=new q;return e.asyncQueue.enqueue((0,u.Z)(y().mark((function i(){return y().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return i.prev=0,i.next=3,ws(e,n);case 3:return i.next=5,xs(e,t);case 5:r.resolve(),i.next=13;break;case 8:if(i.prev=8,i.t0=i.catch(0),function(e){return"FirebaseError"===e.name?e.code===P.FAILED_PRECONDITION||e.code===P.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||(22===e.code||20===e.code||11===e.code)}(i.t0)){i.next=12;break}throw i.t0;case 12:console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+i.t0),r.reject(i.t0);case 13:case"end":return i.stop()}}),i,null,[[0,8]])})))).then((function(){return r.promise}))}function yc(e){if(e._initialized&&!e._terminated)throw new V(P.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var t=new q;return e._queue.enqueueAndForgetEvenWhileRestricted((0,u.Z)(y().mark((function n(){return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,function(){var e=(0,u.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Pr.bt()){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return n=t+"main",e.next=5,Pr.delete(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(Yi(e._databaseId,e._persistenceKey));case 3:t.resolve(),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),t.reject(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})))),t.promise}function pc(e){return function(e){var t=new q;return e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function n(){return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=Zo,n.next=3,Zs(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)})))),t.promise}(lc(e=js(e,oc)))}function mc(e){return function(e){return e.asyncQueue.enqueue((0,u.Z)(y().mark((function t(){var n,r;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,_s(e);case 2:return n=t.sent,t.next=5,Ds(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!0),function(e){var t=O(e);return t.Gr.delete(0),ru(t)}(r)));case 7:case"end":return t.stop()}}),t)}))))}(lc(e=js(e,oc)))}function gc(e){return function(e){return e.asyncQueue.enqueue((0,u.Z)(y().mark((function t(){var n,r;return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,_s(e);case 2:return n=t.sent,t.next=5,Ds(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!1),function(){var e=(0,u.Z)(y().mark((function e(t){var n;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=O(t)).Gr.add(0),e.next=4,au(n);case 4:n.Jr.set("Offline");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(r)));case 7:case"end":return t.stop()}}),t)}))))}(lc(e=js(e,oc)))}function kc(e){return(0,p.wN)(e.app,"firestore"),e._delete()}function wc(e,t){var n=lc(e=js(e,oc)),r=new ac;return function(e,t,n,r){var i=function(e,t){return function(e,t){return new ps(e,t)}(function(e,t){if(e instanceof Uint8Array)return vs(e,t);if(e instanceof ArrayBuffer)return vs(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),t)}(n,Ha(t));e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=cs,t.next=3,Zs(e);case 3:t.t1=t.sent,t.t2=i,t.t3=r,(0,t.t0)(t.t1,t.t2,t.t3);case 7:case"end":return t.stop()}}),t)}))))}(n,e._databaseId,t,r),r}function bc(e,t){return function(e,t){return e.asyncQueue.enqueue((0,u.Z)(y().mark((function n(){return y().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=function(e,t){var n=O(e);return n.persistence.runTransaction("Get named query","readonly",(function(e){return n.Ye.getNamedQuery(e,t)}))},n.next=3,Ns(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)}))))}(lc(e=js(e,oc)),t).then((function(t){return t?new Ys(e,null,t.query):null}))}function xc(e){if(e._initialized||e._terminated)throw new V(P.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var Ic=function(){function e(){(0,h.Z)(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var i=0;i<n.length;++i)if(0===n[i].length)throw new V(P.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new le(n)}return(0,d.Z)(e,[{key:"isEqual",value:function(e){return this._internalPath.isEqual(e._internalPath)}}]),e}();function Tc(){return new Ic("__name__")}var Ec=function(){function e(t){(0,h.Z)(this,e),this._byteString=t}return(0,d.Z)(e,[{key:"toBase64",value:function(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function(){return this._byteString.toUint8Array()}},{key:"toString",value:function(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function(e){return this._byteString.isEqual(e._byteString)}}],[{key:"fromBase64String",value:function(t){try{return new e(de.fromBase64String(t))}catch(t){throw new V(P.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}},{key:"fromUint8Array",value:function(t){return new e(de.fromUint8Array(t))}}]),e}(),Sc=(0,d.Z)((function e(t){(0,h.Z)(this,e),this._methodName=t})),Ac=function(){function e(t,n){if((0,h.Z)(this,e),!isFinite(t)||t<-90||t>90)throw new V(P.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new V(P.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return(0,d.Z)(e,[{key:"latitude",get:function(){return this._lat}},{key:"longitude",get:function(){return this._long}},{key:"isEqual",value:function(e){return this._lat===e._lat&&this._long===e._long}},{key:"toJSON",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function(e){return $(this._lat,e._lat)||$(this._long,e._long)}}]),e}(),_c=/^__.*__$/,Nc=function(){function e(t,n,r){(0,h.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,d.Z)(e,[{key:"toMutation",value:function(e,t){return null!==this.fieldMask?new Jt(e,this.data,this.fieldMask,t,this.fieldTransforms):new Yt(e,this.data,t,this.fieldTransforms)}}]),e}(),Dc=function(){function e(t,n,r){(0,h.Z)(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return(0,d.Z)(e,[{key:"toMutation",value:function(e,t){return new Jt(e,this.data,this.fieldMask,t,this.fieldTransforms)}}]),e}();function Zc(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L()}}var Cc=function(){function e(t,n,r,i,a,u){(0,h.Z)(this,e),this.settings=t,this.databaseId=n,this.k=r,this.ignoreUndefinedProperties=i,void 0===a&&this.ka(),this.fieldTransforms=a||[],this.fieldMask=u||[]}return(0,d.Z)(e,[{key:"path",get:function(){return this.settings.path}},{key:"xa",get:function(){return this.settings.xa}},{key:"$a",value:function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.k,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:"Fa",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.$a({path:n,Oa:!1});return r.Ma(e),r}},{key:"La",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.$a({path:n,Oa:!1});return r.ka(),r}},{key:"Ba",value:function(e){return this.$a({path:void 0,Oa:!0})}},{key:"Ua",value:function(e){return Xc(e,this.settings.methodName,this.settings.qa||!1,this.path,this.settings.Ka)}},{key:"contains",value:function(e){return void 0!==this.fieldMask.find((function(t){return e.isPrefixOf(t)}))||void 0!==this.fieldTransforms.find((function(t){return e.isPrefixOf(t.field)}))}},{key:"ka",value:function(){if(this.path)for(var e=0;e<this.path.length;e++)this.Ma(this.path.get(e))}},{key:"Ma",value:function(e){if(0===e.length)throw this.Ua("Document fields must not be empty");if(Zc(this.xa)&&_c.test(e))throw this.Ua('Document fields cannot begin and end with "__"')}}]),e}(),Rc=function(){function e(t,n,r){(0,h.Z)(this,e),this.databaseId=t,this.ignoreUndefinedProperties=n,this.k=r||Ha(t)}return(0,d.Z)(e,[{key:"ja",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new Cc({xa:e,methodName:t,Ka:n,path:le.emptyPath(),Oa:!1,qa:r},this.databaseId,this.k,this.ignoreUndefinedProperties)}}]),e}();function Lc(e){var t=e._freezeSettings(),n=Ha(e._databaseId);return new Rc(e._databaseId,!!t.ignoreUndefinedProperties,n)}function Mc(e,t,n,r,i){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},u=e.ja(a.merge||a.mergeFields?2:0,t,n,i);Wc("Data must be an object, but it was:",u,r);var o,s,c=zc(r,u);if(a.merge)o=new fe(u.fieldMask),s=u.fieldTransforms;else if(a.mergeFields){var l,f=[],h=b(a.mergeFields);try{for(h.s();!(l=h.n()).done;){var d=l.value,v=Hc(t,d,n);if(!u.contains(v))throw new V(P.INVALID_ARGUMENT,"Field '".concat(v,"' is specified in your field mask but missing from your input data."));$c(f,v)||f.push(v)}}catch(y){h.e(y)}finally{h.f()}o=new fe(f),s=u.fieldTransforms.filter((function(e){return o.covers(e.field)}))}else o=null,s=u.fieldTransforms;return new Nc(new Ve(c),o,s)}var Fc=function(e){(0,o.Z)(n,e);var t=I(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"_toFieldTransform",value:function(e){if(2!==e.xa)throw 1===e.xa?e.Ua("".concat(this._methodName,"() can only appear at the top level of your update data")):e.Ua("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(Sc);function Oc(e,t,n){return new Cc({xa:3,Ka:t.settings.Ka,methodName:e._methodName,Oa:n},t.databaseId,t.k,t.ignoreUndefinedProperties)}var Pc=function(e){(0,o.Z)(n,e);var t=I(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"_toFieldTransform",value:function(e){return new qt(e.path,new Ct)}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(Sc),Vc=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e)).Qa=r,i}return(0,d.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=Oc(this,e,!0),n=this.Qa.map((function(e){return Gc(e,t)})),r=new Rt(n);return new qt(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(Sc),qc=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e)).Qa=r,i}return(0,d.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=Oc(this,e,!0),n=this.Qa.map((function(e){return Gc(e,t)})),r=new Mt(n);return new qt(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(Sc),Uc=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e)).Wa=r,i}return(0,d.Z)(n,[{key:"_toFieldTransform",value:function(e){var t=new Ot(e.k,At(e.k,this.Wa));return new qt(e.path,t)}},{key:"isEqual",value:function(e){return this===e}}]),n}(Sc);function Bc(e,t,n,r){var i=e.ja(1,t,n);Wc("Data must be an object, but it was:",i,r);var a=[],u=Ve.empty();ae(r,(function(e,r){var o=Jc(t,e,n);r=(0,k.m9)(r);var s=i.La(o);if(r instanceof Fc)a.push(o);else{var c=Gc(r,s);null!=c&&(a.push(o),u.set(o,c))}}));var o=new fe(a);return new Dc(u,o,i.fieldTransforms)}function Kc(e,t,n,r,i,a){var u=e.ja(1,t,n),o=[Hc(t,r,n)],s=[i];if(a.length%2!=0)throw new V(P.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(var c=0;c<a.length;c+=2)o.push(Hc(t,a[c])),s.push(a[c+1]);for(var l=[],f=Ve.empty(),h=o.length-1;h>=0;--h)if(!$c(l,o[h])){var d=o[h],v=s[h];v=(0,k.m9)(v);var y=u.La(d);if(v instanceof Fc)l.push(d);else{var p=Gc(v,y);null!=p&&(l.push(d),f.set(d,p))}}var m=new fe(l);return new Dc(f,m,u.fieldTransforms)}function jc(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Gc(n,e.ja(r?4:3,t))}function Gc(e,t){if(Qc(e=(0,k.m9)(e)))return Wc("Unsupported field value:",t,e),zc(e,t);if(e instanceof Sc)return function(e,t){if(!Zc(t.xa))throw t.Ua("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Ua("".concat(e._methodName,"() is not currently supported inside arrays"));var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.Oa&&4!==t.xa)throw t.Ua("Nested arrays are not supported");return function(e,t){var n,r=[],i=0,a=b(e);try{for(a.s();!(n=a.n()).done;){var u=Gc(n.value,t.Ba(i));null==u&&(u={nullValue:"NULL_VALUE"}),r.push(u),i++}}catch(o){a.e(o)}finally{a.f()}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=(0,k.m9)(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return At(t.k,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=ne.fromDate(e);return{timestampValue:Fn(t.k,n)}}if(e instanceof ne){var r=new ne(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:Fn(t.k,r)}}if(e instanceof Ac)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof Ec)return{bytesValue:On(t.k,e._byteString)};if(e instanceof Hs){var i=t.databaseId,a=e.firestore._databaseId;if(!a.isEqual(i))throw t.Ua("Document reference is for database ".concat(a.projectId,"/").concat(a.database," but should be for database ").concat(i.projectId,"/").concat(i.database));return{referenceValue:qn(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.Ua("Unsupported field value: ".concat(Ks(e)))}(e,t)}function zc(e,t){var n={};return ue(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ae(e,(function(e,r){var i=Gc(r,t.Fa(e));null!=i&&(n[e]=i)})),{mapValue:{fields:n}}}function Qc(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof ne||e instanceof Ac||e instanceof Ec||e instanceof Hs||e instanceof Sc)}function Wc(e,t,n){if(!Qc(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){var r=Ks(n);throw"an object"===r?t.Ua(e+" a custom object"):t.Ua(e+" "+r)}}function Hc(e,t,n){if((t=(0,k.m9)(t))instanceof Ic)return t._internalPath;if("string"==typeof t)return Jc(e,t);throw Xc("Field path arguments must be of type string or FieldPath.",e,!1,void 0,n)}var Yc=new RegExp("[~\\*/\\[\\]]");function Jc(e,t,n){if(t.search(Yc)>=0)throw Xc("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return(0,r.Z)(Ic,(0,f.Z)(t.split(".")))._internalPath}catch(i){throw Xc("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function Xc(e,t,n,r,i){var a=r&&!r.isEmpty(),u=void 0!==i,o="Function ".concat(t,"() called with invalid data");n&&(o+=" (via `toFirestore()`)"),o+=". ";var s="";return(a||u)&&(s+=" (found",a&&(s+=" in field ".concat(r)),u&&(s+=" in document ".concat(i)),s+=")"),new V(P.INVALID_ARGUMENT,o+e+s)}function $c(e,t){return e.some((function(e){return e.isEqual(t)}))}var el=function(){function e(t,n,r,i,a){(0,h.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._key=r,this._document=i,this._converter=a}return(0,d.Z)(e,[{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"ref",get:function(){return new Hs(this._firestore,this._converter,this._key)}},{key:"exists",value:function(){return null!==this._document}},{key:"data",value:function(){if(this._document){if(this._converter){var e=new tl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:"get",value:function(e){if(this._document){var t=this._document.data.field(nl("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}]),e}(),tl=function(e){(0,o.Z)(n,e);var t=I(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"data",value:function(){return(0,i.Z)((0,c.Z)(n.prototype),"data",this).call(this)}}]),n}(el);function nl(e,t){return"string"==typeof t?Jc(e,t):t instanceof Ic?t._internalPath:t._delegate._internalPath}var rl=function(){function e(t,n){(0,h.Z)(this,e),this.hasPendingWrites=t,this.fromCache=n}return(0,d.Z)(e,[{key:"isEqual",value:function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}]),e}(),il=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i,a,u,o){var s;return(0,h.Z)(this,n),(s=t.call(this,e,r,i,a,o))._firestore=e,s._firestoreImpl=e,s.metadata=u,s}return(0,d.Z)(n,[{key:"exists",value:function(){return(0,i.Z)((0,c.Z)(n.prototype),"exists",this).call(this)}},{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){var t=new al(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){var n=this._document.data.field(nl("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}]),n}(el),al=function(e){(0,o.Z)(n,e);var t=I(n);function n(){return(0,h.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,i.Z)((0,c.Z)(n.prototype),"data",this).call(this,e)}}]),n}(il),ul=function(){function e(t,n,r,i){(0,h.Z)(this,e),this._firestore=t,this._userDataWriter=n,this._snapshot=i,this.metadata=new rl(i.hasPendingWrites,i.fromCache),this.query=r}return(0,d.Z)(e,[{key:"docs",get:function(){var e=[];return this.forEach((function(t){return e.push(t)})),e}},{key:"size",get:function(){return this._snapshot.docs.size}},{key:"empty",get:function(){return 0===this.size}},{key:"forEach",value:function(e,t){var n=this;this._snapshot.docs.forEach((function(r){e.call(t,new al(n._firestore,n._userDataWriter,r.key,r,new rl(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))}},{key:"docChanges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new V(P.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){var n=0;return e._snapshot.docChanges.map((function(t){return{type:"added",doc:new al(e._firestore,e._userDataWriter,t.doc.key,t.doc,new rl(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:n++}}))}var r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((function(e){return t||3!==e.type})).map((function(t){var n=new al(e._firestore,e._userDataWriter,t.doc.key,t.doc,new rl(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),i=-1,a=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(a=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:ol(t.type),doc:n,oldIndex:i,newIndex:a}}))}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}]),e}();function ol(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L()}}function sl(e,t){return e instanceof il&&t instanceof il?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof ul&&t instanceof ul&&e._firestore===t._firestore&&nc(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function cl(e){if(ht(e)&&0===e.explicitOrderBy.length)throw new V(P.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var ll=(0,d.Z)((function e(){(0,h.Z)(this,e)}));function fl(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var i=0,a=n;i<a.length;i++){var u=a[i];e=u._apply(e)}return e}var hl=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this)).Ga=e,a.za=r,a.Ha=i,a.type="where",a}return(0,d.Z)(n,[{key:"_apply",value:function(e){var t=Lc(e.firestore),n=function(e,t,n,r,i,a,u){var o;if(i.isKeyField()){if("array-contains"===a||"array-contains-any"===a)throw new V(P.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(a,"' queries on FieldPath.documentId()."));if("in"===a||"not-in"===a){Al(u,a);var s,c=[],l=b(u);try{for(l.s();!(s=l.n()).done;){var f=s.value;c.push(Sl(r,e,f))}}catch(d){l.e(d)}finally{l.f()}o={arrayValue:{values:c}}}else o=Sl(r,e,u)}else"in"!==a&&"not-in"!==a&&"array-contains-any"!==a||Al(u,a),o=jc(n,"where",u,"in"===a||"not-in"===a);var h=Qe.create(i,a,o);return function(e,t){if(t.V()){var n=vt(e);if(null!==n&&!n.isEqual(t.field))throw new V(P.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '".concat(n.toString(),"' and '").concat(t.field.toString(),"'"));var r=dt(e);null!==r&&_l(e,t.field,r)}var i=function(e,t){var n,r=b(e.filters);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(t.indexOf(i.op)>=0)return i.op}}catch(d){r.e(d)}finally{r.f()}return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==i)throw i===t.op?new V(P.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new V(P.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(i.toString(),"' filters."))}(e,h),h}(e._query,0,t,e.firestore._databaseId,this.Ga,this.za,this.Ha);return new Ys(e.firestore,e.converter,function(e,t){var n=e.filters.concat([t]);return new st(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}]),n}(ll);function dl(e,t,n){var r=t,i=nl("where",e);return new hl(i,r,n)}var vl=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this)).Ga=e,i.Ja=r,i.type="orderBy",i}return(0,d.Z)(n,[{key:"_apply",value:function(e){var t=function(e,t,n){if(null!==e.startAt)throw new V(P.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new V(P.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new it(t,n);return function(e,t){if(null===dt(e)){var n=vt(e);null!==n&&_l(e,n,t.field)}}(e,r),r}(e._query,this.Ga,this.Ja);return new Ys(e.firestore,e.converter,function(e,t){var n=e.explicitOrderBy.concat([t]);return new st(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}]),n}(ll);function yl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=t,r=nl("orderBy",e);return new vl(r,n)}var pl=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this)).type=e,a.Ya=r,a.Xa=i,a}return(0,d.Z)(n,[{key:"_apply",value:function(e){return new Ys(e.firestore,e.converter,gt(e._query,this.Ya,this.Xa))}}]),n}(ll);function ml(e){return Gs("limit",e),new pl("limit",e,"F")}function gl(e){return Gs("limitToLast",e),new pl("limitToLast",e,"L")}var kl=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this)).type=e,a.Za=r,a.tc=i,a}return(0,d.Z)(n,[{key:"_apply",value:function(e){var t=El(e,this.type,this.Za,this.tc);return new Ys(e.firestore,e.converter,function(e,t){return new st(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}]),n}(ll);function wl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new kl("startAt",t,!0)}function bl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new kl("startAfter",t,!1)}var xl=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r,i){var a;return(0,h.Z)(this,n),(a=t.call(this)).type=e,a.Za=r,a.tc=i,a}return(0,d.Z)(n,[{key:"_apply",value:function(e){var t=El(e,this.type,this.Za,this.tc);return new Ys(e.firestore,e.converter,function(e,t){return new st(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}]),n}(ll);function Il(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new xl("endBefore",t,!0)}function Tl(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new xl("endAt",t,!1)}function El(e,t,n,r){if(n[0]=(0,k.m9)(n[0]),n[0]instanceof el)return function(e,t,n,r,i){if(!r)throw new V(P.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for ".concat(n,"()."));var a,u=[],o=b(pt(e));try{for(o.s();!(a=o.n()).done;){var s=a.value;if(s.field.isKeyField())u.push(Ce(t,r.key));else{var c=r.data.field(s.field);if(ge(c))throw new V(P.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+s.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var l=s.field.canonicalString();throw new V(P.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '".concat(l,"' (used as the orderBy) does not exist."))}u.push(c)}}}catch(f){o.e(f)}finally{o.f()}return new nt(u,i)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var i=Lc(e.firestore);return function(e,t,n,r,i,a){var u=e.explicitOrderBy;if(i.length>u.length)throw new V(P.INVALID_ARGUMENT,"Too many arguments provided to ".concat(r,"(). The number of arguments must be less than or equal to the number of orderBy() clauses"));for(var o=[],s=0;s<i.length;s++){var c=i[s];if(u[s].field.isKeyField()){if("string"!=typeof c)throw new V(P.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in ".concat(r,"(), but got a ").concat(typeof c));if(!yt(e)&&-1!==c.indexOf("/"))throw new V(P.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to ".concat(r,"() must be a plain document ID, but '").concat(c,"' contains a slash."));var l=e.path.child(se.fromString(c));if(!Te.isDocumentKey(l))throw new V(P.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to ".concat(r,"() must result in a valid document path, but '").concat(l,"' is not because it contains an odd number of segments."));var f=new Te(l);o.push(Ce(t,f))}else{var h=jc(n,r,c);o.push(h)}}return new nt(o,a)}(e._query,e.firestore._databaseId,i,t,n,r)}function Sl(e,t,n){if("string"==typeof(n=(0,k.m9)(n))){if(""===n)throw new V(P.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!yt(t)&&-1!==n.indexOf("/"))throw new V(P.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));var r=t.path.child(se.fromString(n));if(!Te.isDocumentKey(r))throw new V(P.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return Ce(e,new Te(r))}if(n instanceof Hs)return Ce(e,n._key);throw new V(P.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(Ks(n),"."))}function Al(e,t){if(!Array.isArray(e)||0===e.length)throw new V(P.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."));if(e.length>10)throw new V(P.INVALID_ARGUMENT,"Invalid Query. '".concat(t.toString(),"' filters support a maximum of 10 elements in the value array."))}function _l(e,t,n){if(!n.isEqual(t))throw new V(P.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '".concat(t.toString(),"' and so you must also use '").concat(t.toString(),"' as your first argument to orderBy(), but your first orderBy() is on field '").concat(n.toString(),"' instead."))}var Nl=function(){function e(){(0,h.Z)(this,e)}return(0,d.Z)(e,[{key:"convertValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Ee(e)){case 0:return null;case 1:return e.booleanValue;case 2:return pe(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(me(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw L()}}},{key:"convertObject",value:function(e,t){var n=this,r={};return ae(e.fields,(function(e,i){r[e]=n.convertValue(i,t)})),r}},{key:"convertGeoPoint",value:function(e){return new Ac(pe(e.latitude),pe(e.longitude))}},{key:"convertArray",value:function(e,t){var n=this;return(e.values||[]).map((function(e){return n.convertValue(e,t)}))}},{key:"convertServerTimestamp",value:function(e,t){switch(t){case"previous":var n=ke(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(we(e));default:return null}}},{key:"convertTimestamp",value:function(e){var t=ye(e);return new ne(t.seconds,t.nanos)}},{key:"convertDocumentKey",value:function(e,t){var n=se.fromString(e);M(hr(n));var r=new Os(n.get(1),n.get(3)),i=new Te(n.popFirst(5));return r.isEqual(t)||Z("Document ".concat(i," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}]),e}();function Dl(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var Zl=function(e){(0,o.Z)(n,e);var t=I(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).firestore=e,r}return(0,d.Z)(n,[{key:"convertBytes",value:function(e){return new Ec(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Hs(this.firestore,null,t)}}]),n}(Nl),Cl=function(){function e(t,n){(0,h.Z)(this,e),this._firestore=t,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=Lc(t)}return(0,d.Z)(e,[{key:"set",value:function(e,t,n){this._verifyNotCommitted();var r=Rl(e,this._firestore),i=Dl(r.converter,t,n),a=Mc(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(a.toMutation(r._key,Bt.none())),this}},{key:"update",value:function(e,t,n){this._verifyNotCommitted();for(var r,i=Rl(e,this._firestore),a=arguments.length,u=new Array(a>3?a-3:0),o=3;o<a;o++)u[o-3]=arguments[o];return r="string"==typeof(t=(0,k.m9)(t))||t instanceof Ic?Kc(this._dataReader,"WriteBatch.update",i._key,t,n,u):Bc(this._dataReader,"WriteBatch.update",i._key,t),this._mutations.push(r.toMutation(i._key,Bt.exists(!0))),this}},{key:"delete",value:function(e){this._verifyNotCommitted();var t=Rl(e,this._firestore);return this._mutations=this._mutations.concat(new rn(t._key,Bt.none())),this}},{key:"commit",value:function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}},{key:"_verifyNotCommitted",value:function(){if(this._committed)throw new V(P.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}]),e}();function Rl(e,t){if((e=(0,k.m9)(e)).firestore!==t)throw new V(P.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}function Ll(e){e=js(e,Hs);var t=js(e.firestore,oc);return Ls(lc(t),e._key).then((function(n){return Wl(t,e,n)}))}var Ml=function(e){(0,o.Z)(n,e);var t=I(n);function n(e){var r;return(0,h.Z)(this,n),(r=t.call(this)).firestore=e,r}return(0,d.Z)(n,[{key:"convertBytes",value:function(e){return new Ec(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new Hs(this.firestore,null,t)}}]),n}(Nl);function Fl(e){e=js(e,Hs);var t=js(e.firestore,oc),n=lc(t),r=new Ml(t);return function(e,t){var n=new q;return e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function r(){return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=(0,u.Z)(y().mark((function e(t,n,r){var i,a;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,function(e,t){var n=O(e);return n.persistence.runTransaction("read document","readonly",(function(e){return n.Wn.Rn(e,t)}))}(t,n);case 3:(i=e.sent).isFoundDocument()?r.resolve(i):i.isNoDocument()?r.resolve(null):r.reject(new V(P.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),a=Ku(e.t0,"Failed to get document '".concat(n," from cache")),r.reject(a);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Ns(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(n,e._key).then((function(n){return new il(t,r,e._key,n,new rl(null!==n&&n.hasLocalMutations,!0),e.converter)}))}function Ol(e){e=js(e,Hs);var t=js(e.firestore,oc);return Ls(lc(t),e._key,{source:"server"}).then((function(n){return Wl(t,e,n)}))}function Pl(e){e=js(e,Ys);var t=js(e.firestore,oc),n=lc(t),r=new Ml(t);return cl(e._query),Ms(n,e._query).then((function(n){return new ul(t,r,e,n)}))}function Vl(e){e=js(e,Ys);var t=js(e.firestore,oc),n=lc(t),r=new Ml(t);return function(e,t){var n=new q;return e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function r(){return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=(0,u.Z)(y().mark((function e(t,n,r){var i,a,u,o,s;return y().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,da(t,n,!0);case 3:i=e.sent,a=new co(n,i.zn),u=a.bo(i.documents),o=a.applyChanges(u,!1),r.resolve(o.snapshot),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),s=Ku(e.t0,"Failed to execute query '".concat(n," against cache")),r.reject(s);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Ns(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(n,e._query).then((function(n){return new ul(t,r,e,n)}))}function ql(e){e=js(e,Ys);var t=js(e.firestore,oc),n=lc(t),r=new Ml(t);return Ms(n,e._query,{source:"server"}).then((function(n){return new ul(t,r,e,n)}))}function Ul(e,t,n){e=js(e,Hs);var r=js(e.firestore,oc),i=Dl(e.converter,t,n);return Ql(r,[Mc(Lc(r),"setDoc",e._key,i,null!==e.converter,n).toMutation(e._key,Bt.none())])}function Bl(e,t,n){e=js(e,Hs);for(var r=js(e.firestore,oc),i=Lc(r),a=arguments.length,u=new Array(a>3?a-3:0),o=3;o<a;o++)u[o-3]=arguments[o];return Ql(r,[("string"==typeof(t=(0,k.m9)(t))||t instanceof Ic?Kc(i,"updateDoc",e._key,t,n,u):Bc(i,"updateDoc",e._key,t)).toMutation(e._key,Bt.exists(!0))])}function Kl(e){return Ql(js(e.firestore,oc),[new rn(e._key,Bt.none())])}function jl(e,t){var n=js(e.firestore,oc),r=ec(e),i=Dl(e.converter,t);return Ql(n,[Mc(Lc(e.firestore),"addDoc",r._key,i,null!==e.converter,{}).toMutation(r._key,Bt.exists(!1))]).then((function(){return r}))}function Gl(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i,a,o;e=(0,k.m9)(e);var s={includeMetadataChanges:!1},c=0;"object"!=typeof n[c]||ic(n[c])||(s=n[c],c++);var l,f,h,d={includeMetadataChanges:s.includeMetadataChanges};if(ic(n[c])){var v=n[c];n[c]=null===(i=v.next)||void 0===i?void 0:i.bind(v),n[c+1]=null===(a=v.error)||void 0===a?void 0:a.bind(v),n[c+2]=null===(o=v.complete)||void 0===o?void 0:o.bind(v)}if(e instanceof Hs)f=js(e.firestore,oc),h=lt(e._key.path),l={next:function(t){n[c]&&n[c](Wl(f,e,t))},error:n[c+1],complete:n[c+2]};else{var p=js(e,Ys);f=js(p.firestore,oc),h=p._query;var m=new Ml(f);l={next:function(e){n[c]&&n[c](new ul(f,m,p,e))},error:n[c+1],complete:n[c+2]},cl(e._query)}return function(e,t,n,r){var i=new ys(r),a=new no(t,i,n);return e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Hu,t.next=3,Cs(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){i.na(),e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Ju,t.next=3,Cs(e);case 3:return t.t1=t.sent,t.t2=a,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(lc(f),h,d,l)}function zl(e,t){return function(e,t){var n=new ys(t);return e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){O(e).io.add(t),t.next()},t.next=3,Cs(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){n.na(),e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function t(){return y().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){O(e).io.delete(t)},t.next=3,Cs(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(lc(e=js(e,oc)),ic(t)?t:{next:t})}function Ql(e,t){return function(e,t){var n=new q;return e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function r(){return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=wo,r.next=3,Zs(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(lc(e),t)}function Wl(e,t,n){var r=n.docs.get(t._key),i=new Ml(e);return new il(e,i,t._key,r,new rl(n.hasPendingWrites,n.fromCache),t.converter)}var Hl=function(e){(0,o.Z)(n,e);var t=I(n);function n(e,r){var i;return(0,h.Z)(this,n),(i=t.call(this,e,r))._firestore=e,i}return(0,d.Z)(n,[{key:"get",value:function(e){var t=this,r=Rl(e,this._firestore),a=new Ml(this._firestore);return(0,i.Z)((0,c.Z)(n.prototype),"get",this).call(this,e).then((function(e){return new il(t._firestore,a,r._key,e._document,new rl(!1,!1),r.converter)}))}}]),n}(function(){function e(t,n){(0,h.Z)(this,e),this._firestore=t,this._transaction=n,this._dataReader=Lc(t)}return(0,d.Z)(e,[{key:"get",value:function(e){var t=this,n=Rl(e,this._firestore),r=new Zl(this._firestore);return this._transaction.lookup([n._key]).then((function(e){if(!e||1!==e.length)return L();var i=e[0];if(i.isFoundDocument())return new el(t._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new el(t._firestore,r,n._key,null,n.converter);throw L()}))}},{key:"set",value:function(e,t,n){var r=Rl(e,this._firestore),i=Dl(r.converter,t,n),a=Mc(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,a),this}},{key:"update",value:function(e,t,n){for(var r,i=Rl(e,this._firestore),a=arguments.length,u=new Array(a>3?a-3:0),o=3;o<a;o++)u[o-3]=arguments[o];return r="string"==typeof(t=(0,k.m9)(t))||t instanceof Ic?Kc(this._dataReader,"Transaction.update",i._key,t,n,u):Bc(this._dataReader,"Transaction.update",i._key,t),this._transaction.update(i._key,r),this}},{key:"delete",value:function(e){var t=Rl(e,this._firestore);return this._transaction.delete(t._key),this}}]),e}());function Yl(e,t){return function(e,t){var n=new q;return e.asyncQueue.enqueueAndForget((0,u.Z)(y().mark((function r(){var i;return y().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,function(e){return Ss(e).then((function(e){return e.datastore}))}(e);case 2:i=r.sent,new gs(e.asyncQueue,i,t,n).run();case 4:case"end":return r.stop()}}),r)})))),n.promise}(lc(e=js(e,oc)),(function(n){return t(new Hl(e,n))}))}function Jl(){return new Fc("deleteField")}function Xl(){return new Pc("serverTimestamp")}function $l(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Vc("arrayUnion",t)}function ef(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new qc("arrayRemove",t)}function tf(e){return new Uc("increment",e)}function nf(e){return lc(e=js(e,oc)),new Cl(e,(function(t){return Ql(e,t)}))}!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){S=e}(p.Jn),(0,p.Xd)(new m.wA("firestore",(function(e,n){var r=n.options,i=e.getProvider("app").getImmediate(),a=new oc(i,new j(e.getProvider("auth-internal")),new W(e.getProvider("app-check-internal")));return r=Object.assign({useFetchStreams:t},r),a._setSettings(r),a}),"PUBLIC")),(0,p.KN)(T,"3.4.1",e),(0,p.KN)(T,"3.4.1","esm2017")}()}}]);
//# sourceMappingURL=7112840a-d7d40161b2f84beeb420.js.map